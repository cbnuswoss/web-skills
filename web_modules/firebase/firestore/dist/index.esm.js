import{_ as t,a as e,b as n,g as r,c as i,i as o,d as s,e as u,h as a,j as c,k as h,L as f,l,C as p,f as d}from"../../../common/index.esm-18552045.js";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var v=function(t,e){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function y(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var g,m="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},w=w||{},b=m||self;function I(){}function E(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function T(t){var e=E(t);return"array"==e||"object"==e&&"number"==typeof t.length}function N(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var _="closure_uid_"+(1e9*Math.random()>>>0),A=0;function S(t,e,n){return t.call.apply(t.bind,arguments)}function D(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function k(t,e,n){return(k=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?S:D).apply(null,arguments)}function x(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var R=Date.now;function P(t,e){function n(){}n.prototype=e.prototype,t.S=e.prototype,t.prototype=new n,t.prototype.constructor=t}function L(){this.j=this.j,this.i=this.i}L.prototype.j=!1,L.prototype.ja=function(){if(!this.j&&(this.j=!0,this.G(),0))(function(t){Object.prototype.hasOwnProperty.call(t,_)&&t[_]||(t[_]=++A)})(this)},L.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var O=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},C=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function V(t){return Array.prototype.concat.apply([],arguments)}function U(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function M(t){return/^[\s\xa0]*$/.test(t)}var q,F=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function j(t,e){return-1!=t.indexOf(e)}function G(t,e){return t<e?-1:t>e?1:0}t:{var B=b.navigator;if(B){var z=B.userAgent;if(z){q=z;break t}}q=""}function H(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function K(t){var e={};for(var n in t)e[n]=t[n];return e}var W="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Y(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<W.length;o++)n=W[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function X(t){return X[" "](t),t}X[" "]=I;var Q,Z,J=j(q,"Opera"),$=j(q,"Trident")||j(q,"MSIE"),tt=j(q,"Edge"),et=tt||$,nt=j(q,"Gecko")&&!(j(q.toLowerCase(),"webkit")&&!j(q,"Edge"))&&!(j(q,"Trident")||j(q,"MSIE"))&&!j(q,"Edge"),rt=j(q.toLowerCase(),"webkit")&&!j(q,"Edge");function it(){var t=b.document;return t?t.documentMode:void 0}t:{var ot="",st=(Z=q,nt?/rv:([^\);]+)(\)|;)/.exec(Z):tt?/Edge\/([\d\.]+)/.exec(Z):$?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Z):rt?/WebKit\/(\S+)/.exec(Z):J?/(?:Version)[ \/]?(\S+)/.exec(Z):void 0);if(st&&(ot=st?st[1]:""),$){var ut=it();if(null!=ut&&ut>parseFloat(ot)){Q=String(ut);break t}}Q=ot}var at,ct={};function ht(t){return function(t,e){var n=ct;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,(function(){for(var e=0,n=F(String(Q)).split("."),r=F(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",u=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],u=/(\d*)(\D*)(.*)/.exec(u)||["","","",""],0==s[0].length&&0==u[0].length)break;e=G(0==s[1].length?0:parseInt(s[1],10),0==u[1].length?0:parseInt(u[1],10))||G(0==s[2].length,0==u[2].length)||G(s[2],u[2]),s=s[3],u=u[3]}while(0==e)}return 0<=e}))}if(b.document&&$){var ft=it();at=ft||(parseInt(Q,10)||void 0)}else at=void 0;var lt=at,pt=!$||9<=Number(lt),dt=$&&!ht("9"),vt=function(){if(!b.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{b.addEventListener("test",I,e),b.removeEventListener("test",I,e)}catch(t){}return t}();function yt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function gt(t,e){if(yt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(nt){t:{try{X(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:mt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}yt.prototype.b=function(){this.defaultPrevented=!0},P(gt,yt);var mt={2:"touch",3:"pen",4:"mouse"};gt.prototype.b=function(){gt.S.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,dt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var wt="closure_listenable_"+(1e6*Math.random()|0),bt=0;function It(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++bt,this.Y=this.Z=!1}function Et(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Tt(t){this.src=t,this.a={},this.b=0}function Nt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=O(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Et(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function _t(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}Tt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=_t(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new It(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var At="closure_lm_"+(1e6*Math.random()|0),St={};function Dt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Vt(r),e&&e[wt]?e.wa(n,r,N(i)?!!i.capture:!!i,o):kt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Dt(t,e[o],n,r,i);return null}return n=Vt(n),t&&t[wt]?t.va(e,n,N(r)?!!r.capture:!!r,i):kt(t,e,n,!1,r,i)}function kt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=N(i)?!!i.capture:!!i;if(s&&!pt)return null;var u=Ot(t);if(u||(t[At]=u=new Tt(t)),(n=u.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Lt,e=pt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)vt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Rt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function xt(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[wt])Nt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Rt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ot(e))?(Nt(n,t),0==n.b&&(n.src=null,e[At]=null)):Et(t)}}}function Rt(t){return t in St?St[t]:St[t]="on"+t}function Pt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&xt(t),n.call(r,e)}function Lt(t,e){if(t.Y)return!0;if(!pt){if(!e)t:{e=["window","event"];for(var n=b,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Pt(t,e=new gt(e,this))}return Pt(t,new gt(e,this))}function Ot(t){return(t=t[At])instanceof Tt?t:null}var Ct="__closure_events_fn_"+(1e9*Math.random()>>>0);function Vt(t){return"function"==E(t)?t:(t[Ct]||(t[Ct]=function(e){return t.handleEvent(e)}),t[Ct])}function Ut(){L.call(this),this.c=new Tt(this),this.J=this,this.C=null}function Mt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.Y&&s.capture==n){var u=s.listener,a=s.ca||s.src;s.Z&&Nt(t.c,s),i=!1!==u.call(a,r)&&i}}return i&&!r.defaultPrevented}P(Ut,L),Ut.prototype[wt]=!0,(g=Ut.prototype).addEventListener=function(t,e,n,r){Dt(this,t,e,n,r)},g.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=N(i)?!!i.capture:!!i,r=Vt(r),e&&e[wt]?(e=e.c,(n=String(n).toString())in e.a&&(-1<(r=_t(s=e.a[n],r,i,o))&&(Et(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--)))):e&&(e=Ot(e))&&(n=e.a[n.toString()],e=-1,n&&(e=_t(n,r,i,o)),(r=-1<e?n[e]:null)&&xt(r))}(this,t,e,n,r)},g.dispatchEvent=function(t){var e,n=this.C;if(n)for(e=[];n;n=n.C)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t)t=new yt(t,n);else if(t instanceof yt)t.target=t.target||n;else{var i=t;Y(t=new yt(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];i=Mt(s,r,!0,t)&&i}if(i=Mt(s=t.a=n,r,!0,t)&&i,i=Mt(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Mt(s=t.a=e[o],r,!1,t)&&i;return i},g.G=function(){if(Ut.S.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Et(n[r]);delete e.a[t],e.b--}}this.C=null},g.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},g.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var qt=b.JSON.stringify;function Ft(){this.b=this.a=null}var jt,Gt=new(function(){function t(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())((function(){return new zt}),(function(t){t.reset()}),100);function Bt(){var t=Yt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function zt(){this.next=this.b=this.a=null}function Ht(t){b.setTimeout((function(){throw t}),0)}function Kt(t,e){jt||function(){var t=b.Promise.resolve(void 0);jt=function(){t.then(Xt)}}(),Wt||(jt(),Wt=!0),Yt.add(t,e)}Ft.prototype.add=function(t,e){var n=Gt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},zt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},zt.prototype.reset=function(){this.next=this.b=this.a=null};var Wt=!1,Yt=new Ft;function Xt(){for(var t;t=Bt();){try{t.a.call(t.b)}catch(t){Ht(t)}var e=Gt;e.g(t),e.b<e.f&&(e.b++,t.next=e.a,e.a=t)}Wt=!1}function Qt(t,e){Ut.call(this),this.b=t||1,this.a=e||b,this.f=k(this.Ya,this),this.g=R()}function Zt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Jt(t,e,n){if("function"==E(t))n&&(t=k(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=k(t.handleEvent,t)}return 2147483647<Number(e)?-1:b.setTimeout(t,e||0)}function $t(t){t.a=Jt((function(){t.a=null,t.c&&(t.c=!1,$t(t))}),t.h);var e=t.b;t.b=null,t.g.apply(null,e)}P(Qt,Ut),(g=Qt.prototype).aa=!1,g.M=null,g.Ya=function(){if(this.aa){var t=R()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(Zt(this),this.start()))}},g.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=R())},g.G=function(){Qt.S.G.call(this),Zt(this),delete this.a};var te=function(t){function e(e,n,r){var i=t.call(this)||this;return i.g=null!=r?e.bind(r):e,i.h=n,i.b=null,i.c=!1,i.a=null,i}return function(t,e){function n(){this.constructor=t}v(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:$t(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(b.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(L);function ee(t){L.call(this),this.b=t,this.a={}}P(ee,L);var ne=[];function re(t,e,n,r){Array.isArray(n)||(n&&(ne[0]=n.toString()),n=ne);for(var i=0;i<n.length;i++){var o=Dt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function ie(t){H(t.a,(function(t,e){this.a.hasOwnProperty(e)&&xt(t)}),t),t.a={}}function oe(){this.a=!0}function se(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return qt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}ee.prototype.G=function(){ee.S.G.call(this),ie(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},oe.prototype.info=function(){};var ue=null;function ae(){return ue=ue||new Ut}function ce(t){yt.call(this,"serverreachability",t)}function he(t){var e=ae();e.dispatchEvent(new ce(e,t))}function fe(t){yt.call(this,"statevent",t)}function le(t){var e=ae();e.dispatchEvent(new fe(e,t))}function pe(t){yt.call(this,"timingevent",t)}function de(t,e){if("function"!=E(t))throw Error("Fn must not be null and must be a function");return b.setTimeout((function(){t()}),e)}P(ce,yt),P(fe,yt),P(pe,yt);var ve={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},ye={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function ge(){}function me(t){var e;return(e=t.a)||(e=t.a={}),e}function we(){}ge.prototype.a=null;var be,Ie={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function Ee(){yt.call(this,"d")}function Te(){yt.call(this,"c")}function Ne(){}function _e(t,e,n,r){this.g=t,this.c=e,this.f=n,this.T=r||1,this.J=new ee(this),this.P=Ae,t=et?125:void 0,this.R=new Qt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}P(Ee,yt),P(Te,yt),P(Ne,ge),be=new Ne;var Ae=45e3,Se={},De={};function ke(t,e,n){t.H=1,t.i=Ze(He(e)),t.j=n,t.I=!0,xe(t,null)}function xe(t,e){t.u=R(),Le(t),t.l=He(t.i);var n=t.l,r=t.T;Array.isArray(r)||(r=[String(r)]),fn(n.b,"t",r),t.D=0,t.a=or(t.g,t.g.C?e:null),0<t.O&&(t.F=new te(k(t.Ca,t,t.a),t.O)),re(t.J,t.a,"readystatechange",t.Wa),e=t.B?K(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),he(1),function(t,e,n,r,i,o){t.info((function(){if(t.a)if(o)for(var s="",u=o.split("&"),a=0;a<u.length;a++){var c=u[a].split("=");if(1<c.length){var h=c[0];c=c[1];var f=h.split("_");s=2<=f.length&&"type"==f[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.c,t.m,t.l,t.f,t.T,t.j)}function Re(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=Pe(t,n);if(i==De){4==e&&(t.h=4,le(14),r=!1),se(t.c,t.f,null,"[Incomplete Response]");break}if(i==Se){t.h=4,le(15),se(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}se(t.c,t.f,i,null),Me(t,i)}4==e&&0==n.length&&(t.h=1,le(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.W&&(t.W=!0,(e=t.g).a==t&&e.V&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Zn(e),e.F=!0)):(se(t.c,t.f,n,"[Invalid Chunked Response]"),Ue(t),Ve(t))}function Pe(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?De:(n=Number(e.substring(n,r)),isNaN(n)?Se:(r+=1)+n>e.length?De:(e=e.substr(r,n),t.D=r+n,e))}function Le(t){t.U=R()+t.P,Oe(t,t.P)}function Oe(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=de(k(t.Ua,t),e)}function Ce(t){t.o&&(b.clearTimeout(t.o),t.o=null)}function Ve(t){0==t.g.v||t.A||tr(t.g,t)}function Ue(t){Ce(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Zt(t.R),ie(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Me(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||mn(n.b,t)))if(n.I=t.N,!t.C&&mn(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;$n(n),Gn(n)}Qn(n),le(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=de(k(n.Ra,n),6e3));if(1>=gn(n.b)&&n.ea){try{n.ea()}catch(t){}n.ea=void 0}}else nr(n,11)}else if((t.C||n.a==t)&&$n(n),!M(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(i=e[r],n.P=i[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var o=i[3];null!=o&&(n.ha=o,n.c.info("VER="+n.ha));var s=i[4];null!=s&&(n.pa=s,n.c.info("SVER="+n.pa));var u=i[5];if(null!=u&&"number"==typeof u&&0<u){var a=1.5*u;n.D=a,n.c.info("backChannelRequestTimeoutMs_="+a)}a=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var f=a.b;!f.a&&(j(h,"spdy")||j(h,"quic")||j(h,"h2"))&&(f.f=f.g,f.a=new Set,f.b&&(wn(f,f.b),f.b=null))}if(a.A){var l=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;l&&(a.na=l,Qe(a.B,a.A,l))}}n.v=3,n.f&&n.f.ta(),n.V&&(n.N=R()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var p=t;if((a=n).la=ir(a,a.C?a.ga:null,a.fa),p.C){bn(a.b,p);var d=p,v=a.D;v&&d.setTimeout(v),d.o&&(Ce(d),Le(d)),a.a=p}else Xn(a);0<n.g.length&&Hn(n)}else"stop"!=i[0]&&"close"!=i[0]||nr(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?nr(n,7):jn(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);he(4)}catch(t){}}function qe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(T(t)||"string"==typeof t)C(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(T(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(T(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Fe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Fe)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function je(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ge(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Ge(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function Ge(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(g=_e.prototype).setTimeout=function(t){this.P=t},g.Wa=function(t){t=t.target;var e=this.F;e&&3==Un(t)?e.f():this.Ca(t)},g.Ca=function(t){try{if(t==this.a)t:{var e=Un(this.a),n=this.a.ua(),r=this.a.X();if(!(3>e||3==e&&!et&&!this.a.$())){this.A||4!=e||7==n||he(8==n||0>=r?3:2),Ce(this);var i=this.a.X();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.c,this.m,this.l,this.f,this.T,e,i),this.b){if(this.V&&!this.C){e:{if(this.a){var s,u=this.a;if((s=u.a?u.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!M(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.h=3,le(12),Ue(this),Ve(this);break t}se(this.c,this.f,a,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Me(this,a)}this.I?(Re(this,e,o),et&&this.b&&3==e&&(re(this.J,this.R,"tick",this.Va),this.R.start())):(se(this.c,this.f,o,null),Me(this,o)),4==e&&Ue(this),this.b&&!this.A&&(4==e?tr(this.g,this):(this.b=!1,Le(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,le(12)):(this.h=0,le(13)),Ue(this),Ve(this)}}}catch(t){}},g.Va=function(){if(this.a){var t=Un(this.a),e=this.a.$();this.D<e.length&&(Ce(this),Re(this,t,e),this.b&&4!=t&&Le(this))}},g.cancel=function(){this.A=!0,Ue(this)},g.Ua=function(){this.o=null;var t=R();0<=t-this.U?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.c,this.l),2!=this.H&&(he(3),le(17)),Ue(this),this.h=2,Ve(this)):Oe(this,this.U-t)},(g=Fe.prototype).K=function(){je(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},g.L=function(){return je(this),this.a.concat()},g.get=function(t,e){return Ge(this.b,t)?this.b[t]:e},g.set=function(t,e){Ge(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},g.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Be=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function ze(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof ze){this.a=void 0!==e?e:t.a,Ke(this,t.f),this.j=t.j,We(this,t.c),Ye(this,t.h),this.g=t.g,e=t.b;var n=new un;n.c=e.c,e.a&&(n.a=new Fe(e.a),n.b=e.b),Xe(this,n),this.i=t.i}else t&&(n=String(t).match(Be))?(this.a=!!e,Ke(this,n[1]||"",!0),this.j=Je(n[2]||""),We(this,n[3]||"",!0),Ye(this,n[4]),this.g=Je(n[5]||"",!0),Xe(this,n[6]||"",!0),this.i=Je(n[7]||"")):(this.a=!!e,this.b=new un(null,this.a))}function He(t){return new ze(t)}function Ke(t,e,n){t.f=n?Je(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function We(t,e,n){t.c=n?Je(e,!0):e}function Ye(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Xe(t,e,n){e instanceof un?(t.b=e,function(t,e){e&&!t.f&&(an(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(cn(this,e),fn(this,n,t))}),t)),t.f=e}(t.b,t.a)):(n||(e=$e(e,on)),t.b=new un(e,t.a))}function Qe(t,e,n){t.b.set(e,n)}function Ze(t){return Qe(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^R()).toString(36)),t}function Je(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function $e(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,tn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function tn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}ze.prototype.toString=function(){var t=[],e=this.f;e&&t.push($e(e,en,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push($e(e,en,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push($e(n,"/"==n.charAt(0)?rn:nn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",$e(n,sn)),t.join("")};var en=/[#\/\?@]/g,nn=/[#\?:]/g,rn=/[#\?]/g,on=/[#\?@]/g,sn=/#/g;function un(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function an(t){t.a||(t.a=new Fe,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function cn(t,e){an(t),e=ln(t,e),Ge(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ge((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&je(t)))}function hn(t,e){return an(t),e=ln(t,e),Ge(t.a.b,e)}function fn(t,e,n){cn(t,e),0<n.length&&(t.c=null,t.a.set(ln(t,e),U(n)),t.b+=n.length)}function ln(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function pn(t,e){this.b=t,this.a=e}function dn(t){this.g=t||vn,b.PerformanceNavigationTiming?t=0<(t=b.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(b.ia&&b.ia.ya&&b.ia.ya()&&b.ia.ya().qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(g=un.prototype).add=function(t,e){an(this),this.c=null,t=ln(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},g.forEach=function(t,e){an(this),this.a.forEach((function(n,r){C(n,(function(n){t.call(e,n,r,this)}),this)}),this)},g.L=function(){an(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},g.K=function(t){an(this);var e=[];if("string"==typeof t)hn(this,t)&&(e=V(e,this.a.get(ln(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=V(e,t[n])}return e},g.set=function(t,e){return an(this),this.c=null,hn(this,t=ln(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},g.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},g.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var vn=10;function yn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function gn(t){return t.b?1:t.a?t.a.size:0}function mn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function wn(t,e){t.a?t.a.add(e):t.b=e}function bn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function In(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=y(t.a.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.s)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return U(t.c)}function En(){}function Tn(){this.a=new En}function Nn(t,e,n){var r=n||"";try{qe(t,(function(t,n){var i=t;N(t)&&(i=qt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function _n(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}dn.prototype.cancel=function(){var t,e;if(this.c=In(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=y(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},En.prototype.stringify=function(t){return b.JSON.stringify(t,void 0)},En.prototype.parse=function(t){return b.JSON.parse(t,void 0)};var An=b.JSON.parse;function Sn(t){Ut.call(this),this.headers=new Fe,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Dn,this.D=this.F=!1}P(Sn,Ut);var Dn="",kn=/^https?$/i,xn=["POST","PUT"];function Rn(t){return"content-type"==t.toLowerCase()}function Pn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Ln(t),Cn(t)}function Ln(t){t.u||(t.u=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function On(t){if(t.b&&void 0!==w&&(!t.s[1]||4!=Un(t)||2!=t.X()))if(t.l&&4==Un(t))Jt(t.za,0,t);else if(t.dispatchEvent("readystatechange"),4==Un(t)){t.b=!1;try{var e,n=t.X();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.B).match(Be)[1]||null;if(!o&&b.self&&b.self.location){var s=b.self.location.protocol;o=s.substr(0,s.length-1)}i=!kn.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<Un(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.X()+"]",Ln(t)}}finally{Cn(t)}}}function Cn(t,e){if(t.a){Vn(t);var n=t.a,r=t.s[0]?I:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Vn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(b.clearTimeout(t.m),t.m=null)}function Un(t){return t.a?t.a.readyState:0}function Mn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return H(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Qe(t,e,n))}function qn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Fn(t){this.pa=0,this.g=[],this.c=new oe,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=qn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=qn("baseRetryDelayMs",5e3,t),this.Ma=qn("retryDelaySeedMs",1e4,t),this.Ja=qn("forwardChannelMaxRetries",2,t),this.ma=qn("forwardChannelRequestTimeoutMs",2e4,t),this.Ka=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new dn(t&&t.concurrentRequestLimit),this.ka=new Tn,this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function jn(t){if(Bn(t),3==t.v){var e=t.R++,n=He(t.B);Qe(n,"SID",t.J),Qe(n,"RID",e),Qe(n,"TYPE","terminate"),Wn(t,n),(e=new _e(t,t.c,e,void 0)).H=2,e.i=Ze(He(n)),n=!1,b.navigator&&b.navigator.sendBeacon&&(n=b.navigator.sendBeacon(e.i.toString(),"")),!n&&b.Image&&((new Image).src=e.i,n=!0),n||(e.a=or(e.g,null),e.a.ba(e.i)),e.u=R(),Le(e)}rr(t)}function Gn(t){t.a&&(Zn(t),t.a.cancel(),t.a=null)}function Bn(t){Gn(t),t.j&&(b.clearTimeout(t.j),t.j=null),$n(t),t.b.cancel(),t.h&&("number"==typeof t.h&&b.clearTimeout(t.h),t.h=null)}function zn(t,e){t.g.push(new pn(t.La++,e)),3==t.v&&Hn(t)}function Hn(t){yn(t.b)||t.h||(t.h=!0,Kt(t.Ba,t),t.u=0)}function Kn(t,e){var n;n=e?e.f:t.R++;var r=He(t.B);Qe(r,"SID",t.J),Qe(r,"RID",n),Qe(r,"AID",t.P),Wn(t,r),t.i&&t.l&&Mn(r,t.i,t.l),n=new _e(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Yn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),wn(t.b,n),ke(n,r,e)}function Wn(t,e){t.f&&qe({},(function(t,n){Qe(e,n,t)}))}function Yn(t,e,n){n=Math.min(t.g.length,n);var r=t.f?k(t.f.Ha,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].b,h=i[a].a;if(0>(c-=o))o=Math.max(0,i[a].b-100),u=!1;else try{Nn(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(u){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function Xn(t){t.a||t.j||(t.U=1,Kt(t.Aa,t),t.o=0)}function Qn(t){return!(t.a||t.j||3<=t.o)&&(t.U++,t.j=de(k(t.Aa,t),er(t,t.o)),t.o++,!0)}function Zn(t){null!=t.s&&(b.clearTimeout(t.s),t.s=null)}function Jn(t){t.a=new _e(t,t.c,"rpc",t.U),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=He(t.la);Qe(e,"RID","rpc"),Qe(e,"SID",t.J),Qe(e,"CI",t.H?"0":"1"),Qe(e,"AID",t.P),Wn(t,e),Qe(e,"TYPE","xmlhttp"),t.i&&t.l&&Mn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Ze(He(e)),n.j=null,n.I=!0,xe(n,t)}function $n(t){null!=t.m&&(b.clearTimeout(t.m),t.m=null)}function tr(t,e){var n=null;if(t.a==e){$n(t),Zn(t),t.a=null;var r=2}else{if(!mn(t.b,e))return;n=e.s,bn(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=R()-e.u;var i=t.u;(r=ae()).dispatchEvent(new pe(r,n,e,i)),Hn(t)}else Xn(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(gn(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.g=e.s.concat(t.g),!0):!(1==t.v||2==t.v||t.u>=(t.Ia?0:t.Ja))&&(t.h=de(k(t.Ba,t,e),er(t,t.u)),t.u++,!0))}(t,e)||2==r&&Qn(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:nr(t,5);break;case 4:nr(t,10);break;case 3:nr(t,6);break;default:nr(t,2)}}function er(t,e){var n=t.Fa+Math.floor(Math.random()*t.Ma);return t.f||(n*=2),n*e}function nr(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=k(t.Xa,t);n||(n=new ze("//www.google.com/images/cleardot.gif"),b.location&&"http"==b.location.protocol||Ke(n,"https"),Ze(n)),function(t,e){var n=new oe;if(b.Image){var r=new Image;r.onload=x(_n,n,r,"TestLoadImage: loaded",!0,e),r.onerror=x(_n,n,r,"TestLoadImage: error",!1,e),r.onabort=x(_n,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=x(_n,n,r,"TestLoadImage: timeout",!1,e),b.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else le(2);t.v=0,t.f&&t.f.ra(e),rr(t),Bn(t)}function rr(t){t.v=0,t.I=-1,t.f&&(0==In(t.b).length&&0==t.g.length||(t.b.c.length=0,U(t.g),t.g.length=0),t.f.qa())}function ir(t,e,n){var r=function(t){return t instanceof ze?He(t):new ze(t,void 0)}(n);if(""!=r.c)e&&We(r,e+"."+r.c),Ye(r,r.h);else{var i=b.location;r=function(t,e,n,r){var i=new ze(null,void 0);return t&&Ke(i,t),e&&We(i,e),n&&Ye(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.W&&H(t.W,(function(t,e){Qe(r,e,t)})),e=t.A,n=t.na,e&&n&&Qe(r,e,n),Qe(r,"VER",t.ha),Wn(t,r),r}function or(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Sn(t.Ka)).F=t.C,e}function sr(){}function ur(){if($&&!(10<=Number(lt)))throw Error("Environmental error: no available transport.")}function ar(t,e){Ut.call(this),this.a=new Fn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!M(t)&&(this.a.i=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!M(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new fr(this)}function cr(t){Ee.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function hr(){Te.call(this),this.status=1}function fr(t){this.a=t}(g=Sn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?me(this.H):me(be),this.a.onreadystatechange=k(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Pn(this,t)}t=n||"";var i=new Fe(this.headers);r&&qe(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=Rn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=b.FormData&&t instanceof b.FormData,!(0<=O(xn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Vn(this),0<this.o&&((this.D=function(t){return $&&ht(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=k(this.xa,this)):this.m=Jt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Pn(this,t)}},g.xa=function(){void 0!==w&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},g.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Cn(this))},g.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Cn(this,!0)),Sn.S.G.call(this)},g.za=function(){this.j||(this.A||this.l||this.g?On(this):this.Ta())},g.Ta=function(){On(this)},g.X=function(){try{return 2<Un(this)?this.a.status:-1}catch(t){return-1}},g.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},g.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),An(e)}},g.ua=function(){return this.h},g.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(g=Fn.prototype).ha=8,g.v=1,g.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new _e(this,this.c,t,void 0),r=this.l;if(this.O&&(r?Y(r=K(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Yn(this,n,e),Qe(i=He(this.B),"RID",t),Qe(i,"CVER",22),this.A&&Qe(i,"X-HTTP-Session-Id",this.A),Wn(this,i),this.i&&r&&Mn(i,this.i,r),wn(this.b,n),this.Ga&&Qe(i,"TYPE","init"),this.da?(Qe(i,"$req",e),Qe(i,"SID","null"),n.V=!0,ke(n,i,null)):ke(n,i,e),this.v=2}}else 3==this.v&&(t?Kn(this,t):0==this.g.length||yn(this.b)||Kn(this))},g.Aa=function(){if(this.j=null,Jn(this),this.V&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=de(k(this.Sa,this),t)}},g.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,Gn(this),Jn(this))},g.Ra=function(){null!=this.m&&(this.m=null,Gn(this),Qn(this),le(19))},g.Xa=function(t){t?(this.c.info("Successfully pinged google.com"),le(2)):(this.c.info("Failed to ping google.com"),le(1))},(g=sr.prototype).ta=function(){},g.sa=function(){},g.ra=function(){},g.qa=function(){},g.Ha=function(){},ur.prototype.a=function(t,e){return new ar(t,e)},P(ar,Ut),(g=ar.prototype).addEventListener=function(t,e,n,r){ar.S.addEventListener.call(this,t,e,n,r)},g.removeEventListener=function(t,e,n,r){ar.S.removeEventListener.call(this,t,e,n,r)},g.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var t=this.a,e=this.l,n=this.b||void 0;le(0),t.fa=e,t.W=n||{},t.H=t.T,t.B=ir(t,null,t.fa),Hn(t)},g.close=function(){jn(this.a)},g.Pa=function(t){if("string"==typeof t){var e={};e.__data__=t,zn(this.a,e)}else this.g?((e={}).__data__=qt(t),zn(this.a,e)):zn(this.a,t)},g.G=function(){this.a.f=null,delete this.f,jn(this.a),delete this.a,ar.S.G.call(this)},P(cr,Ee),P(hr,Te),P(fr,sr),fr.prototype.ta=function(){this.a.dispatchEvent("a")},fr.prototype.sa=function(t){this.a.dispatchEvent(new cr(t))},fr.prototype.ra=function(t){this.a.dispatchEvent(new hr(t))},fr.prototype.qa=function(){this.a.dispatchEvent("b")},ur.prototype.createWebChannel=ur.prototype.a,ar.prototype.send=ar.prototype.Pa,ar.prototype.open=ar.prototype.Oa,ar.prototype.close=ar.prototype.close,ve.NO_ERROR=0,ve.TIMEOUT=8,ve.HTTP_ERROR=6,ye.COMPLETE="complete",we.EventType=Ie,Ie.OPEN="a",Ie.CLOSE="b",Ie.ERROR="c",Ie.MESSAGE="d",Ut.prototype.listen=Ut.prototype.va,Sn.prototype.listenOnce=Sn.prototype.wa,Sn.prototype.getLastError=Sn.prototype.Qa,Sn.prototype.getLastErrorCode=Sn.prototype.ua,Sn.prototype.getStatus=Sn.prototype.X,Sn.prototype.getResponseJson=Sn.prototype.Na,Sn.prototype.getResponseText=Sn.prototype.$,Sn.prototype.send=Sn.prototype.ba;var lr={createWebChannelTransport:function(){return new ur},ErrorCode:ve,EventType:ye,WebChannel:we,XhrIo:Sn},pr=lr.createWebChannelTransport,dr=lr.ErrorCode,vr=lr.EventType,yr=lr.WebChannel,gr=lr.XhrIo,mr=new l("@firebase/firestore");function wr(){return mr.logLevel}function br(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(mr.logLevel<=f.DEBUG){var r=e.map(Tr);mr.debug.apply(mr,i(["Firestore (7.19.1): "+t],r))}}function Ir(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(mr.logLevel<=f.ERROR){var r=e.map(Tr);mr.error.apply(mr,i(["Firestore (7.19.1): "+t],r))}}function Er(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(mr.logLevel<=f.WARN){var r=e.map(Tr);mr.warn.apply(mr,i(["Firestore (7.19.1): "+t],r))}}function Tr(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (7.19.1) INTERNAL ASSERTION FAILED: "+t;throw Ir(e),new Error(e)}function _r(t,e){t||Nr()}function Ar(t,e){return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Dr=function(){function t(){}return t.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Sr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function kr(t,e){return t<e?-1:t>e?1:0}function xr(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function Rr(t){return t+"\0"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Pr=function(t,e,n,r,i){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},Lr=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"i",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.o=function(t){return kr(this.projectId,t.projectId)||kr(this.database,t.database)},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Or(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Cr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Vr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ur=function(){function t(t,e){this.h=t,this.u=e,this.l={}}return t.prototype.get=function(t){var e=this.h(t),n=this.l[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.u(s,t))return u}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.h(t),r=this.l[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.u(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.l[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.h(t),n=this.l[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.u(n[r][0],t))return 1===n.length?delete this.l[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Cr(this.l,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];t(s,u)}}))},t.prototype._=function(){return Vr(this.l)},t}(),Mr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},qr=function(e){function n(t,n){var r=this;return(r=e.call(this,n)||this).code=t,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return t(n,e),n}(Error),Fr=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new qr(Mr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new qr(Mr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new qr(Mr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new qr(Mr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.T=function(t){return this.seconds===t.seconds?kr(this.nanoseconds,t.nanoseconds):kr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),jr=function(){function t(t){this.timestamp=t}return t.I=function(e){return new t(e)},t.min=function(){return new t(new Fr(0,0))},t.prototype.o=function(t){return this.timestamp.T(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.m=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.A=function(){return this.timestamp},t}(),Gr=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Nr(),void 0===n?n=t.length-e:n>t.length-e&&Nr(),this.segments=t,this.offset=e,this.R=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.R},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.P(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.g(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.V=function(t){return t=void 0===t?1:t,this.g(this.segments,this.offset+t,this.length-t)},t.prototype.p=function(){return this.g(this.segments,this.offset,this.length-1)},t.prototype.v=function(){return this.segments[this.offset]},t.prototype.S=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype._=function(){return 0===this.length},t.prototype.D=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.C=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.N=function(){return this.segments.slice(this.offset,this.limit())},t.P=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Br=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.g=function(t,e,r){return new n(t,e,r)},n.prototype.F=function(){return this.N().join("/")},n.prototype.toString=function(){return this.F()},n.k=function(t){if(t.indexOf("//")>=0)throw new qr(Mr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new n(t.split("/").filter((function(t){return t.length>0})))},n.$=function(){return new n([])},n}(Gr),zr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Hr=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.g=function(t,e,r){return new n(t,e,r)},n.O=function(t){return zr.test(t)},n.prototype.F=function(){return this.N().map((function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),n.O(t)||(t="`"+t+"`"),t})).join(".")},n.prototype.toString=function(){return this.F()},n.prototype.M=function(){return 1===this.length&&"__name__"===this.get(0)},n.L=function(){return new n(["__name__"])},n.q=function(t){for(var e=[],r="",i=0,o=function(){if(0===r.length)throw new qr(Mr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(r),r=""},s=!1;i<t.length;){var u=t[i];if("\\"===u){if(i+1===t.length)throw new qr(Mr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[i+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new qr(Mr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=a,i+=2}else"`"===u?(s=!s,i++):"."!==u||s?(r+=u,i++):(o(),i++)}if(o(),s)throw new qr(Mr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)},n.$=function(){return new n([])},n}(Gr),Kr=function(){function t(t){this.path=t}return t.B=function(e){return new t(Br.k(e))},t.U=function(e){return new t(Br.k(e).V(5))},t.prototype.W=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Br.P(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.P=function(t,e){return Br.P(t.path,e.path)},t.j=function(t){return t.length%2==0},t.K=function(e){return new t(new Br(e.slice()))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wr(t){return null==t}function Yr(t){return-0===t&&1/t==-1/0}function Xr(t){return"number"==typeof t&&Number.isInteger(t)&&!Yr(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qr=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.G=null};function Zr(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Qr(t,e,n,r,i,o,s)}function Jr(t){var e=Ar(t);if(null===e.G){var n=e.path.F();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.F()+t.op.toString()+Bi(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return(e=t).field.F()+e.dir;var e})).join(","),Wr(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Gs(e.startAt)),e.endAt&&(n+="|ub:",n+=Gs(e.endAt)),e.G=n}return e.G}function $r(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Ws(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!qi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!zs(t.startAt,e.startAt)&&zs(t.endAt,e.endAt)}function ti(t){return Kr.j(t.path)&&null===t.collectionGroup&&0===t.filters.length}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ei=function(){function t(t){this.H=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.H,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.H)},t.prototype.Y=function(){return 2*this.H.length},t.prototype.o=function(t){return kr(this.H,t.H)},t.prototype.isEqual=function(t){return this.H===t.H},t}();ei.J=new ei("");var ni,ri,ii=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=jr.min()),void 0===o&&(o=jr.min()),void 0===s&&(s=ei.J),this.target=t,this.targetId=e,this.X=n,this.sequenceNumber=r,this.Z=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.tt=function(e){return new t(this.target,this.targetId,this.X,e,this.Z,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.et=function(e,n){return new t(this.target,this.targetId,this.X,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.nt=function(e){return new t(this.target,this.targetId,this.X,this.sequenceNumber,this.Z,e,this.resumeToken)},t}(),oi=function(t){this.count=t};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function si(t){switch(t){case Mr.OK:return Nr();case Mr.CANCELLED:case Mr.UNKNOWN:case Mr.DEADLINE_EXCEEDED:case Mr.RESOURCE_EXHAUSTED:case Mr.INTERNAL:case Mr.UNAVAILABLE:case Mr.UNAUTHENTICATED:return!1;case Mr.INVALID_ARGUMENT:case Mr.NOT_FOUND:case Mr.ALREADY_EXISTS:case Mr.PERMISSION_DENIED:case Mr.FAILED_PRECONDITION:case Mr.ABORTED:case Mr.OUT_OF_RANGE:case Mr.UNIMPLEMENTED:case Mr.DATA_LOSS:return!0;default:return Nr()}}function ui(t){if(void 0===t)return Ir("GRPC error has no .code"),Mr.UNKNOWN;switch(t){case ni.OK:return Mr.OK;case ni.CANCELLED:return Mr.CANCELLED;case ni.UNKNOWN:return Mr.UNKNOWN;case ni.DEADLINE_EXCEEDED:return Mr.DEADLINE_EXCEEDED;case ni.RESOURCE_EXHAUSTED:return Mr.RESOURCE_EXHAUSTED;case ni.INTERNAL:return Mr.INTERNAL;case ni.UNAVAILABLE:return Mr.UNAVAILABLE;case ni.UNAUTHENTICATED:return Mr.UNAUTHENTICATED;case ni.INVALID_ARGUMENT:return Mr.INVALID_ARGUMENT;case ni.NOT_FOUND:return Mr.NOT_FOUND;case ni.ALREADY_EXISTS:return Mr.ALREADY_EXISTS;case ni.PERMISSION_DENIED:return Mr.PERMISSION_DENIED;case ni.FAILED_PRECONDITION:return Mr.FAILED_PRECONDITION;case ni.ABORTED:return Mr.ABORTED;case ni.OUT_OF_RANGE:return Mr.OUT_OF_RANGE;case ni.UNIMPLEMENTED:return Mr.UNIMPLEMENTED;case ni.DATA_LOSS:return Mr.DATA_LOSS;default:return Nr()}}(ri=ni||(ni={}))[ri.OK=0]="OK",ri[ri.CANCELLED=1]="CANCELLED",ri[ri.UNKNOWN=2]="UNKNOWN",ri[ri.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ri[ri.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ri[ri.NOT_FOUND=5]="NOT_FOUND",ri[ri.ALREADY_EXISTS=6]="ALREADY_EXISTS",ri[ri.PERMISSION_DENIED=7]="PERMISSION_DENIED",ri[ri.UNAUTHENTICATED=16]="UNAUTHENTICATED",ri[ri.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ri[ri.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ri[ri.ABORTED=10]="ABORTED",ri[ri.OUT_OF_RANGE=11]="OUT_OF_RANGE",ri[ri.UNIMPLEMENTED=12]="UNIMPLEMENTED",ri[ri.INTERNAL=13]="INTERNAL",ri[ri.UNAVAILABLE=14]="UNAVAILABLE",ri[ri.DATA_LOSS=15]="DATA_LOSS";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ai=function(){function t(t,e){this.P=t,this.root=e||hi.EMPTY}return t.prototype.st=function(e,n){return new t(this.P,this.root.st(e,n,this.P).copy(null,null,hi.it,null,null))},t.prototype.remove=function(e){return new t(this.P,this.root.remove(e,this.P).copy(null,null,hi.it,null,null))},t.prototype.get=function(t){for(var e=this.root;!e._();){var n=this.P(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n._();){var r=this.P(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype._=function(){return this.root._()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.rt=function(){return this.root.rt()},t.prototype.ot=function(){return this.root.ot()},t.prototype.ht=function(t){return this.root.ht(t)},t.prototype.forEach=function(t){this.ht((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.ht((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.at=function(t){return this.root.at(t)},t.prototype.ut=function(){return new ci(this.root,null,this.P,!1)},t.prototype.ct=function(t){return new ci(this.root,t,this.P,!1)},t.prototype.lt=function(){return new ci(this.root,null,this.P,!0)},t.prototype._t=function(t){return new ci(this.root,t,this.P,!0)},t}(),ci=function(){function t(t,e,n,r){this.ft=r,this.dt=[];for(var i=1;!t._();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.ft?t.left:t.right;else{if(0===i){this.dt.push(t);break}this.dt.push(t),t=this.ft?t.right:t.left}}return t.prototype.wt=function(){var t=this.dt.pop(),e={key:t.key,value:t.value};if(this.ft)for(t=t.left;!t._();)this.dt.push(t),t=t.right;else for(t=t.right;!t._();)this.dt.push(t),t=t.left;return e},t.prototype.Tt=function(){return this.dt.length>0},t.prototype.Et=function(){if(0===this.dt.length)return null;var t=this.dt[this.dt.length-1];return{key:t.key,value:t.value}},t}(),hi=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype._=function(){return!1},t.prototype.ht=function(t){return this.left.ht(t)||t(this.key,this.value)||this.right.ht(t)},t.prototype.at=function(t){return this.right.at(t)||t(this.key,this.value)||this.left.at(t)},t.prototype.min=function(){return this.left._()?this:this.left.min()},t.prototype.rt=function(){return this.min().key},t.prototype.ot=function(){return this.right._()?this.key:this.right.ot()},t.prototype.st=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.st(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.st(t,e,n))).It()},t.prototype.At=function(){if(this.left._())return t.EMPTY;var e=this;return e.left.Rt()||e.left.left.Rt()||(e=e.Pt()),(e=e.copy(null,null,null,e.left.At(),null)).It()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left._()||i.left.Rt()||i.left.left.Rt()||(i=i.Pt()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.Rt()&&(i=i.gt()),i.right._()||i.right.Rt()||i.right.left.Rt()||(i=i.Vt()),0===n(e,i.key)){if(i.right._())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.At())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.It()},t.prototype.Rt=function(){return this.color},t.prototype.It=function(){var t=this;return t.right.Rt()&&!t.left.Rt()&&(t=t.yt()),t.left.Rt()&&t.left.left.Rt()&&(t=t.gt()),t.left.Rt()&&t.right.Rt()&&(t=t.pt()),t},t.prototype.Pt=function(){var t=this.pt();return t.right.left.Rt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.gt())).yt()).pt()),t},t.prototype.Vt=function(){var t=this.pt();return t.left.left.Rt()&&(t=(t=t.gt()).pt()),t},t.prototype.yt=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.gt=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.pt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.bt=function(){var t=this.vt();return Math.pow(2,t)<=this.size+1},t.prototype.vt=function(){if(this.Rt()&&this.left.Rt())throw Nr();if(this.right.Rt())throw Nr();var t=this.left.vt();if(t!==this.right.vt())throw Nr();return t+(this.Rt()?0:1)},t}();hi.EMPTY=null,hi.RED=!0,hi.it=!1,hi.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Nr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Nr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Nr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Nr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Nr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.st=function(t,e,n){return new hi(t,e)},t.prototype.remove=function(t,e){return this},t.prototype._=function(){return!0},t.prototype.ht=function(t){return!1},t.prototype.at=function(t){return!1},t.prototype.rt=function(){return null},t.prototype.ot=function(){return null},t.prototype.Rt=function(){return!1},t.prototype.bt=function(){return!0},t.prototype.vt=function(){return 0},t}());
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var fi=function(){function t(t){this.P=t,this.data=new ai(this.P)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.rt()},t.prototype.last=function(){return this.data.ot()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.ht((function(e,n){return t(e),!1}))},t.prototype.St=function(t,e){for(var n=this.data.ct(t[0]);n.Tt();){var r=n.wt();if(this.P(r.key,t[1])>=0)return;e(r.key)}},t.prototype.Dt=function(t,e){var n;for(n=void 0!==e?this.data.ct(e):this.data.ut();n.Tt();)if(!t(n.wt().key))return},t.prototype.Ct=function(t){var e=this.data.ct(t);return e.Tt()?e.wt().key:null},t.prototype.ut=function(){return new li(this.data.ut())},t.prototype.ct=function(t){return new li(this.data.ct(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).st(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype._=function(){return this.data._()},t.prototype.Nt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.ut(),r=e.data.ut();n.Tt();){var i=n.wt().key,o=r.wt().key;if(0!==this.P(i,o))return!1}return!0},t.prototype.N=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.P);return n.data=e,n},t}(),li=function(){function t(t){this.Ft=t}return t.prototype.wt=function(){return this.Ft.wt().key},t.prototype.Tt=function(){return this.Ft.Tt()},t}(),pi=new ai(Kr.P);function di(){return pi}function vi(){return di()}var yi=new ai(Kr.P);function gi(){return yi}var mi=new ai(Kr.P),wi=new fi(Kr.P);function bi(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=wi,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Ii=new fi(kr);function Ei(){return Ii}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ti=function(){function t(t){this.P=t?function(e,n){return t(e,n)||Kr.P(e.key,n.key)}:function(t,e){return Kr.P(t.key,e.key)},this.kt=gi(),this.$t=new ai(this.P)}return t.xt=function(e){return new t(e.P)},t.prototype.has=function(t){return null!=this.kt.get(t)},t.prototype.get=function(t){return this.kt.get(t)},t.prototype.first=function(){return this.$t.rt()},t.prototype.last=function(){return this.$t.ot()},t.prototype._=function(){return this.$t._()},t.prototype.indexOf=function(t){var e=this.kt.get(t);return e?this.$t.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.$t.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.$t.ht((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.kt.st(t.key,t),e.$t.st(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.kt.remove(t),this.$t.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.$t.ut(),r=e.$t.ut();n.Tt();){var i=n.wt().key,o=r.wt().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.P=this.P,r.kt=e,r.$t=n,r},t}(),Ni=function(){function t(){this.Ot=new ai(Kr.P)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Ot.get(e);n?0!==t.type&&3===n.type?this.Ot=this.Ot.st(e,t):3===t.type&&1!==n.type?this.Ot=this.Ot.st(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Ot=this.Ot.st(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Ot=this.Ot.st(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Ot=this.Ot.remove(e):1===t.type&&2===n.type?this.Ot=this.Ot.st(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Ot=this.Ot.st(e,{type:2,doc:t.doc}):Nr():this.Ot=this.Ot.st(e,t)},t.prototype.Mt=function(){var t=[];return this.Ot.ht((function(e,n){t.push(n)})),t},t}(),_i=function(){function t(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Lt=n,this.docChanges=r,this.qt=i,this.fromCache=o,this.Bt=s,this.Ut=u}return t.Qt=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,Ti.xt(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.qt._()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Bt===t.Bt&&this.qt.isEqual(t.qt)&&Ss(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Lt.isEqual(t.Lt)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Ai=function(){function t(t,e,n,r,i){this.Z=t,this.Wt=e,this.jt=n,this.Kt=r,this.Gt=i}return t.zt=function(e,n){var r=new Map;return r.set(e,Si.Ht(e,n)),new t(jr.min(),r,Ei(),di(),bi())},t}(),Si=function(){function t(t,e,n,r,i){this.resumeToken=t,this.Yt=e,this.Jt=n,this.Xt=r,this.Zt=i}return t.Ht=function(e,n){return new t(ei.J,n,bi(),bi(),bi())},t}(),Di=function(t,e,n,r){this.te=t,this.removedTargetIds=e,this.key=n,this.ee=r},ki=function(t,e){this.targetId=t,this.ne=e},xi=function(t,e,n,r){void 0===n&&(n=ei.J),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Ri=function(){function t(){this.se=0,this.ie=Oi(),this.re=ei.J,this.oe=!1,this.he=!0}return Object.defineProperty(t.prototype,"Yt",{get:function(){return this.oe},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.re},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ae",{get:function(){return 0!==this.se},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ue",{get:function(){return this.he},enumerable:!1,configurable:!0}),t.prototype.ce=function(t){t.Y()>0&&(this.he=!0,this.re=t)},t.prototype.le=function(){var t=bi(),e=bi(),n=bi();return this.ie.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Nr()}})),new Si(this.re,this.oe,t,e,n)},t.prototype._e=function(){this.he=!1,this.ie=Oi()},t.prototype.fe=function(t,e){this.he=!0,this.ie=this.ie.st(t,e)},t.prototype.de=function(t){this.he=!0,this.ie=this.ie.remove(t)},t.prototype.we=function(){this.se+=1},t.prototype.Te=function(){this.se-=1},t.prototype.Ee=function(){this.he=!0,this.oe=!0},t}(),Pi=function(){function t(t){this.Ie=t,this.me=new Map,this.Ae=di(),this.Re=Li(),this.Pe=new fi(kr)}return t.prototype.ge=function(t){for(var e=0,n=t.te;e<n.length;e++){var r=n[e];t.ee instanceof ds?this.Ve(r,t.ee):t.ee instanceof vs&&this.ye(r,t.key,t.ee)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.ye(s,t.key,t.ee)}},t.prototype.pe=function(t){var e=this;this.be(t,(function(n){var r=e.ve(n);switch(t.state){case 0:e.Se(n)&&r.ce(t.resumeToken);break;case 1:r.Te(),r.ae||r._e(),r.ce(t.resumeToken);break;case 2:r.Te(),r.ae||e.removeTarget(n);break;case 3:e.Se(n)&&(r.Ee(),r.ce(t.resumeToken));break;case 4:e.Se(n)&&(e.De(n),r.ce(t.resumeToken));break;default:Nr()}}))},t.prototype.be=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.me.forEach((function(t,r){n.Se(r)&&e(r)}))},t.prototype.Ce=function(t){var e=t.targetId,n=t.ne.count,r=this.Ne(e);if(r){var i=r.target;if(ti(i))if(0===n){var o=new Kr(i.path);this.ye(e,o,new vs(o,jr.min()))}else _r(1===n);else this.Fe(e)!==n&&(this.De(e),this.Pe=this.Pe.add(e))}},t.prototype.ke=function(t){var e=this,n=new Map;this.me.forEach((function(r,i){var o=e.Ne(i);if(o){if(r.Yt&&ti(o.target)){var s=new Kr(o.target.path);null!==e.Ae.get(s)||e.$e(i,s)||e.ye(i,s,new vs(s,t))}r.ue&&(n.set(i,r.le()),r._e())}}));var r=bi();this.Re.forEach((function(t,n){var i=!0;n.Dt((function(t){var n=e.Ne(t);return!n||2===n.X||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new Ai(t,n,this.Pe,this.Ae,r);return this.Ae=di(),this.Re=Li(),this.Pe=new fi(kr),i},t.prototype.Ve=function(t,e){if(this.Se(t)){var n=this.$e(t,e.key)?2:0;this.ve(t).fe(e.key,n),this.Ae=this.Ae.st(e.key,e),this.Re=this.Re.st(e.key,this.xe(e.key).add(t))}},t.prototype.ye=function(t,e,n){if(this.Se(t)){var r=this.ve(t);this.$e(t,e)?r.fe(e,1):r.de(e),this.Re=this.Re.st(e,this.xe(e).delete(t)),n&&(this.Ae=this.Ae.st(e,n))}},t.prototype.removeTarget=function(t){this.me.delete(t)},t.prototype.Fe=function(t){var e=this.ve(t).le();return this.Ie.Oe(t).size+e.Jt.size-e.Zt.size},t.prototype.we=function(t){this.ve(t).we()},t.prototype.ve=function(t){var e=this.me.get(t);return e||(e=new Ri,this.me.set(t,e)),e},t.prototype.xe=function(t){var e=this.Re.get(t);return e||(e=new fi(kr),this.Re=this.Re.st(t,e)),e},t.prototype.Se=function(t){var e=null!==this.Ne(t);return e||br("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.Ne=function(t){var e=this.me.get(t);return e&&e.ae?null:this.Ie.Me(t)},t.prototype.De=function(t){var e=this;this.me.set(t,new Ri),this.Ie.Oe(t).forEach((function(n){e.ye(t,n,null)}))},t.prototype.$e=function(t,e){return this.Ie.Oe(t).has(e)},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Li(){return new ai(Kr.P)}function Oi(){return new ai(Kr.P)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ci(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Vi(t){var e=zi(t.mapValue.fields.__local_write_time__.timestampValue);return new Fr(e.seconds,e.nanos)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ui=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Mi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ci(t)?4:10:Nr()}function qi(t,e){var n=Mi(t);if(n!==Mi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Vi(t).isEqual(Vi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=zi(t.timestampValue),r=zi(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Ki(t.bytesValue).isEqual(Ki(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Hi(t.geoPointValue.latitude)===Hi(e.geoPointValue.latitude)&&Hi(t.geoPointValue.longitude)===Hi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Hi(t.integerValue)===Hi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Hi(t.doubleValue),r=Hi(e.doubleValue);return n===r?Yr(n)===Yr(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return xr(t.arrayValue.values||[],e.arrayValue.values||[],qi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Or(n)!==Or(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!qi(n[i],r[i])))return!1;return!0}(t,e);default:return Nr()}}function Fi(t,e){return void 0!==(t.values||[]).find((function(t){return qi(t,e)}))}function ji(t,e){var n=Mi(t),r=Mi(e);if(n!==r)return kr(n,r);switch(n){case 0:return 0;case 1:return kr(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Hi(t.integerValue||t.doubleValue),r=Hi(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Gi(t.timestampValue,e.timestampValue);case 4:return Gi(Vi(t),Vi(e));case 5:return kr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Ki(t),r=Ki(e);return n.o(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=kr(n[i],r[i]);if(0!==o)return o}return kr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=kr(Hi(t.latitude),Hi(e.latitude));return 0!==n?n:kr(Hi(t.longitude),Hi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=ji(n[i],r[i]);if(o)return o}return kr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=kr(r[s],o[s]);if(0!==u)return u;var a=ji(n[r[s]],i[o[s]]);if(0!==a)return a}return kr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Nr()}}function Gi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return kr(t,e);var n=zi(t),r=zi(e),i=kr(n.seconds,r.seconds);return 0!==i?i:kr(n.nanos,r.nanos)}function Bi(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var e=zi(t);return"time("+e.seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ki(e.bytesValue).toBase64():"referenceValue"in e?(r=e.referenceValue,Kr.U(r).toString()):"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,i=0,o=e.values||[];i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=t(s)}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=s+":"+t(e.fields[s])}return n+"}"}(e.mapValue):Nr();var n,r}(t)}function zi(t){if(_r(!!t),"string"==typeof t){var e=0,n=Ui.exec(t);if(_r(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Hi(t.seconds),nanos:Hi(t.nanos)}}function Hi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Ki(t){return"string"==typeof t?ei.fromBase64String(t):ei.fromUint8Array(t)}function Wi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.F()}}function Yi(t){return!!t&&"integerValue"in t}function Xi(t){return!!t&&"arrayValue"in t}function Qi(t){return!!t&&"nullValue"in t}function Zi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ji(t){return!!t&&"mapValue"in t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $i={asc:"ASCENDING",desc:"DESCENDING"},to={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},eo=function(t,e){this.s=t,this.Le=e};function no(t){return{integerValue:""+t}}function ro(t,e){if(t.Le){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Yr(e)?"-0":e}}function io(t,e){return Xr(e)?no(e):ro(t,e)}function oo(t,e){return t.Le?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function so(t,e){return t.Le?e.toBase64():e.toUint8Array()}function uo(t,e){return oo(t,e.A())}function ao(t){return _r(!!t),jr.I(function(t){var e=zi(t);return new Fr(e.seconds,e.nanos)}(t))}function co(t,e){return function(t){return new Br(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).F()}function ho(t){var e=Br.k(t);return _r(Po(e)),e}function fo(t,e){return co(t.s,e.path)}function lo(t,e){var n=ho(e);return _r(n.get(1)===t.s.projectId),_r(!n.get(3)&&!t.s.database||n.get(3)===t.s.database),new Kr(go(n))}function po(t,e){return co(t.s,e)}function vo(t){var e=ho(t);return 4===e.length?Br.$():go(e)}function yo(t){return new Br(["projects",t.s.projectId,"databases",t.s.database]).F()}function go(t){return _r(t.length>4&&"documents"===t.get(4)),t.V(5)}function mo(t,e,n){return{name:fo(t,e),fields:n.proto.mapValue.fields}}function wo(t,e){var n;if(e instanceof ns)n={update:mo(t,e.key,e.value)};else if(e instanceof as)n={delete:fo(t,e.key)};else if(e instanceof rs)n={update:mo(t,e.key,e.data),updateMask:Ro(e.qe)};else if(e instanceof os)n={transform:{document:fo(t,e.key),fieldTransforms:e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof Uo)return{fieldPath:e.field.F(),setToServerValue:"REQUEST_TIME"};if(n instanceof Mo)return{fieldPath:e.field.F(),appendMissingElements:{values:n.elements}};if(n instanceof Fo)return{fieldPath:e.field.F(),removeAllFromArray:{values:n.elements}};if(n instanceof Go)return{fieldPath:e.field.F(),increment:n.Be};throw Nr()}(0,t)}))}};else{if(!(e instanceof cs))return Nr();n={verify:fo(t,e.key)}}return e.Qe.Ue||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:uo(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Nr()}(t,e.Qe)),n}function bo(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Yo.updateTime(ao(t.updateTime)):void 0!==t.exists?Yo.exists(t.exists):Yo.We()}(e.currentDocument):Yo.We();if(e.update){e.update.name;var r=lo(t,e.update.name),i=new hs({mapValue:{fields:e.update.fields}});if(e.updateMask){var o=function(t){var e=t.fieldPaths||[];return new Ho(e.map((function(t){return Hr.q(t)})))}(e.updateMask);return new rs(r,i,o,n)}return new ns(r,i,n)}if(e.delete){var s=lo(t,e.delete);return new as(s,n)}if(e.transform){var u=lo(t,e.transform.document),a=e.transform.fieldTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)_r("REQUEST_TIME"===e.setToServerValue),n=new Uo;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new Mo(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new Fo(i)}else"increment"in e?n=new Go(t,e.increment):Nr();var o=Hr.q(e.fieldPath);return new Ko(o,n)}(t,e)}));return _r(!0===n.exists),new os(u,a)}if(e.verify){var c=lo(t,e.verify);return new cs(c,n)}return Nr()}function Io(t,e){return{documents:[po(t,e.path)]}}function Eo(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=po(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=po(t,r.p()),n.structuredQuery.from=[{collectionId:r.S()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(Zi(t.value))return{unaryFilter:{field:So(t.field),op:"IS_NAN"}};if(Qi(t.value))return{unaryFilter:{field:So(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Zi(t.value))return{unaryFilter:{field:So(t.field),op:"IS_NOT_NAN"}};if(Qi(t.value))return{unaryFilter:{field:So(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:So(t.field),op:Ao(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:So(t.field),direction:_o(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.Le||Wr(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=To(e.startAt)),e.endAt&&(n.structuredQuery.endAt=To(e.endAt)),n}function To(t){return{before:t.before,values:t.position}}function No(t){var e=!!t.before,n=t.values||[];return new js(n,e)}function _o(t){return $i[t]}function Ao(t){return to[t]}function So(t){return{fieldPath:t.F()}}function Do(t){return Hr.q(t.fieldPath)}function ko(t){return Ps.create(Do(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Nr()}}(t.fieldFilter.op),t.fieldFilter.value)}function xo(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Do(t.unaryFilter.field);return Ps.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Do(t.unaryFilter.field);return Ps.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Do(t.unaryFilter.field);return Ps.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Do(t.unaryFilter.field);return Ps.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Nr()}}function Ro(t){var e=[];return t.fields.forEach((function(t){return e.push(t.F())})),{fieldPaths:e}}function Po(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Lo=function(){this.je=void 0};function Oo(t,e,n){return t instanceof Uo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Mo?qo(t,e):t instanceof Fo?jo(t,e):function(t,e){var n=Vo(t,e),r=Bo(n)+Bo(t.Be);return Yi(n)&&Yi(t.Be)?no(r):ro(t.serializer,r)}(t,e)}function Co(t,e,n){return t instanceof Mo?qo(t,e):t instanceof Fo?jo(t,e):n}function Vo(t,e){return t instanceof Go?Yi(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Uo=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(Lo),Mo=function(e){function n(t){var n=this;return(n=e.call(this)||this).elements=t,n}return t(n,e),n}(Lo);function qo(t,e){for(var n=zo(e),r=function(t){n.some((function(e){return qi(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Fo=function(e){function n(t){var n=this;return(n=e.call(this)||this).elements=t,n}return t(n,e),n}(Lo);function jo(t,e){for(var n=zo(e),r=function(t){n=n.filter((function(e){return!qi(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Go=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).serializer=t,r.Be=n,r}return t(n,e),n}(Lo);function Bo(t){return Hi(t.integerValue||t.doubleValue)}function zo(t){return Xi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ho=function(){function t(t){this.fields=t,t.sort(Hr.P)}return t.prototype.Ke=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].D(t))return!0;return!1},t.prototype.isEqual=function(t){return xr(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),Ko=function(t,e){this.field=t,this.transform=e},Wo=function(t,e){this.version=t,this.transformResults=e},Yo=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.We=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"Ue",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Xo(t,e){return void 0!==t.updateTime?e instanceof ds&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof ds}var Qo=function(){};function Zo(t,e,n){return t instanceof ns?function(t,e,n){return new ds(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof rs?function(t,e,n){if(!Xo(t.Qe,e))return new ys(t.key,n.version);var r=is(t,e);return new ds(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof os?function(t,e,n){if(_r(null!=n.transformResults),!Xo(t.Qe,e))return new ys(t.key,n.version);var r=ss(t,e),i=function(t,e,n){var r=[];_r(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof ds&&(u=e.field(o.field)),r.push(Co(s,u,n[i]))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,s=us(t,r.data(),i);return new ds(t.key,o,s,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new vs(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function Jo(t,e,n,r){return t instanceof ns?function(t,e){if(!Xo(t.Qe,e))return e;var n=es(e);return new ds(t.key,n,t.value,{Ge:!0})}(t,e):t instanceof rs?function(t,e){if(!Xo(t.Qe,e))return e;var n=es(e),r=is(t,e);return new ds(t.key,n,r,{Ge:!0})}(t,e):t instanceof os?function(t,e,n,r){if(!Xo(t.Qe,e))return e;var i=ss(t,e),o=function(t,e,n,r){for(var i=[],o=0,s=t;o<s.length;o++){var u=s[o],a=u.transform,c=null;n instanceof ds&&(c=n.field(u.field)),null===c&&r instanceof ds&&(c=r.field(u.field)),i.push(Oo(a,c,e))}return i}(t.fieldTransforms,n,e,r),s=us(t,i.data(),o);return new ds(t.key,i.version,s,{Ge:!0})}(t,e,r,n):function(t,e){return Xo(t.Qe,e)?new vs(t.key,jr.min()):e}(t,e)}function $o(t,e){return t instanceof os?function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e instanceof ds?e.field(o.field):void 0,u=Vo(o.transform,s||null);null!=u&&(n=null==n?(new fs).set(o.field,u):n.set(o.field,u))}return n?n.ze():null}(t,e):null}function ts(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Qe.isEqual(e.Qe)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.qe.isEqual(e.qe):2!==t.type||xr(t.fieldTransforms,t.fieldTransforms,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Mo&&e instanceof Mo||t instanceof Fo&&e instanceof Fo?xr(t.elements,e.elements,qi):t instanceof Go&&e instanceof Go?qi(t.Be,e.Be):t instanceof Uo&&e instanceof Uo}(t.transform,e.transform)}(t,e)})))}function es(t){return t instanceof ds?t.version:jr.min()}var ns=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).key=t,i.value=n,i.Qe=r,i.type=0,i}return t(n,e),n}(Qo),rs=function(e){function n(t,n,r,i){var o=this;return(o=e.call(this)||this).key=t,o.data=n,o.qe=r,o.Qe=i,o.type=1,o}return t(n,e),n}(Qo);function is(t,e){return function(t,e){var n=new fs(e);return t.qe.fields.forEach((function(e){if(!e._()){var r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}})),n.ze()}(t,e instanceof ds?e.data():hs.empty())}var os=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).key=t,r.fieldTransforms=n,r.type=2,r.Qe=Yo.exists(!0),r}return t(n,e),n}(Qo);function ss(t,e){return e}function us(t,e,n){for(var r=new fs(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.ze()}var as=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).key=t,r.Qe=n,r.type=3,r}return t(n,e),n}(Qo),cs=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).key=t,r.Qe=n,r.type=4,r}return t(n,e),n}(Qo),hs=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t._())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Ji(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.S()])||null},t.prototype.isEqual=function(t){return qi(this.proto,t.proto)},t}(),fs=function(){function t(t){void 0===t&&(t=hs.empty()),this.He=t,this.Ye=new Map}return t.prototype.set=function(t,e){return this.Je(t,e),this},t.prototype.delete=function(t){return this.Je(t,null),this},t.prototype.Je=function(t,e){for(var n=this.Ye,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===Mi(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.S(),e)},t.prototype.ze=function(){var t=this.Xe(Hr.$(),this.Ye);return null!=t?new hs(t):this.He},t.prototype.Xe=function(t,e){var n=this,r=!1,i=this.He.field(t),o=Ji(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var s=n.Xe(t.child(i),e);null!=s&&(o[i]=s,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},t}();function ls(t){var e=[];return Cr(t.fields||{},(function(t,n){var r=new Hr([t]);if(Ji(n)){var i=ls(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var u=s[o];e.push(r.child(u))}}else e.push(r)})),new Ho(e)
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var ps=function(t,e){this.key=t,this.version=e},ds=function(e){function n(t,n,r,i){var o=this;return(o=e.call(this,t,n)||this).Ze=r,o.Ge=!!i.Ge,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return t(n,e),n.prototype.field=function(t){return this.Ze.field(t)},n.prototype.data=function(){return this.Ze},n.prototype.tn=function(){return this.Ze.proto},n.prototype.isEqual=function(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ge===t.Ge&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Ze.isEqual(t.Ze)},n.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Ze.toString()+", {hasLocalMutations: "+this.Ge+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return this.Ge||this.hasCommittedMutations},enumerable:!1,configurable:!0}),n}(ps),vs=function(e){function n(t,n,r){var i=this;return(i=e.call(this,t,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return t(n,e),n.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),n.prototype.isEqual=function(t){return t instanceof n&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},n}(ps),ys=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),n.prototype.isEqual=function(t){return t instanceof n&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},n}(ps);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gs(t,e){if(!(t instanceof e))throw e.name===t.constructor.name?new qr(Mr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass '"+e.name+"' from a different Firestore SDK?"):new qr(Mr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but was '"+t.constructor.name+"'");return t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ms=function(){function t(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.en=n,this.filters=r,this.limit=i,this.nn=o,this.startAt=s,this.endAt=u,this.sn=null,this.rn=null,this.startAt,this.endAt}return t.prototype.on=function(e){return new t(e,null,this.en.slice(),this.filters.slice(),this.limit,this.nn,this.startAt,this.endAt)},t.prototype.hn=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.en.length||1===this.en.length&&this.en[0].field.M())},t.prototype.an=function(){return!Wr(this.limit)&&"F"===this.nn},t.prototype.un=function(){return!Wr(this.limit)&&"L"===this.nn},t.prototype.cn=function(){return this.en.length>0?this.en[0].field:null},t.prototype.ln=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n._n())return n.field}return null},t.prototype.fn=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(t.indexOf(r.op)>=0)return r.op}return null},t}();function ws(t,e,n,r,i,o,s,u){return new ms(t,e,n,r,i,o,s,u)}function bs(t){return new ms(t)}function Is(t){return null!==t.collectionGroup}function Es(t){var e=gs(t,ms);if(null===e.sn){e.sn=[];var n=e.ln(),r=e.cn();if(null!==n&&null===r)n.M()||e.sn.push(new Hs(n)),e.sn.push(new Hs(Hr.L(),"asc"));else{for(var i=!1,o=0,s=e.en;o<s.length;o++){var u=s[o];e.sn.push(u),u.field.M()&&(i=!0)}if(!i){var a=e.en.length>0?e.en[e.en.length-1].dir:"asc";e.sn.push(new Hs(Hr.L(),a))}}}return e.sn}function Ts(t){var e=gs(t,ms);if(!e.rn)if("F"===e.nn)e.rn=Zr(e.path,e.collectionGroup,Es(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Es(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Hs(o.field,s))}var u=e.endAt?new js(e.endAt.position,!e.endAt.before):null,a=e.startAt?new js(e.startAt.position,!e.startAt.before):null;e.rn=Zr(e.path,e.collectionGroup,n,e.filters,e.limit,u,a)}return e.rn}function Ns(t,e,n){return new ms(t.path,t.collectionGroup,t.en.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function _s(t,e){return new ms(t.path,t.collectionGroup,t.en.slice(),t.filters.slice(),t.limit,t.nn,e,t.endAt)}function As(t,e){return new ms(t.path,t.collectionGroup,t.en.slice(),t.filters.slice(),t.limit,t.nn,t.startAt,e)}function Ss(t,e){return $r(Ts(t),Ts(e))&&t.nn===e.nn}function Ds(t){return Jr(Ts(t))+"|lt:"+t.nn}function ks(t){return"Query(target="+function(t){var e=t.path.F();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.F()+" "+e.op+" "+Bi(e.value);var e})).join(", ")+"]"),Wr(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return(e=t).field.F()+" ("+e.dir+")";var e})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Gs(t.startAt)),t.endAt&&(e+=", endAt: "+Gs(t.endAt)),"Target("+e+")"}(Ts(t))+"; limitType="+t.nn+")"}function xs(t,e){return function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.W(t.collectionGroup)&&t.path.D(n):Kr.j(t.path)?t.path.isEqual(n):t.path.C(n)}(t,e)&&function(t,e){for(var n=0,r=t.en;n<r.length;n++){var i=r[n];if(!i.field.M()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Bs(t.startAt,Es(t),e)||t.endAt&&Bs(t.endAt,Es(t),e))}(t,e)}function Rs(t){return function(e,n){for(var r=!1,i=0,o=Es(t);i<o.length;i++){var s=o[i],u=Ks(s,e,n);if(0!==u)return u;r=r||s.field.M()}return 0}}var Ps=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).field=t,i.op=n,i.value=r,i}return t(n,e),n.create=function(t,e,r){if(t.M())return"in"===e||"not-in"===e?this.dn(t,e,r):new Ls(t,e,r);if(Qi(r)){if("=="!==e&&"!="!==e)throw new qr(Mr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new n(t,e,r)}if(Zi(r)){if("=="!==e&&"!="!==e)throw new qr(Mr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new n(t,e,r)}return"array-contains"===e?new Us(t,r):"in"===e?new Ms(t,r):"not-in"===e?new qs(t,r):"array-contains-any"===e?new Fs(t,r):new n(t,e,r)},n.dn=function(t,e,n){return"in"===e?new Os(t,n):new Cs(t,n)},n.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this.wn(ji(e,this.value)):null!==e&&Mi(this.value)===Mi(e)&&this.wn(ji(e,this.value))},n.prototype.wn=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Nr()}},n.prototype._n=function(){return["<","<=",">",">=","!="].indexOf(this.op)>=0},n}((function(){})),Ls=function(e){function n(t,n,r){var i=this;return(i=e.call(this,t,n,r)||this).key=Kr.U(r.referenceValue),i}return t(n,e),n.prototype.matches=function(t){var e=Kr.P(t.key,this.key);return this.wn(e)},n}(Ps),Os=function(e){function n(t,n){var r=this;return(r=e.call(this,t,"in",n)||this).keys=Vs("in",n),r}return t(n,e),n.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},n}(Ps),Cs=function(e){function n(t,n){var r=this;return(r=e.call(this,t,"not-in",n)||this).keys=Vs("not-in",n),r}return t(n,e),n.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},n}(Ps);function Vs(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return Kr.U(t.referenceValue)}))}var Us=function(e){function n(t,n){return e.call(this,t,"array-contains",n)||this}return t(n,e),n.prototype.matches=function(t){var e=t.field(this.field);return Xi(e)&&Fi(e.arrayValue,this.value)},n}(Ps),Ms=function(e){function n(t,n){return e.call(this,t,"in",n)||this}return t(n,e),n.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&Fi(this.value.arrayValue,e)},n}(Ps),qs=function(e){function n(t,n){return e.call(this,t,"not-in",n)||this}return t(n,e),n.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&!Fi(this.value.arrayValue,e)},n}(Ps),Fs=function(e){function n(t,n){return e.call(this,t,"array-contains-any",n)||this}return t(n,e),n.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!Xi(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return Fi(e.value.arrayValue,t)}))},n}(Ps),js=function(t,e){this.position=t,this.before=e};function Gs(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return Bi(t)})).join(",")}function Bs(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.M()?Kr.P(Kr.U(s.referenceValue),n.key):ji(s,n.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function zs(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!qi(t.position[n],e.position[n]))return!1;return!0}var Hs=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Ks(t,e,n){var r=t.field.M()?Kr.P(e.key,n.key):function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?ji(r,i):Nr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Nr()}}function Ws(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ys=function(){function t(t,e,n,r){this.batchId=t,this.Tn=e,this.baseMutations=n,this.mutations=r}return t.prototype.En=function(t,e,n){for(var r=n.In,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=Zo(o,e,r[i]))}return e},t.prototype.mn=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=Jo(i,e,e,this.Tn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=Jo(a,e,o,this.Tn))}return e},t.prototype.An=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.mn(r.key,t.get(r.key));i&&(n=n.st(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),bi())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&xr(this.mutations,t.mutations,(function(t,e){return ts(t,e)}))&&xr(this.baseMutations,t.baseMutations,(function(t,e){return ts(t,e)}))},t}(),Xs=function(){function t(t,e,n,r){this.batch=t,this.Rn=e,this.In=n,this.Pn=r}return t.from=function(e,n,r){_r(e.mutations.length===r.length);for(var i=mi,o=e.mutations,s=0;s<o.length;s++)i=i.st(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Qs=function(){function t(t){var e=this;this.gn=null,this.Vn=null,this.result=void 0,this.error=void 0,this.yn=!1,this.pn=!1,t((function(t){e.yn=!0,e.result=t,e.gn&&e.gn(t)}),(function(t){e.yn=!0,e.error=t,e.Vn&&e.Vn(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.pn&&Nr(),this.pn=!0,this.yn?this.error?this.bn(n,this.error):this.vn(e,this.result):new t((function(t,i){r.gn=function(n){r.vn(e,n).next(t,i)},r.Vn=function(e){r.bn(n,e).next(t,i)}}))},t.prototype.Sn=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.Dn=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.vn=function(e,n){return e?this.Dn((function(){return e(n)})):t.resolve(n)},t.prototype.bn=function(e,n){return e?this.Dn((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.Cn=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.Nn=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.Cn(r)},t}(),Zs=function(){function t(){this.Fn=new Ur((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.kn=!1}return Object.defineProperty(t.prototype,"readTime",{get:function(){return this.$n},set:function(t){this.$n=t},enumerable:!1,configurable:!0}),t.prototype.xn=function(t,e){this.On(),this.readTime=e,this.Fn.set(t.key,t)},t.prototype.Mn=function(t,e){this.On(),e&&(this.readTime=e),this.Fn.set(t,null)},t.prototype.Ln=function(t,e){this.On();var n=this.Fn.get(e);return void 0!==n?Qs.resolve(n):this.qn(t,e)},t.prototype.getEntries=function(t,e){return this.Bn(t,e)},t.prototype.apply=function(t){return this.On(),this.kn=!0,this.Un(t)},t.prototype.On=function(){},t}(),Js="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",$s=function(){function t(){this.Qn=[]}return t.prototype.Wn=function(t){this.Qn.push(t)},t.prototype.jn=function(){this.Qn.forEach((function(t){return t()}))},t}(),tu=function(){function t(t,e,n){this.Kn=t,this.Gn=e,this.zn=n}return t.prototype.Hn=function(t,e){var n=this;return this.Gn.Yn(t,e).next((function(r){return n.Jn(t,e,r)}))},t.prototype.Jn=function(t,e,n){return this.Kn.Ln(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].mn(e,t);return t}))},t.prototype.Xn=function(t,e,n){var r=vi();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].mn(t,e);r=r.st(t,e)})),r},t.prototype.Zn=function(t,e){var n=this;return this.Kn.getEntries(t,e).next((function(e){return n.ts(t,e)}))},t.prototype.ts=function(t,e){var n=this;return this.Gn.es(t,e).next((function(r){var i=n.Xn(t,e,r),o=di();return i.forEach((function(t,e){e||(e=new vs(t,jr.min())),o=o.st(t,e)})),o}))},t.prototype.ns=function(t,e,n){return function(t){return Kr.j(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.ss(t,e.path):Is(e)?this.rs(t,e,n):this.os(t,e,n)},t.prototype.ss=function(t,e){return this.Hn(t,new Kr(e)).next((function(t){var e=gi();return t instanceof ds&&(e=e.st(t.key,t)),e}))},t.prototype.rs=function(t,e,n){var r=this,i=e.collectionGroup,o=gi();return this.zn.hs(t,i).next((function(s){return Qs.forEach(s,(function(s){var u=e.on(s.child(i));return r.os(t,u,n).next((function(t){t.forEach((function(t,e){o=o.st(t,e)}))}))})).next((function(){return o}))}))},t.prototype.os=function(t,e,n){var r,i,o=this;return this.Kn.ns(t,e,n).next((function(n){return r=n,o.Gn.as(t,e)})).next((function(e){return i=e,o.us(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,u=o.mutations;s<u.length;s++){var a=u[s],c=a.key,h=r.get(c),f=Jo(a,h,h,o.Tn);r=f instanceof ds?r.st(c,f):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){xs(e,n)||(r=r.remove(t))})),r}))},t.prototype.us=function(t,e,n){for(var r=bi(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof rs&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.Kn.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof ds&&(c=c.st(t,e))})),c}))},t}(),eu=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.cs=n,this.ls=r}return t._s=function(e,n){for(var r=bi(),i=bi(),o=0,s=n.docChanges;o<s.length;o++){var u=s[o];switch(u.type){case 0:r=r.add(u.doc.key);break;case 1:i=i.add(u.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),nu=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.fs=function(t){return n.ds(t)},this.ws=function(t){return e.Ts(t)})}return t.prototype.ds=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.ws&&this.ws(t),t},t}();nu.Es=-1;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ru=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},iu=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Is=t,this.ms=e,this.As=n,this.Rs=r,this.Ps=i,this.gs=0,this.Vs=null,this.ys=Date.now(),this.reset()}return t.prototype.reset=function(){this.gs=0},t.prototype.ps=function(){this.gs=this.Ps},t.prototype.bs=function(t){var e=this;this.cancel();var n=Math.floor(this.gs+this.vs()),r=Math.max(0,Date.now()-this.ys),i=Math.max(0,n-r);i>0&&br("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.gs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Vs=this.Is.Ss(this.ms,i,(function(){return e.ys=Date.now(),t()})),this.gs*=this.Rs,this.gs<this.As&&(this.gs=this.As),this.gs>this.Ps&&(this.gs=this.Ps)},t.prototype.Ds=function(){null!==this.Vs&&(this.Vs.Cs(),this.Vs=null)},t.prototype.cancel=function(){null!==this.Vs&&(this.Vs.cancel(),this.Vs=null)},t.prototype.vs=function(){return(Math.random()-.5)*this.gs},t}(),ou=function(){function t(e,n,i){this.name=e,this.version=n,this.Ns=i,12.2===t.Fs(r())&&Ir("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return br("SimpleDb","Removing database:",t),fu(window.indexedDB.deleteDatabase(t)).Sn()},t.ks=function(){if("undefined"==typeof indexedDB)return!1;if(t.$s())return!0;var e=r(),n=t.Fs(e),i=0<n&&n<10,o=t.xs(e),s=0<o&&o<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||s)},t.$s=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Os)},t.Ms=function(t,e){return t.store(e)},t.Fs=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.xs=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.Ls=function(){return e(this,void 0,void 0,(function(){var t,e=this;return n(this,(function(n){switch(n.label){case 0:return this.db?[3,2]:(br("SimpleDb","Opening database:",this.name),t=this,[4,new Promise((function(t,n){var r=indexedDB.open(e.name,e.version);r.onsuccess=function(e){var n=e.target.result;t(n)},r.onblocked=function(){n(new uu("Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=function(t){var e=t.target.error;"VersionError"===e.name?n(new qr(Mr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new uu(e))},r.onupgradeneeded=function(t){br("SimpleDb",'Database "'+e.name+'" requires upgrade from version:',t.oldVersion);var n=t.target.result;e.Ns.createOrUpgrade(n,r.transaction,t.oldVersion,e.version).next((function(){br("SimpleDb","Database upgrade to version "+e.version+" complete")}))}}))]);case 1:t.db=n.sent(),n.label=2;case 2:return[2,(this.qs&&(this.db.onversionchange=function(t){return e.qs(t)}),this.db)]}}))}))},t.prototype.Bs=function(t){this.qs=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,r,i){return e(this,void 0,void 0,(function(){var e,o,s,u,a;return n(this,(function(c){switch(c.label){case 0:e="readonly"===t,o=0,s=function(){var t,s,a,c,h;return n(this,(function(n){switch(n.label){case 0:++o,n.label=1;case 1:return n.trys.push([1,4,,5]),[4,u.Ls()];case 2:return u.db=n.sent(),t=cu.open(u.db,e?"readonly":"readwrite",r),s=i(t).catch((function(e){return t.abort(e),Qs.reject(e)})).Sn(),a={},s.catch((function(){})),[4,t.Us];case 3:return[2,(a.value=(n.sent(),s),a)];case 4:return c=n.sent(),h="FirebaseError"!==c.name&&o<3,br("SimpleDb","Transaction failed with error: %s. Retrying: %s.",c.message,h),u.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}}))},u=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(a=c.sent()))return[2,a.value];c.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),su=function(){function t(t){this.Qs=t,this.Ws=!1,this.js=null}return Object.defineProperty(t.prototype,"yn",{get:function(){return this.Ws},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Ks",{get:function(){return this.js},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Qs=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Ws=!0},t.prototype.Gs=function(t){this.js=t},t.prototype.delete=function(){return fu(this.Qs.delete())},t}(),uu=function(e){function n(t){var n=this;return(n=e.call(this,Mr.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",n}return t(n,e),n}(qr);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function au(t){return"IndexedDbTransactionError"===t.name}var cu=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.zs=new ru,this.transaction.oncomplete=function(){e.zs.resolve()},this.transaction.onabort=function(){t.error?e.zs.reject(new uu(t.error)):e.zs.resolve()},this.transaction.onerror=function(t){var n=pu(t.target.error);e.zs.reject(new uu(n))}}return t.open=function(e,n,r){try{return new t(e.transaction(r,n))}catch(e){throw new uu(e)}},Object.defineProperty(t.prototype,"Us",{get:function(){return this.zs.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.zs.reject(t),this.aborted||(br("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new hu(e)},t}(),hu=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(br("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(br("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),fu(n)},t.prototype.add=function(t){return br("SimpleDb","ADD",this.store.name,t,t),fu(this.store.add(t))},t.prototype.get=function(t){var e=this;return fu(this.store.get(t)).next((function(n){return void 0===n&&(n=null),br("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return br("SimpleDb","DELETE",this.store.name,t),fu(this.store.delete(t))},t.prototype.count=function(){return br("SimpleDb","COUNT",this.store.name),fu(this.store.count())},t.prototype.Hs=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.Ys(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.Js=function(t,e){br("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Xs=!1;var r=this.cursor(n);return this.Ys(r,(function(t,e,n){return n.delete()}))},t.prototype.Zs=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.Ys(r,e)},t.prototype.ti=function(t){var e=this.cursor({});return new Qs((function(n,r){e.onerror=function(t){var e=pu(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.Ys=function(t,e){var n=[];return new Qs((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new su(i),s=e(i.primaryKey,i.value,o);if(s instanceof Qs){var u=s.catch((function(t){return o.done(),Qs.reject(t)}));n.push(u)}o.yn?r():null===o.Ks?i.continue():i.continue(o.Ks)}else r()}})).next((function(){return Qs.Cn(n)}))},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Xs?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function fu(t){return new Qs((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=pu(t.target.error);n(e)}}))}var lu=!1;function pu(t){var e=ou.Fs(r());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var i=new qr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return lu||(lu=!0,setTimeout((function(){throw i}),0)),i}}return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function du(){return"undefined"!=typeof window?window:null}function vu(){return"undefined"!=typeof document?document:null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var yu=function(){function t(t,e,n,r,i){this.ei=t,this.ms=e,this.ni=n,this.op=r,this.si=i,this.ii=new ru,this.then=this.ii.promise.then.bind(this.ii.promise),this.ii.promise.catch((function(t){}))}return t.ri=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.oi=setTimeout((function(){return e.hi()}),t)},t.prototype.Cs=function(){return this.hi()},t.prototype.cancel=function(t){null!==this.oi&&(this.clearTimeout(),this.ii.reject(new qr(Mr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.hi=function(){var t=this;this.ei.ai((function(){return null!==t.oi?(t.clearTimeout(),t.op().then((function(e){return t.ii.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.oi&&(this.si(this),clearTimeout(this.oi),this.oi=null)},t}(),gu=function(){function t(){var t=this;this.ui=Promise.resolve(),this.ci=[],this.li=!1,this._i=[],this.fi=null,this.di=!1,this.wi=[],this.Ti=new iu(this,"async_queue_retry"),this.Ei=function(){var e=vu();e&&br("AsyncQueue","Visibility state changed to  ",e.visibilityState),t.Ti.Ds()};var e=vu();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ei)}return Object.defineProperty(t.prototype,"Ii",{get:function(){return this.li},enumerable:!1,configurable:!0}),t.prototype.ai=function(t){this.enqueue(t)},t.prototype.mi=function(t){this.Ai(),this.Ri(t)},t.prototype.Pi=function(){if(!this.li){this.li=!0;var t=vu();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ei)}},t.prototype.enqueue=function(t){return this.Ai(),this.li?new Promise((function(t){})):this.Ri(t)},t.prototype.gi=function(t){var e=this;this.ci.push(t),this.ai((function(){return e.Vi()}))},t.prototype.Vi=function(){return e(this,void 0,void 0,(function(){var t,e=this;return n(this,(function(n){switch(n.label){case 0:if(0===this.ci.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.ci[0]()];case 2:return n.sent(),this.ci.shift(),this.Ti.reset(),[3,4];case 3:if(!au(t=n.sent()))throw t;return br("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.ci.length>0&&this.Ti.bs((function(){return e.Vi()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Ri=function(t){var e=this,n=this.ui.then((function(){return e.di=!0,t().catch((function(t){throw e.fi=t,e.di=!1,Ir("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.di=!1,t}))}));return this.ui=n,n},t.prototype.Ss=function(t,e,n){var r=this;this.Ai(),this.wi.indexOf(t)>-1&&(e=0);var i=yu.ri(this,t,e,n,(function(t){return r.yi(t)}));return this._i.push(i),i},t.prototype.Ai=function(){this.fi&&Nr()},t.prototype.pi=function(){},t.prototype.bi=function(){return e(this,void 0,void 0,(function(){var t;return n(this,(function(e){switch(e.label){case 0:return[4,t=this.ui];case 1:e.sent(),e.label=2;case 2:if(t!==this.ui)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.vi=function(t){for(var e=0,n=this._i;e<n.length;e++)if(n[e].ms===t)return!0;return!1},t.prototype.Si=function(t){var e=this;return this.bi().then((function(){e._i.sort((function(t,e){return t.ni-e.ni}));for(var n=0,r=e._i;n<r.length;n++){var i=r[n];if(i.Cs(),"all"!==t&&i.ms===t)break}return e.bi()}))},t.prototype.Di=function(t){this.wi.push(t)},t.prototype.yi=function(t){var e=this._i.indexOf(t);this._i.splice(e,1)},t}();function mu(t,e){if(Ir("AsyncQueue",e+": "+t),au(t))return new qr(Mr.UNAVAILABLE,e+": "+t);throw t}function wu(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=kr(n,i);return 0===s?kr(r,o):s}var bu=function(){function t(t){this.Ci=t,this.buffer=new fi(wu),this.Ni=0}return t.prototype.Fi=function(){return++this.Ni},t.prototype.ki=function(t){var e=[t,this.Fi()];if(this.buffer.size<this.Ci)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();wu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Iu={$i:!1,xi:0,Oi:0,Mi:0},Eu=function(){function t(t,e,n){this.Li=t,this.qi=e,this.Bi=n}return t.Ui=function(e){return new t(e,t.Qi,t.Wi)},t}();Eu.ji=-1,Eu.Ki=1048576,Eu.Gi=41943040,Eu.Qi=10,Eu.Wi=1e3,Eu.zi=new Eu(Eu.Gi,Eu.Qi,Eu.Wi),Eu.Hi=new Eu(Eu.ji,0,0);var Tu=function(){function t(t,e){this.Yi=t,this.ei=e,this.Ji=!1,this.Xi=null}return t.prototype.start=function(t){this.Yi.params.Li!==Eu.ji&&this.Zi(t)},t.prototype.stop=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},Object.defineProperty(t.prototype,"tr",{get:function(){return null!==this.Xi},enumerable:!1,configurable:!0}),t.prototype.Zi=function(t){var r=this,i=this.Ji?3e5:6e4;br("LruGarbageCollector","Garbage collection scheduled in "+i+"ms"),this.Xi=this.ei.Ss("lru_garbage_collection",i,(function(){return e(r,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:this.Xi=null,this.Ji=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.er(this.Yi)];case 2:return n.sent(),[3,7];case 3:return au(e=n.sent())?(br("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,qa(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.Zi(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),Nu=function(){function t(t,e){this.nr=t,this.params=e}return t.prototype.sr=function(t,e){return this.nr.ir(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.rr=function(t,e){var n=this;if(0===e)return Qs.resolve(nu.Es);var r=new bu(e);return this.nr.be(t,(function(t){return r.ki(t.sequenceNumber)})).next((function(){return n.nr.or(t,(function(t){return r.ki(t)}))})).next((function(){return r.maxValue}))},t.prototype.hr=function(t,e,n){return this.nr.hr(t,e,n)},t.prototype.ar=function(t,e){return this.nr.ar(t,e)},t.prototype.ur=function(t,e){var n=this;return this.params.Li===Eu.ji?(br("LruGarbageCollector","Garbage collection skipped; disabled"),Qs.resolve(Iu)):this.cr(t).next((function(r){return r<n.params.Li?(br("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.Li),Iu):n.lr(t,e)}))},t.prototype.cr=function(t){return this.nr.cr(t)},t.prototype.lr=function(t,e){var n,r,i,o,s,u,a,c=this,h=Date.now();return this.sr(t,this.params.qi).next((function(e){return e>c.params.Bi?(br("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.Bi+" from "+e),r=c.params.Bi):r=e,o=Date.now(),c.rr(t,r)})).next((function(r){return n=r,s=Date.now(),c.hr(t,n,e)})).next((function(e){return i=e,u=Date.now(),c.ar(t,n)})).next((function(t){return a=Date.now(),wr()<=f.DEBUG&&br("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(u-s)+"ms\n\tRemoved "+t+" documents in "+(a-u)+"ms\nTotal Duration: "+(a-h)+"ms"),Qs.resolve({$i:!0,xi:r,Oi:i,Mi:t})}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _u(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Su(e)),e=Au(t.get(n),e);return Su(e)}function Au(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Su(t){return t+""}function Du(t){var e=t.length;if(_r(e>=2),2===e)return _r(""===t.charAt(0)&&""===t.charAt(1)),Br.$();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&Nr(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Nr()}o=s+2}return new Br(r)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ku=function(t){this._r=t};function xu(t,e){if(e.document)return function(t,e,n){var r=lo(t,e.name),i=ao(e.updateTime),o=new hs({mapValue:{fields:e.fields}});return new ds(r,i,o,{hasCommittedMutations:!!n})}(t._r,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Kr.K(e.noDocument.path),r=Cu(e.noDocument.readTime);return new vs(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=Kr.K(e.unknownDocument.path),o=Cu(e.unknownDocument.version);return new ys(i,o)}return Nr()}function Ru(t,e,n){var r=Pu(n),i=e.key.path.p().N();if(e instanceof ds){var o=function(t,e){return{name:fo(t,e.key),fields:e.tn().mapValue.fields,updateTime:oo(t,e.version.A())}}(t._r,e),s=e.hasCommittedMutations;return new sa(null,null,o,s,r,i)}if(e instanceof vs){var u=e.key.path.N(),a=Ou(e.version),c=e.hasCommittedMutations;return new sa(null,new ia(u,a),null,c,r,i)}if(e instanceof ys){var h=e.key.path.N(),f=Ou(e.version);return new sa(new oa(h,f),null,null,!0,r,i)}return Nr()}function Pu(t){var e=t.A();return[e.seconds,e.nanoseconds]}function Lu(t){var e=new Fr(t[0],t[1]);return jr.I(e)}function Ou(t){var e=t.A();return new $u(e.seconds,e.nanoseconds)}function Cu(t){var e=new Fr(t.seconds,t.nanoseconds);return jr.I(e)}function Vu(t,e){var n=(e.baseMutations||[]).map((function(e){return bo(t._r,e)})),r=e.mutations.map((function(e){return bo(t._r,e)})),i=Fr.fromMillis(e.localWriteTimeMs);return new Ys(e.batchId,i,n,r)}function Uu(t){var e,n,r=Cu(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Cu(t.lastLimboFreeSnapshotVersion):jr.min();return void 0!==t.query.documents?(_r(1===(n=t.query).documents.length),e=Ts(bs(vo(n.documents[0])))):e=function(t){var e=vo(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){_r(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[xo(e)]:void 0!==e.fieldFilter?[ko(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):Nr():[]}(n.where));var u=[];n.orderBy&&(u=n.orderBy.map((function(t){return function(t){return new Hs(Do(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var a=null;n.limit&&(a=function(t){var e;return Wr(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=No(n.startAt));var h=null;return n.endAt&&(h=No(n.endAt)),Ts(ws(e,i,u,s,a,"F",c,h))}(t.query),new ii(e,t.targetId,0,t.lastListenSequenceNumber,r,i,ei.fromBase64String(t.resumeToken))}function Mu(t,e){var n,r=Ou(e.Z),i=Ou(e.lastLimboFreeSnapshotVersion);n=ti(e.target)?Io(t._r,e.target):Eo(t._r,e.target);var o=e.resumeToken.toBase64();return new aa(e.targetId,Jr(e.target),r,o,e.sequenceNumber,i,n)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qu=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.zn=n,this.dr=r,this.wr={}}return t.Tr=function(e,n,r,i){return _r(""!==e.uid),new t(e.Er()?e.uid:"",n,r,i)},t.prototype.Ir=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Gu(t).Zs({index:na.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.mr=function(t,e,n,r){var i=this,o=Bu(t),s=Gu(t);return s.add({}).next((function(u){_r("number"==typeof u);for(var a=new Ys(u,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return wo(t._r,e)})),i=n.mutations.map((function(e){return wo(t._r,e)}));return new na(e,n.batchId,n.Tn.toMillis(),r,i)}(i.serializer,i.userId,a),h=[],f=new fi((function(t,e){return kr(t.F(),e.F())})),l=0,p=r;l<p.length;l++){var d=p[l],v=ra.key(i.userId,d.key.path,u);f=f.add(d.key.path.p()),h.push(s.put(c)),h.push(o.put(v,ra.PLACEHOLDER))}return f.forEach((function(e){h.push(i.zn.Ar(t,e))})),t.Wn((function(){i.wr[u]=a.keys()})),Qs.Cn(h).next((function(){return a}))}))},t.prototype.Rr=function(t,e){var n=this;return Gu(t).get(e).next((function(t){return t?(_r(t.userId===n.userId),Vu(n.serializer,t)):null}))},t.prototype.Pr=function(t,e){var n=this;return this.wr[e]?Qs.resolve(this.wr[e]):this.Rr(t,e).next((function(t){if(t){var r=t.keys();return n.wr[e]=r,r}return null}))},t.prototype.gr=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Gu(t).Zs({index:na.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(_r(e.batchId>=r),o=Vu(n.serializer,e)),i.done()})).next((function(){return o}))},t.prototype.Vr=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Gu(t).Zs({index:na.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.yr=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Gu(t).Hs(na.userMutationsIndex,n).next((function(t){return t.map((function(t){return Vu(e.serializer,t)}))}))},t.prototype.Yn=function(t,e){var n=this,r=ra.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Bu(t).Zs({range:i},(function(r,i,s){var u=r[0],a=r[1],c=r[2],h=Du(a);if(u===n.userId&&e.path.isEqual(h))return Gu(t).get(c).next((function(t){if(!t)throw Nr();_r(t.userId===n.userId),o.push(Vu(n.serializer,t))}));s.done()})).next((function(){return o}))},t.prototype.es=function(t,e){var n=this,r=new fi(kr),i=[];return e.forEach((function(e){var o=ra.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),u=Bu(t).Zs({range:s},(function(t,i,o){var s=t[0],u=t[1],a=t[2],c=Du(u);s===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()}));i.push(u)})),Qs.Cn(i).next((function(){return n.pr(t,r)}))},t.prototype.as=function(t,e){var n=this,r=e.path,i=r.length+1,o=ra.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),u=new fi(kr);return Bu(t).Zs({range:s},(function(t,e,o){var s=t[0],a=t[1],c=t[2],h=Du(a);s===n.userId&&r.D(h)?h.length===i&&(u=u.add(c)):o.done()})).next((function(){return n.pr(t,u)}))},t.prototype.pr=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Gu(t).get(e).next((function(t){if(null===t)throw Nr();_r(t.userId===n.userId),r.push(Vu(n.serializer,t))})))})),Qs.Cn(i).next((function(){return r}))},t.prototype.br=function(t,e){var n=this;return ju(t.vr,this.userId,e).next((function(r){return t.Wn((function(){n.Sr(e.batchId)})),Qs.forEach(r,(function(e){return n.dr.Dr(t,e)}))}))},t.prototype.Sr=function(t){delete this.wr[t]},t.prototype.Cr=function(t){var e=this;return this.Ir(t).next((function(n){if(!n)return Qs.resolve();var r=IDBKeyRange.lowerBound(ra.prefixForUser(e.userId)),i=[];return Bu(t).Zs({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Du(t[1]);i.push(o)}else r.done()})).next((function(){_r(0===i.length)}))}))},t.prototype.Nr=function(t,e){return Fu(t,this.userId,e)},t.prototype.Fr=function(t){var e=this;return zu(t).get(this.userId).next((function(t){return t||new ea(e.userId,-1,"")}))},t}();function Fu(t,e,n){var r=ra.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Bu(t).Zs({range:o,Xs:!0},(function(t,n,r){var o=t[0],u=t[1];t[2],o===e&&u===i&&(s=!0),r.done()})).next((function(){return s}))}function ju(t,e,n){var r=t.store(na.store),i=t.store(ra.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.Zs({range:s},(function(t,e,n){return u++,n.delete()}));o.push(a.next((function(){_r(1===u)})));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=ra.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return Qs.Cn(o).next((function(){return c}))}function Gu(t){return Na.Ms(t,na.store)}function Bu(t){return Na.Ms(t,ra.store)}function zu(t){return Na.Ms(t,ea.store)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Hu=function(){function t(t,e){this.serializer=t,this.zn=e}return t.prototype.xn=function(t,e,n){return Wu(t).put(Yu(e),n)},t.prototype.Mn=function(t,e){var n=Wu(t),r=Yu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.kr(t,r)}))},t.prototype.Ln=function(t,e){var n=this;return Wu(t).get(Yu(e)).next((function(t){return n.$r(t)}))},t.prototype.xr=function(t,e){var n=this;return Wu(t).get(Yu(e)).next((function(t){var e=n.$r(t);return e?{Or:e,size:Xu(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=vi();return this.Mr(t,e,(function(t,e){var i=n.$r(e);r=r.st(t,i)})).next((function(){return r}))},t.prototype.Lr=function(t,e){var n=this,r=vi(),i=new ai(Kr.P);return this.Mr(t,e,(function(t,e){var o=n.$r(e);o?(r=r.st(t,o),i=i.st(t,Xu(e))):(r=r.st(t,null),i=i.st(t,0))})).next((function(){return{qr:r,Br:i}}))},t.prototype.Mr=function(t,e,n){if(e._())return Qs.resolve();var r=IDBKeyRange.bound(e.first().path.N(),e.last().path.N()),i=e.ut(),o=i.wt();return Wu(t).Zs({range:r},(function(t,e,r){for(var s=Kr.K(t);o&&Kr.P(o,s)<0;)n(o,null),o=i.wt();o&&o.isEqual(s)&&(n(o,e),o=i.Tt()?i.wt():null),o?r.Gs(o.path.N()):r.done()})).next((function(){for(;o;)n(o,null),o=i.Tt()?i.wt():null}))},t.prototype.ns=function(t,e,n){var r=this,i=gi(),o=e.path.length+1,s={};if(n.isEqual(jr.min())){var u=e.path.N();s.range=IDBKeyRange.lowerBound(u)}else{var a=e.path.N(),c=Pu(n);s.range=IDBKeyRange.lowerBound([a,c],!0),s.index=sa.collectionReadTimeIndex}return Wu(t).Zs(s,(function(t,n,s){if(t.length===o){var u=xu(r.serializer,n);e.path.D(u.key.path)?u instanceof ds&&xs(e,u)&&(i=i.st(u.key,u)):s.done()}})).next((function(){return i}))},t.prototype.Ur=function(t,e){var n=this,r=di(),i=Pu(e),o=Wu(t),s=IDBKeyRange.lowerBound(i,!0);return o.Zs({index:sa.readTimeIndex,range:s},(function(t,e){var o=xu(n.serializer,e);r=r.st(o.key,o),i=e.readTime})).next((function(){return{Qr:r,readTime:Lu(i)}}))},t.prototype.Wr=function(t){var e=Wu(t),n=jr.min();return e.Zs({index:sa.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Lu(e.readTime)),r.done()})).next((function(){return n}))},t.prototype.jr=function(e){return new t.Kr(this,!!e&&e.Gr)},t.prototype.zr=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return Ku(t).get(ua.key).next((function(t){return _r(!!t),t}))},t.prototype.kr=function(t,e){return Ku(t).put(ua.key,e)},t.prototype.$r=function(t){if(t){var e=xu(this.serializer,t);return e instanceof vs&&e.version.isEqual(jr.min())?null:e}return null},t}();function Ku(t){return Na.Ms(t,ua.store)}function Wu(t){return Na.Ms(t,sa.store)}function Yu(t){return t.path.N()}function Xu(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Nr();e=t.noDocument}return JSON.stringify(e).length}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Hu.Kr=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).Hr=t,r.Gr=n,r.Yr=new Ur((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return t(n,e),n.prototype.Un=function(t){var e=this,n=[],r=0,i=new fi((function(t,e){return kr(t.F(),e.F())}));return this.Fn.forEach((function(o,s){var u=e.Yr.get(o);if(s){var a=Ru(e.Hr.serializer,s,e.readTime);i=i.add(o.path.p());var c=Xu(a);r+=c-u,n.push(e.Hr.xn(t,o,a))}else if(r-=u,e.Gr){var h=Ru(e.Hr.serializer,new vs(o,jr.min()),e.readTime);n.push(e.Hr.xn(t,o,h))}else n.push(e.Hr.Mn(t,o))})),i.forEach((function(r){n.push(e.Hr.zn.Ar(t,r))})),n.push(this.Hr.updateMetadata(t,r)),Qs.Cn(n)},n.prototype.qn=function(t,e){var n=this;return this.Hr.xr(t,e).next((function(t){return null===t?(n.Yr.set(e,0),null):(n.Yr.set(e,t.size),t.Or)}))},n.prototype.Bn=function(t,e){var n=this;return this.Hr.Lr(t,e).next((function(t){var e=t.qr;return t.Br.forEach((function(t,e){n.Yr.set(t,e)})),e}))},n}(Zs);var Qu=function(){function t(){this.Jr=new Zu}return t.prototype.Ar=function(t,e){return this.Jr.add(e),Qs.resolve()},t.prototype.hs=function(t,e){return Qs.resolve(this.Jr.getEntries(e))},t}(),Zu=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.S(),n=t.p(),r=this.index[e]||new fi(Br.P),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.S(),n=t.p(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new fi(Br.P)).N()},t}(),Ju=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;_r(n<r&&n>=0&&r<=10);var o=new cu(e);n<1&&r>=1&&(function(t){t.createObjectStore(ta.store)}(t),function(t){t.createObjectStore(ea.store,{keyPath:ea.keyPath}),t.createObjectStore(na.store,{keyPath:na.keyPath,autoIncrement:!0}).createIndex(na.userMutationsIndex,na.userMutationsKeyPath,{unique:!0}),t.createObjectStore(ra.store)}(t),la(t),function(t){t.createObjectStore(sa.store)}(t));var s=Qs.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(ca.store),t.deleteObjectStore(aa.store),t.deleteObjectStore(ha.store)}(t),la(t)),s=s.next((function(){return function(t){var e=t.store(ha.store),n=new ha(0,0,jr.min().A(),0);return e.put(ha.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(na.store).Hs().next((function(n){t.deleteObjectStore(na.store),t.createObjectStore(na.store,{keyPath:na.keyPath,autoIncrement:!0}).createIndex(na.userMutationsIndex,na.userMutationsKeyPath,{unique:!0});var r=e.store(na.store),i=n.map((function(t){return r.put(t)}));return Qs.Cn(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(pa.store,{keyPath:pa.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.removeAcknowledgedMutations(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(ua.store)}(t),i.addDocumentGlobal(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ensureSequenceNumbers(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.createCollectionParentIndex(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(sa.store);e.createIndex(sa.readTimeIndex,sa.readTimeIndexPath,{unique:!1}),e.createIndex(sa.collectionReadTimeIndex,sa.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.rewriteCanonicalIds(o)}))),s},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(sa.store).Zs((function(t,n){e+=Xu(n)})).next((function(){var n=new ua(e);return t.store(ua.store).put(ua.key,n)}))},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(ea.store),r=t.store(na.store);return n.Hs().next((function(n){return Qs.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Hs(na.userMutationsIndex,i).next((function(r){return Qs.forEach(r,(function(r){_r(r.userId===n.userId);var i=Vu(e.serializer,r);return ju(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(ca.store),n=t.store(sa.store);return t.store(ha.store).get(ha.key).next((function(t){var r=[];return n.Zs((function(n,i){var o=new Br(n),s=function(t){return[0,_u(t)]}(o);r.push(e.get(s).next((function(n){return n?Qs.resolve():function(n){return e.put(new ca(0,_u(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return Qs.Cn(r)}))}))},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(fa.store,{keyPath:fa.keyPath});var n=e.store(fa.store),r=new Zu,i=function(t){if(r.add(t)){var e=t.S(),i=t.p();return n.put({collectionId:e,parent:_u(i)})}};return e.store(sa.store).Zs({Xs:!0},(function(t,e){var n=new Br(t);return i(n.p())})).next((function(){return e.store(ra.store).Zs({Xs:!0},(function(t,e){t[0];var n=t[1],r=(t[2],Du(n));return i(r.p())}))}))},t.prototype.rewriteCanonicalIds=function(t){var e=this,n=t.store(aa.store);return n.Zs((function(t,r){var i=Uu(r),o=Mu(e.serializer,i);return n.put(o)}))},t}(),$u=function(t,e){this.seconds=t,this.nanoseconds=e},ta=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};ta.store="owner",ta.key="owner";var ea=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};ea.store="mutationQueues",ea.keyPath="userId";var na=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};na.store="mutations",na.keyPath="batchId",na.userMutationsIndex="userMutationsIndex",na.userMutationsKeyPath=["userId","batchId"];var ra=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,_u(e)]},t.key=function(t,e,n){return[t,_u(e),n]},t}();ra.store="documentMutations",ra.PLACEHOLDER=new ra;var ia=function(t,e){this.path=t,this.readTime=e},oa=function(t,e){this.path=t,this.version=e},sa=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};sa.store="remoteDocuments",sa.readTimeIndex="readTimeIndex",sa.readTimeIndexPath="readTime",sa.collectionReadTimeIndex="collectionReadTimeIndex",sa.collectionReadTimeIndexPath=["parentPath","readTime"];var ua=function(t){this.byteSize=t};ua.store="remoteDocumentGlobal",ua.key="remoteDocumentGlobalKey";var aa=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};aa.store="targets",aa.keyPath="targetId",aa.queryTargetsIndexName="queryTargetsIndex",aa.queryTargetsKeyPath=["canonicalId","targetId"];var ca=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};ca.store="targetDocuments",ca.keyPath=["targetId","path"],ca.documentTargetsIndex="documentTargetsIndex",ca.documentTargetsKeyPath=["path","targetId"];var ha=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};ha.key="targetGlobalKey",ha.store="targetGlobal";var fa=function(t,e){this.collectionId=t,this.parent=e};function la(t){t.createObjectStore(ca.store,{keyPath:ca.keyPath}).createIndex(ca.documentTargetsIndex,ca.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(aa.store,{keyPath:aa.keyPath}).createIndex(aa.queryTargetsIndexName,aa.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ha.store)}fa.store="collectionParents",fa.keyPath=["collectionId","parent"];var pa=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};pa.store="clientMetadata",pa.keyPath="clientId";var da=i(i(i([ea.store,na.store,ra.store,sa.store,aa.store,ta.store,ha.store,ca.store],[pa.store]),[ua.store]),[fa.store]),va=function(){function t(){this.Xr=new Zu}return t.prototype.Ar=function(t,e){var n=this;if(!this.Xr.has(e)){var r=e.S(),i=e.p();t.Wn((function(){n.Xr.add(e)}));var o={collectionId:r,parent:_u(i)};return ya(t).put(o)}return Qs.resolve()},t.prototype.hs=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Rr(e),""],!1,!0);return ya(t).Hs(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Du(o.parent))}return n}))},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ya(t){return Na.Ms(t,fa.store)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ga=function(){function t(t){this.Zr=t}return t.prototype.next=function(){return this.Zr+=2,this.Zr},t.to=function(){return new t(0)},t.eo=function(){return new t(-1)},t}(),ma=function(){function t(t,e){this.dr=t,this.serializer=e}return t.prototype.no=function(t){var e=this;return this.so(t).next((function(n){var r=new ga(n.highestTargetId);return n.highestTargetId=r.next(),e.io(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.ro=function(t){return this.so(t).next((function(t){return jr.I(new Fr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.oo=function(t){return this.so(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.ho=function(t,e,n){var r=this;return this.so(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.A()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.io(t,i)}))},t.prototype.ao=function(t,e){var n=this;return this.uo(t,e).next((function(){return n.so(t).next((function(r){return r.targetCount+=1,n.co(e,r),n.io(t,r)}))}))},t.prototype.lo=function(t,e){return this.uo(t,e)},t.prototype._o=function(t,e){var n=this;return this.fo(t,e.targetId).next((function(){return wa(t).delete(e.targetId)})).next((function(){return n.so(t)})).next((function(e){return _r(e.targetCount>0),e.targetCount-=1,n.io(t,e)}))},t.prototype.hr=function(t,e,n){var r=this,i=0,o=[];return wa(t).Zs((function(s,u){var a=Uu(u);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r._o(t,a)))})).next((function(){return Qs.Cn(o)})).next((function(){return i}))},t.prototype.be=function(t,e){return wa(t).Zs((function(t,n){var r=Uu(n);e(r)}))},t.prototype.so=function(t){return ba(t).get(ha.key).next((function(t){return _r(null!==t),t}))},t.prototype.io=function(t,e){return ba(t).put(ha.key,e)},t.prototype.uo=function(t,e){return wa(t).put(Mu(this.serializer,e))},t.prototype.co=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.do=function(t){return this.so(t).next((function(t){return t.targetCount}))},t.prototype.wo=function(t,e){var n=Jr(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return wa(t).Zs({range:r,index:aa.queryTargetsIndexName},(function(t,n,r){var o=Uu(n);$r(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.To=function(t,e,n){var r=this,i=[],o=Ia(t);return e.forEach((function(e){var s=_u(e.path);i.push(o.put(new ca(n,s))),i.push(r.dr.Eo(t,n,e))})),Qs.Cn(i)},t.prototype.Io=function(t,e,n){var r=this,i=Ia(t);return Qs.forEach(e,(function(e){var o=_u(e.path);return Qs.Cn([i.delete([n,o]),r.dr.mo(t,n,e)])}))},t.prototype.fo=function(t,e){var n=Ia(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.Ao=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Ia(t),i=bi();return r.Zs({range:n,Xs:!0},(function(t,e,n){var r=Du(t[1]),o=new Kr(r);i=i.add(o)})).next((function(){return i}))},t.prototype.Nr=function(t,e){var n=_u(e.path),r=IDBKeyRange.bound([n],[Rr(n)],!1,!0),i=0;return Ia(t).Zs({index:ca.documentTargetsIndex,Xs:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.Me=function(t,e){return wa(t).get(e).next((function(t){return t?Uu(t):null}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wa(t){return Na.Ms(t,aa.store)}function ba(t){return Na.Ms(t,ha.store)}function Ia(t){return Na.Ms(t,ca.store)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ea="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Ta=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).vr=t,r.Ro=n,r}return t(n,e),n}($s),Na=function(){function t(e,n,r,i,o,s,u,a,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Is=o,this.window=s,this.document=u,this.Po=c,this.Vo=h,this.yo=null,this.po=!1,this.isPrimary=!1,this.networkEnabled=!0,this.bo=null,this.inForeground=!1,this.vo=null,this.So=null,this.Do=Number.NEGATIVE_INFINITY,this.Co=function(t){return Promise.resolve()},!t.ks())throw new qr(Mr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.dr=new Sa(this,i),this.No=n+"main",this.serializer=new ku(a),this.Fo=new ou(this.No,10,new Ju(this.serializer)),this.ko=new ma(this.dr,this.serializer),this.zn=new va,this.Kn=new Hu(this.serializer,this.zn),this.window&&this.window.localStorage?this.$o=this.window.localStorage:(this.$o=null,!1===h&&Ir("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.Ms=function(t,e){if(t instanceof Ta)return ou.Ms(t.vr,e);throw Nr()},t.prototype.start=function(){var t=this;return this.xo().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new qr(Mr.FAILED_PRECONDITION,Ea);return t.Oo(),t.Mo(),t.Lo(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.ko.oo(e)}))})).then((function(e){t.yo=new nu(e,t.Po)})).then((function(){t.po=!0})).catch((function(e){return t.Fo&&t.Fo.close(),Promise.reject(e)}))},t.prototype.qo=function(t){var r=this;return this.Co=function(i){return e(r,void 0,void 0,(function(){return n(this,(function(e){return this.tr?[2,t(i)]:[2]}))}))},t(this.isPrimary)},t.prototype.Bo=function(t){var r=this;this.Fo.Bs((function(i){return e(r,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return null===i.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.Uo=function(t){var r=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Is.ai((function(){return e(r,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return this.tr?[4,this.xo()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.xo=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return Aa(e).put(new pa(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Qo(e).next((function(e){e||(t.isPrimary=!1,t.Is.gi((function(){return t.Co(!1)})))}))})).next((function(){return t.Wo(e)})).next((function(n){return t.isPrimary&&!n?t.jo(e).next((function(){return!1})):!!n&&t.Ko(e).next((function(){return!0}))}))})).catch((function(e){if(au(e))return br("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return br("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Is.gi((function(){return t.Co(e)})),t.isPrimary=e}))},t.prototype.Qo=function(t){var e=this;return _a(t).get(ta.key).next((function(t){return Qs.resolve(e.Go(t))}))},t.prototype.zo=function(t){return Aa(t).delete(this.clientId)},t.prototype.Ho=function(){return e(this,void 0,void 0,(function(){var e,r,i,o,s=this;return n(this,(function(n){switch(n.label){case 0:return!this.isPrimary||this.Yo(this.Do,18e5)?[3,2]:(this.Do=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var n=t.Ms(e,pa.store);return n.Hs().next((function(t){var e=s.Jo(t,18e5),r=t.filter((function(t){return-1===e.indexOf(t)}));return Qs.forEach(r,(function(t){return n.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(e=n.sent(),this.$o)for(r=0,i=e;r<i.length;r++)o=i[r],this.$o.removeItem(this.Xo(o.clientId));n.label=2;case 2:return[2]}}))}))},t.prototype.Lo=function(){var t=this;this.So=this.Is.Ss("client_metadata_refresh",4e3,(function(){return t.xo().then((function(){return t.Ho()})).then((function(){return t.Lo()}))}))},t.prototype.Go=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Wo=function(t){var e=this;return this.Vo?Qs.resolve(!0):_a(t).get(ta.key).next((function(n){if(null!==n&&e.Yo(n.leaseTimestampMs,5e3)&&!e.Zo(n.ownerId)){if(e.Go(n)&&e.networkEnabled)return!0;if(!e.Go(n)){if(!n.allowTabSynchronization)throw new qr(Mr.FAILED_PRECONDITION,Ea);return!1}}return!(!e.networkEnabled||!e.inForeground)||Aa(t).Hs().next((function(t){return void 0===e.Jo(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&br("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.th=function(){return e(this,void 0,void 0,(function(){var t=this;return n(this,(function(e){switch(e.label){case 0:return this.po=!1,this.eh(),this.So&&(this.So.cancel(),this.So=null),this.nh(),this.sh(),[4,this.Fo.runTransaction("readwrite",[ta.store,pa.store],(function(e){var n=new Ta(e,nu.Es);return t.jo(n).next((function(){return t.zo(n)}))}))];case 1:return e.sent(),this.Fo.close(),this.ih(),[2]}}))}))},t.prototype.Jo=function(t,e){var n=this;return t.filter((function(t){return n.Yo(t.updateTimeMs,e)&&!n.Zo(t.clientId)}))},t.prototype.rh=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return Aa(e).Hs().next((function(e){return t.Jo(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"tr",{get:function(){return this.po},enumerable:!1,configurable:!0}),t.prototype.oh=function(t){return qu.Tr(t,this.serializer,this.zn,this.dr)},t.prototype.hh=function(){return this.ko},t.prototype.ah=function(){return this.Kn},t.prototype.uh=function(){return this.zn},t.prototype.runTransaction=function(t,e,n){var r=this;br("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Fo.runTransaction(o,da,(function(o){return i=new Ta(o,r.yo?r.yo.next():nu.Es),"readwrite-primary"===e?r.Qo(i).next((function(t){return!!t||r.Wo(i)})).next((function(e){if(!e)throw Ir("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Is.gi((function(){return r.Co(!1)})),new qr(Mr.FAILED_PRECONDITION,Js);return n(i)})).next((function(t){return r.Ko(i).next((function(){return t}))})):r.lh(i).next((function(){return n(i)}))})).then((function(t){return i.jn(),t}))},t.prototype.lh=function(t){var e=this;return _a(t).get(ta.key).next((function(t){if(null!==t&&e.Yo(t.leaseTimestampMs,5e3)&&!e.Zo(t.ownerId)&&!e.Go(t)&&!(e.Vo||e.allowTabSynchronization&&t.allowTabSynchronization))throw new qr(Mr.FAILED_PRECONDITION,Ea)}))},t.prototype.Ko=function(t){var e=new ta(this.clientId,this.allowTabSynchronization,Date.now());return _a(t).put(ta.key,e)},t.ks=function(){return ou.ks()},t.prototype.jo=function(t){var e=this,n=_a(t);return n.get(ta.key).next((function(t){return e.Go(t)?(br("IndexedDbPersistence","Releasing primary lease."),n.delete(ta.key)):Qs.resolve()}))},t.prototype.Yo=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Ir("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.Oo=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.vo=function(){t.Is.ai((function(){return t.inForeground="visible"===t.document.visibilityState,t.xo()}))},this.document.addEventListener("visibilitychange",this.vo),this.inForeground="visible"===this.document.visibilityState)},t.prototype.nh=function(){this.vo&&(this.document.removeEventListener("visibilitychange",this.vo),this.vo=null)},t.prototype.Mo=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.bo=function(){e.eh(),e.Is.ai((function(){return e.th()}))},this.window.addEventListener("unload",this.bo))},t.prototype.sh=function(){this.bo&&(this.window.removeEventListener("unload",this.bo),this.bo=null)},t.prototype.Zo=function(t){var e;try{var n=null!==(null===(e=this.$o)||void 0===e?void 0:e.getItem(this.Xo(t)));return br("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Ir("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.eh=function(){if(this.$o)try{this.$o.setItem(this.Xo(this.clientId),String(Date.now()))}catch(t){Ir("Failed to set zombie client id.",t)}},t.prototype.ih=function(){if(this.$o)try{this.$o.removeItem(this.Xo(this.clientId))}catch(t){}},t.prototype.Xo=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function _a(t){return Na.Ms(t,ta.store)}function Aa(t){return Na.Ms(t,pa.store)}var Sa=function(){function t(t,e){this.db=t,this.Yi=new Nu(this,e)}return t.prototype.ir=function(t){var e=this._h(t);return this.db.hh().do(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype._h=function(t){var e=0;return this.or(t,(function(t){e++})).next((function(){return e}))},t.prototype.be=function(t,e){return this.db.hh().be(t,e)},t.prototype.or=function(t,e){return this.fh(t,(function(t,n){return e(n)}))},t.prototype.Eo=function(t,e,n){return Da(t,n)},t.prototype.mo=function(t,e,n){return Da(t,n)},t.prototype.hr=function(t,e,n){return this.db.hh().hr(t,e,n)},t.prototype.Dr=function(t,e){return Da(t,e)},t.prototype.dh=function(t,e){return function(t,e){var n=!1;return zu(t).ti((function(r){return Fu(t,r,e).next((function(t){return t&&(n=!0),Qs.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.ar=function(t,e){var n=this,r=this.db.ah().jr(),i=[],o=0;return this.fh(t,(function(s,u){if(u<=e){var a=n.dh(t,s).next((function(e){if(!e)return o++,r.Ln(t,s).next((function(){return r.Mn(s),Ia(t).delete([0,_u(s.path)])}))}));i.push(a)}})).next((function(){return Qs.Cn(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.tt(t.Ro);return this.db.hh().lo(t,n)},t.prototype.wh=function(t,e){return Da(t,e)},t.prototype.fh=function(t,e){var n,r=Ia(t),i=nu.Es;return r.Zs({index:ca.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),u=r.sequenceNumber;0===o?(i!==nu.Es&&e(new Kr(Du(n)),i),i=u,n=s):i=nu.Es})).next((function(){i!==nu.Es&&e(new Kr(Du(n)),i)}))},t.prototype.cr=function(t){return this.db.ah().zr(t)},t}();function Da(t,e){return Ia(t).put(function(t,e){return new ca(0,_u(t.path),e)}(e,t.Ro))}function ka(t,e){var n=t.projectId;return t.i||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var xa=function(){function t(t,e,n){this.persistence=t,this.Th=e,this.Eh=new ai(kr),this.Ih=new Ur((function(t){return Jr(t)}),$r),this.mh=jr.min(),this.Gn=t.oh(n),this.Ah=t.ah(),this.ko=t.hh(),this.Rh=new tu(this.Ah,this.Gn,this.persistence.uh()),this.Th.Ph(this.Rh)}return t.prototype.er=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.ur(n,e.Eh)}))},t}();function Ra(t,e){var n=Ar(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.Ah.jr({Gr:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=Qs.resolve();return o.forEach((function(t){s=s.next((function(){return r.Ln(e,t)})).next((function(e){var o=e,s=n.Pn.get(t);_r(null!==s),(!o||o.version.o(s)<0)&&(o=i.En(t,o,n))&&r.xn(o,n.Rn)}))})),s.next((function(){return t.Gn.br(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n.Gn.Cr(t)})).next((function(){return n.Rh.Zn(t,r)}))}))}function Pa(t){var e=Ar(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.ko.ro(t)}))}function La(t,e){var n=Ar(t),r=e.Z,i=n.Eh;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.Ah.jr({Gr:!0});i=n.Eh;var s=[];e.Wt.forEach((function(e,o){var u=i.get(o);if(u){s.push(n.ko.Io(t,e.Zt,o).next((function(){return n.ko.To(t,e.Jt,o)})));var a=e.resumeToken;if(a.Y()>0){var c=u.et(a,r).tt(t.Ro);i=i.st(o,c),function(t,e,n){return _r(e.resumeToken.Y()>0),0===t.resumeToken.Y()||e.Z.m()-t.Z.m()>=3e8||n.Jt.size+n.Xt.size+n.Zt.size>0}(u,c,e)&&s.push(n.ko.lo(t,c))}}}));var u=di(),a=bi();if(e.Kt.forEach((function(t,e){a=a.add(t)})),s.push(o.getEntries(t,a).next((function(i){e.Kt.forEach((function(a,c){var h=i.get(a);c instanceof vs&&c.version.isEqual(jr.min())?(o.Mn(a,r),u=u.st(a,c)):null==h||c.version.o(h.version)>0||0===c.version.o(h.version)&&h.hasPendingWrites?(o.xn(c,r),u=u.st(a,c)):br("LocalStore","Ignoring outdated watch update for ",a,". Current version:",h.version," Watch version:",c.version),e.Gt.has(a)&&s.push(n.persistence.dr.wh(t,a))}))}))),!r.isEqual(jr.min())){var c=n.ko.ro(t).next((function(e){return n.ko.ho(t,t.Ro,r)}));s.push(c)}return Qs.Cn(s).next((function(){return o.apply(t)})).next((function(){return n.Rh.ts(t,u)}))})).then((function(t){return n.Eh=i,t}))}function Oa(t,e){var n=Ar(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n.Gn.gr(t,e)}))}function Ca(t,e){var n=Ar(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.ko.wo(t,e).next((function(i){return i?(r=i,Qs.resolve(r)):n.ko.no(t).next((function(i){return r=new ii(e,i,0,t.Ro),n.ko.ao(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Eh.get(t.targetId);return(null===r||t.Z.o(r.Z)>0)&&(n.Eh=n.Eh.st(t.targetId,t),n.Ih.set(e,t.targetId)),t}))}function Va(t,r,i){return e(this,void 0,void 0,(function(){var e,o,s,u;return n(this,(function(n){switch(n.label){case 0:e=Ar(t),o=e.Eh.get(r),s=i?"readwrite":"readwrite-primary",n.label=1;case 1:return n.trys.push([1,4,,5]),i?[3,3]:[4,e.persistence.runTransaction("Release target",s,(function(t){return e.persistence.dr.removeTarget(t,o)}))];case 2:n.sent(),n.label=3;case 3:return[3,5];case 4:if(!au(u=n.sent()))throw u;return br("LocalStore","Failed to update sequence numbers for target "+r+": "+u),[3,5];case 5:return e.Eh=e.Eh.remove(r),e.Ih.delete(o.target),[2]}}))}))}function Ua(t,e,n){var r=Ar(t),i=jr.min(),o=bi();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=Ar(t),i=r.Ih.get(n);return void 0!==i?Qs.resolve(r.Eh.get(i)):r.ko.wo(e,n)}(r,t,Ts(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.ko.Ao(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.Th.ns(t,e,n?i:jr.min(),n?o:bi())})).next((function(t){return{documents:t,gh:o}}))}))}function Ma(t,e){var n=Ar(t),r=Ar(n.ko),i=n.Eh.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.Me(t,e).next((function(t){return t?t.target:null}))}))}function qa(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){if(t.code!==Mr.FAILED_PRECONDITION||t.message!==Js)throw t;return br("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fa=function(){function t(){this.Vh=new fi(ja.yh),this.ph=new fi(ja.bh)}return t.prototype._=function(){return this.Vh._()},t.prototype.Eo=function(t,e){var n=new ja(t,e);this.Vh=this.Vh.add(n),this.ph=this.ph.add(n)},t.prototype.vh=function(t,e){var n=this;t.forEach((function(t){return n.Eo(t,e)}))},t.prototype.mo=function(t,e){this.Sh(new ja(t,e))},t.prototype.Dh=function(t,e){var n=this;t.forEach((function(t){return n.mo(t,e)}))},t.prototype.Ch=function(t){var e=this,n=new Kr(new Br([])),r=new ja(n,t),i=new ja(n,t+1),o=[];return this.ph.St([r,i],(function(t){e.Sh(t),o.push(t.key)})),o},t.prototype.Nh=function(){var t=this;this.Vh.forEach((function(e){return t.Sh(e)}))},t.prototype.Sh=function(t){this.Vh=this.Vh.delete(t),this.ph=this.ph.delete(t)},t.prototype.Fh=function(t){var e=new Kr(new Br([])),n=new ja(e,t),r=new ja(e,t+1),i=bi();return this.ph.St([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.Nr=function(t){var e=new ja(t,0),n=this.Vh.Ct(e);return null!==n&&t.isEqual(n.key)},t}(),ja=function(){function t(t,e){this.key=t,this.kh=e}return t.yh=function(t,e){return Kr.P(t.key,e.key)||kr(t.kh,e.kh)},t.bh=function(t,e){return kr(t.kh,e.kh)||Kr.P(t.key,e.key)},t}(),Ga=function(){function t(t){this.uid=t}return t.prototype.Er=function(){return null!=this.uid},t.prototype.$h=function(){return this.Er()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();Ga.UNAUTHENTICATED=new Ga(null),Ga.xh=new Ga("google-credentials-uid"),Ga.Oh=new Ga("first-party-uid");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ba=function(t,e){this.user=e,this.type="OAuth",this.Mh={},this.Mh.Authorization="Bearer "+t},za=function(){function t(){this.Lh=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.qh=function(){},t.prototype.Bh=function(t){this.Lh=t,t(Ga.UNAUTHENTICATED)},t.prototype.Uh=function(){this.Lh=null},t}(),Ha=function(){function t(t){var e=this;this.Qh=null,this.currentUser=Ga.UNAUTHENTICATED,this.Wh=!1,this.jh=0,this.Lh=null,this.forceRefresh=!1,this.Qh=function(){e.jh++,e.currentUser=e.Kh(),e.Wh=!0,e.Lh&&e.Lh(e.currentUser)},this.jh=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.Qh):(this.Qh(null),t.get().then((function(t){e.auth=t,e.Qh&&e.auth.addAuthTokenListener(e.Qh)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.jh,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.jh!==e?(br("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(_r("string"==typeof n.accessToken),new Ba(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.qh=function(){this.forceRefresh=!0},t.prototype.Bh=function(t){this.Lh=t,this.Wh&&t(this.currentUser)},t.prototype.Uh=function(){this.auth&&this.auth.removeAuthTokenListener(this.Qh),this.Qh=null,this.Lh=null},t.prototype.Kh=function(){var t=this.auth&&this.auth.getUid();return _r(null===t||"string"==typeof t),new Ga(t)},t}(),Ka=function(){function t(t,e){this.Gh=t,this.zh=e,this.type="FirstParty",this.user=Ga.Oh}return Object.defineProperty(t.prototype,"Mh",{get:function(){var t={"X-Goog-AuthUser":this.zh},e=this.Gh.auth.Hh([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),Wa=function(){function t(t,e){this.Gh=t,this.zh=e}return t.prototype.getToken=function(){return Promise.resolve(new Ka(this.Gh,this.zh))},t.prototype.Bh=function(t){t(Ga.Oh)},t.prototype.Uh=function(){},t.prototype.qh=function(){},t}(),Ya=function(){function t(t,e,n,r,i,o){this.Is=t,this.Yh=n,this.Jh=r,this.Xh=i,this.listener=o,this.state=0,this.Zh=0,this.ta=null,this.stream=null,this.Ti=new iu(t,e)}return t.prototype.ea=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.na=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.sa()},t.prototype.stop=function(){return e(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return this.ea()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.ia=function(){this.state=0,this.Ti.reset()},t.prototype.ra=function(){var t=this;this.na()&&null===this.ta&&(this.ta=this.Is.Ss(this.Yh,6e4,(function(){return t.oa()})))},t.prototype.ha=function(t){this.aa(),this.stream.send(t)},t.prototype.oa=function(){return e(this,void 0,void 0,(function(){return n(this,(function(t){return this.na()?[2,this.close(0)]:[2]}))}))},t.prototype.aa=function(){this.ta&&(this.ta.cancel(),this.ta=null)},t.prototype.close=function(t,r){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return this.aa(),this.Ti.cancel(),this.Zh++,3!==t?this.Ti.reset():r&&r.code===Mr.RESOURCE_EXHAUSTED?(Ir(r.toString()),Ir("Using maximum backoff delay to prevent overloading the backend."),this.Ti.ps()):r&&r.code===Mr.UNAUTHENTICATED&&this.Xh.qh(),null!==this.stream&&(this.ua(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.ca(r)];case 1:return e.sent(),[2]}}))}))},t.prototype.ua=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.la(this.Zh),n=this.Zh;this.Xh.getToken().then((function(e){t.Zh===n&&t._a(e)}),(function(n){e((function(){var e=new qr(Mr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.fa(e)}))}))},t.prototype._a=function(t){var e=this,n=this.la(this.Zh);this.stream=this.da(t),this.stream.wa((function(){n((function(){return e.state=2,e.listener.wa()}))})),this.stream.ca((function(t){n((function(){return e.fa(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.sa=function(){var t=this;this.state=4,this.Ti.bs((function(){return e(t,void 0,void 0,(function(){return n(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.fa=function(t){return br("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.la=function(t){var e=this;return function(n){e.Is.ai((function(){return e.Zh===t?n():(br("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),Xa=function(e){function n(t,n,r,i,o){var s=this;return(s=e.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).serializer=i,s}return t(n,e),n.prototype.da=function(t){return this.Jh.Ta("Listen",t)},n.prototype.onMessage=function(t){this.Ti.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Nr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.Le?(_r(void 0===e||"string"==typeof e),ei.fromBase64String(e||"")):(_r(void 0===e||e instanceof Uint8Array),ei.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=e.targetChange.cause,u=s&&function(t){var e=void 0===t.code?Mr.UNKNOWN:ui(t.code);return new qr(e,t.message||"")}(s);n=new xi(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;var a=e.documentChange;a.document,a.document.name,a.document.updateTime;var c=lo(t,a.document.name),h=ao(a.document.updateTime),f=new hs({mapValue:{fields:a.document.fields}}),l=new ds(c,h,f,{}),p=a.targetIds||[],d=a.removedTargetIds||[];n=new Di(p,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;var v=e.documentDelete;v.document;var y=lo(t,v.document),g=v.readTime?ao(v.readTime):jr.min(),m=new vs(y,g),w=v.removedTargetIds||[];n=new Di([],w,m.key,m)}else if("documentRemove"in e){e.documentRemove;var b=e.documentRemove;b.document;var I=lo(t,b.document),E=b.removedTargetIds||[];n=new Di([],E,I,null)}else{if(!("filter"in e))return Nr();e.filter;var T=e.filter;T.targetId;var N=T.count||0,_=new oi(N),A=T.targetId;n=new ki(A,_)}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return jr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?jr.min():e.readTime?ao(e.readTime):jr.min()}(t);return this.listener.Ea(e,n)},n.prototype.Ia=function(t){var e={};e.database=yo(this.serializer),e.addTarget=function(t,e){var n,r=e.target;return(n=ti(r)?{documents:Io(t,r)}:{query:Eo(t,r)}).targetId=e.targetId,e.resumeToken.Y()>0&&(n.resumeToken=so(t,e.resumeToken)),n}(this.serializer,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Nr()}}(0,e.X);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.ha(e)},n.prototype.ma=function(t){var e={};e.database=yo(this.serializer),e.removeTarget=t,this.ha(e)},n}(Ya),Qa=function(e){function n(t,n,r,i,o){var s=this;return(s=e.call(this,t,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).serializer=i,s.Aa=!1,s}return t(n,e),Object.defineProperty(n.prototype,"Ra",{get:function(){return this.Aa},enumerable:!1,configurable:!0}),n.prototype.start=function(){this.Aa=!1,this.lastStreamToken=void 0,e.prototype.start.call(this)},n.prototype.ua=function(){this.Aa&&this.Pa([])},n.prototype.da=function(t){return this.Jh.Ta("Write",t)},n.prototype.onMessage=function(t){if(_r(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Aa){this.Ti.reset();var e=function(t,e){return t&&t.length>0?(_r(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?ao(t.updateTime):ao(e);n.isEqual(jr.min())&&(n=ao(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new Wo(n,r)}(t,e)}))):[]}(t.writeResults,t.commitTime),n=ao(t.commitTime);return this.listener.ga(n,e)}return _r(!t.writeResults||0===t.writeResults.length),this.Aa=!0,this.listener.Va()},n.prototype.ya=function(){var t={};t.database=yo(this.serializer),this.ha(t)},n.prototype.Pa=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return wo(e.serializer,t)}))};this.ha(n)},n}(Ya),Za=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).credentials=t,i.Jh=n,i.serializer=r,i.pa=!1,i}return t(n,e),n.prototype.ba=function(){if(this.pa)throw new qr(Mr.FAILED_PRECONDITION,"The client has already been terminated.")},n.prototype.va=function(t,e,n){var r=this;return this.ba(),this.credentials.getToken().then((function(i){return r.Jh.va(t,e,n,i)})).catch((function(t){throw t.code===Mr.UNAUTHENTICATED&&r.credentials.qh(),t}))},n.prototype.Sa=function(t,e,n){var r=this;return this.ba(),this.credentials.getToken().then((function(i){return r.Jh.Sa(t,e,n,i)})).catch((function(t){throw t.code===Mr.UNAUTHENTICATED&&r.credentials.qh(),t}))},n.prototype.terminate=function(){this.pa=!1},n}((function(){})),Ja=function(){function t(t,e){this.ei=t,this.Da=e,this.state="Unknown",this.Ca=0,this.Na=null,this.Fa=!0}return t.prototype.ka=function(){var t=this;0===this.Ca&&(this.$a("Unknown"),this.Na=this.ei.Ss("online_state_timeout",1e4,(function(){return t.Na=null,t.xa("Backend didn't respond within 10 seconds."),t.$a("Offline"),Promise.resolve()})))},t.prototype.Oa=function(t){"Online"===this.state?this.$a("Unknown"):(this.Ca++,this.Ca>=1&&(this.Ma(),this.xa("Connection failed 1 times. Most recent error: "+t.toString()),this.$a("Offline")))},t.prototype.set=function(t){this.Ma(),this.Ca=0,"Online"===t&&(this.Fa=!1),this.$a(t)},t.prototype.$a=function(t){t!==this.state&&(this.state=t,this.Da(t))},t.prototype.xa=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Fa?(Ir(e),this.Fa=!1):br("OnlineStateTracker",e)},t.prototype.Ma=function(){null!==this.Na&&(this.Na.cancel(),this.Na=null)},t}(),$a=function(){function t(t,r,i,o,s){var u=this;this.La=t,this.qa=r,this.ei=i,this.Ba=[],this.Ua=new Map,this.Qa=null,this.Wa=new Set,this.ja=s,this.ja.Ka((function(t){i.ai((function(){return e(u,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return this.Ga()?(br("RemoteStore","Restarting streams for network reachability change."),[4,this.za()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Ha=new Ja(i,o),this.Ya=function(t,e,n){var r=Ar(t);return r.ba(),new Xa(e,r.Jh,r.credentials,r.serializer,n)}(this.qa,i,{wa:this.Ja.bind(this),ca:this.Xa.bind(this),Ea:this.Za.bind(this)}),this.tu=function(t,e,n){var r=Ar(t);return r.ba(),new Qa(e,r.Jh,r.credentials,r.serializer,n)}(this.qa,i,{wa:this.eu.bind(this),ca:this.nu.bind(this),Va:this.su.bind(this),ga:this.ga.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return this.Wa.delete(0),this.iu()},t.prototype.iu=function(){return e(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return this.Ga()?(this.ru()?this.ou():this.Ha.set("Unknown"),[4,this.hu()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.disableNetwork=function(){return e(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return this.Wa.add(0),[4,this.au()];case 1:return t.sent(),this.Ha.set("Offline"),[2]}}))}))},t.prototype.au=function(){return e(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return[4,this.tu.stop()];case 1:return t.sent(),[4,this.Ya.stop()];case 2:return t.sent(),this.Ba.length>0&&(br("RemoteStore","Stopping write stream with "+this.Ba.length+" pending writes"),this.Ba=[]),this.uu(),[2]}}))}))},t.prototype.th=function(){return e(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return br("RemoteStore","RemoteStore shutting down."),this.Wa.add(5),[4,this.au()];case 1:return t.sent(),this.ja.th(),this.Ha.set("Unknown"),[2]}}))}))},t.prototype.listen=function(t){this.Ua.has(t.targetId)||(this.Ua.set(t.targetId,t),this.ru()?this.ou():this.Ya.na()&&this.cu(t))},t.prototype.lu=function(t){this.Ua.delete(t),this.Ya.na()&&this._u(t),0===this.Ua.size&&(this.Ya.na()?this.Ya.ra():this.Ga()&&this.Ha.set("Unknown"))},t.prototype.Me=function(t){return this.Ua.get(t)||null},t.prototype.Oe=function(t){return this.fu.Oe(t)},t.prototype.cu=function(t){this.Qa.we(t.targetId),this.Ya.Ia(t)},t.prototype._u=function(t){this.Qa.we(t),this.Ya.ma(t)},t.prototype.ou=function(){this.Qa=new Pi(this),this.Ya.start(),this.Ha.ka()},t.prototype.ru=function(){return this.Ga()&&!this.Ya.ea()&&this.Ua.size>0},t.prototype.Ga=function(){return 0===this.Wa.size},t.prototype.uu=function(){this.Qa=null},t.prototype.Ja=function(){return e(this,void 0,void 0,(function(){var t=this;return n(this,(function(e){return this.Ua.forEach((function(e,n){t.cu(e)})),[2]}))}))},t.prototype.Xa=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){return this.uu(),this.ru()?(this.Ha.Oa(t),this.ou()):this.Ha.set("Unknown"),[2]}))}))},t.prototype.Za=function(t,r){return e(this,void 0,void 0,(function(){var e,i,o;return n(this,(function(n){switch(n.label){case 0:if(this.Ha.set("Online"),!(t instanceof xi&&2===t.state&&t.cause))return[3,6];n.label=1;case 1:return n.trys.push([1,3,,5]),[4,this.du(t)];case 2:return n.sent(),[3,5];case 3:return e=n.sent(),br("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),e),[4,this.wu(e)];case 4:return n.sent(),[3,5];case 5:return[3,13];case 6:if(t instanceof Di?this.Qa.ge(t):t instanceof ki?this.Qa.Ce(t):this.Qa.pe(t),r.isEqual(jr.min()))return[3,13];n.label=7;case 7:return n.trys.push([7,11,,13]),[4,Pa(this.La)];case 8:return i=n.sent(),r.o(i)>=0?[4,this.Tu(r)]:[3,10];case 9:n.sent(),n.label=10;case 10:return[3,13];case 11:return br("RemoteStore","Failed to raise snapshot:",o=n.sent()),[4,this.wu(o)];case 12:return n.sent(),[3,13];case 13:return[2]}}))}))},t.prototype.wu=function(t,r){return e(this,void 0,void 0,(function(){var i=this;return n(this,(function(o){switch(o.label){case 0:if(!au(t))throw t;return this.Wa.add(1),[4,this.au()];case 1:return o.sent(),this.Ha.set("Offline"),r||(r=function(){return Pa(i.La)}),this.ei.gi((function(){return e(i,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return br("RemoteStore","Retrying IndexedDB access"),[4,r()];case 1:return t.sent(),this.Wa.delete(1),[4,this.iu()];case 2:return t.sent(),[2]}}))}))})),[2]}}))}))},t.prototype.Eu=function(t){var e=this;return t().catch((function(n){return e.wu(n,t)}))},t.prototype.Tu=function(t){var e=this,n=this.Qa.ke(t);return n.Wt.forEach((function(n,r){if(n.resumeToken.Y()>0){var i=e.Ua.get(r);i&&e.Ua.set(r,i.et(n.resumeToken,t))}})),n.jt.forEach((function(t){var n=e.Ua.get(t);if(n){e.Ua.set(t,n.et(ei.J,n.Z)),e._u(t);var r=new ii(n.target,t,1,n.sequenceNumber);e.cu(r)}})),this.fu.Iu(n)},t.prototype.du=function(t){return e(this,void 0,void 0,(function(){var e,r,i,o;return n(this,(function(n){switch(n.label){case 0:e=t.cause,r=0,i=t.targetIds,n.label=1;case 1:return r<i.length?(o=i[r],this.Ua.has(o)?[4,this.fu.mu(o,e)]:[3,3]):[3,5];case 2:n.sent(),this.Ua.delete(o),this.Qa.removeTarget(o),n.label=3;case 3:n.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))},t.prototype.hu=function(){return e(this,void 0,void 0,(function(){var t,e,r;return n(this,(function(n){switch(n.label){case 0:t=this.Ba.length>0?this.Ba[this.Ba.length-1].batchId:-1,n.label=1;case 1:if(!this.Au())return[3,7];n.label=2;case 2:return n.trys.push([2,4,,6]),[4,Oa(this.La,t)];case 3:return null===(e=n.sent())?(0===this.Ba.length&&this.tu.ra(),[3,7]):(t=e.batchId,this.Ru(e),[3,6]);case 4:return r=n.sent(),[4,this.wu(r)];case 5:return n.sent(),[3,6];case 6:return[3,1];case 7:return this.Pu()&&this.gu(),[2]}}))}))},t.prototype.Au=function(){return this.Ga()&&this.Ba.length<10},t.prototype.Vu=function(){return this.Ba.length},t.prototype.Ru=function(t){this.Ba.push(t),this.tu.na()&&this.tu.Ra&&this.tu.Pa(t.mutations)},t.prototype.Pu=function(){return this.Ga()&&!this.tu.ea()&&this.Ba.length>0},t.prototype.gu=function(){this.tu.start()},t.prototype.eu=function(){return e(this,void 0,void 0,(function(){return n(this,(function(t){return this.tu.ya(),[2]}))}))},t.prototype.su=function(){return e(this,void 0,void 0,(function(){var t,e,r;return n(this,(function(n){for(t=0,e=this.Ba;t<e.length;t++)r=e[t],this.tu.Pa(r.mutations);return[2]}))}))},t.prototype.ga=function(t,r){return e(this,void 0,void 0,(function(){var e,i,o=this;return n(this,(function(n){switch(n.label){case 0:return e=this.Ba.shift(),i=Xs.from(e,t,r),[4,this.Eu((function(){return o.fu.yu(i)}))];case 1:return n.sent(),[4,this.hu()];case 2:return n.sent(),[2]}}))}))},t.prototype.nu=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return t&&this.tu.Ra?[4,this.pu(t)]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.Pu()&&this.gu(),[2]}}))}))},t.prototype.pu=function(t){return e(this,void 0,void 0,(function(){var e,r,i=this;return n(this,(function(n){switch(n.label){case 0:return si(r=t.code)&&r!==Mr.ABORTED?(e=this.Ba.shift(),this.tu.ia(),[4,this.Eu((function(){return i.fu.bu(e.batchId,t)}))]):[3,3];case 1:return n.sent(),[4,this.hu()];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.za=function(){return e(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return this.Wa.add(4),[4,this.au()];case 1:return t.sent(),this.Ha.set("Unknown"),this.tu.ia(),this.Ya.ia(),this.Wa.delete(4),[4,this.iu()];case 2:return t.sent(),[2]}}))}))},t.prototype.vu=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return this.ei.pi(),br("RemoteStore","RemoteStore received new credentials"),this.Wa.add(3),[4,this.au()];case 1:return e.sent(),this.Ha.set("Unknown"),[4,this.fu.vu(t)];case 2:return e.sent(),this.Wa.delete(3),[4,this.iu()];case 3:return e.sent(),[2]}}))}))},t.prototype.Su=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return t?(this.Wa.delete(2),[4,this.iu()]):[3,2];case 1:return e.sent(),[3,5];case 2:return t?[3,4]:(this.Wa.add(2),[4,this.au()]);case 3:e.sent(),this.Ha.set("Unknown"),e.label=4;case 4:e.label=5;case 5:return[2]}}))}))},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tc(t,e){return"firestore_clients_"+t+"_"+e}function ec(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.Er()&&(r+="_"+e.uid),r}function nc(t,e){return"firestore_targets_"+t+"_"+e}var rc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Du=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),s=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(s=new qr(i.error.code,i.error.message)),o?new t(e,n,i.state,s):(Ir("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Cu=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),ic=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Du=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new qr(r.error.code,r.error.message)),i?new t(e,r.state,o):(Ir("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Cu=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),oc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Du=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Ei(),s=0;i&&s<r.activeTargetIds.length;++s)i=Xr(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Ir("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),sc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Du=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Ir("SharedClientState","Failed to parse online state: "+e),null)},t}(),uc=function(){function t(){this.activeTargetIds=Ei()}return t.prototype.Nu=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Fu=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Cu=function(){var t={activeTargetIds:this.activeTargetIds.N(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),ac=function(){function t(t,e,n,r,i){this.window=t,this.Is=e,this.persistenceKey=n,this.ku=r,this.fu=null,this.Da=null,this.fs=null,this.$u=this.xu.bind(this),this.Ou=new ai(kr),this.tr=!1,this.Mu=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Lu=tc(this.persistenceKey,this.ku),this.qu=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Ou=this.Ou.st(this.ku,new uc),this.Bu=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Uu=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Qu=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Wu=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.$u)}return t.ks=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return e(this,void 0,void 0,(function(){var t,e,r,i,o,s,u,a,c,h,f,l=this;return n(this,(function(n){switch(n.label){case 0:return[4,this.fu.rh()];case 1:for(t=n.sent(),e=0,r=t;e<r.length;e++)(i=r[e])!==this.ku&&(o=this.getItem(tc(this.persistenceKey,i)))&&(s=oc.Du(i,o))&&(this.Ou=this.Ou.st(s.clientId,s));for(this.ju(),(u=this.storage.getItem(this.Wu))&&(a=this.Ku(u))&&this.Gu(a),c=0,h=this.Mu;c<h.length;c++)f=h[c],this.xu(f);return this.Mu=[],this.window.addEventListener("unload",(function(){return l.th()})),this.tr=!0,[2]}}))}))},t.prototype.Ts=function(t){this.setItem(this.qu,JSON.stringify(t))},t.prototype.zu=function(){return this.Hu(this.Ou)},t.prototype.Yu=function(t){var e=!1;return this.Ou.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.Ju=function(t){this.Xu(t,"pending")},t.prototype.Zu=function(t,e,n){this.Xu(t,e,n),this.tc(t)},t.prototype.ec=function(t){var e="not-current";if(this.Yu(t)){var n=this.storage.getItem(nc(this.persistenceKey,t));if(n){var r=ic.Du(t,n);r&&(e=r.state)}}return this.nc.Nu(t),this.ju(),e},t.prototype.sc=function(t){this.nc.Fu(t),this.ju()},t.prototype.ic=function(t){return this.nc.activeTargetIds.has(t)},t.prototype.rc=function(t){this.removeItem(nc(this.persistenceKey,t))},t.prototype.oc=function(t,e,n){this.hc(t,e,n)},t.prototype.ac=function(t,e,n){var r=this;e.forEach((function(t){r.tc(t)})),this.currentUser=t,n.forEach((function(t){r.Ju(t)}))},t.prototype.uc=function(t){this.cc(t)},t.prototype.th=function(){this.tr&&(this.window.removeEventListener("storage",this.$u),this.removeItem(this.Lu),this.tr=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return br("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){br("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){br("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.xu=function(t){var r=this,i=t;if(i.storageArea===this.storage){if(br("SharedClientState","EVENT",i.key,i.newValue),i.key===this.Lu)return void Ir("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Is.gi((function(){return e(r,void 0,void 0,(function(){var t,e,r,o,s,u;return n(this,(function(n){if(this.tr){if(null!==i.key)if(this.Bu.test(i.key)){if(null==i.newValue)return t=this.lc(i.key),[2,this._c(t,null)];if(e=this.fc(i.key,i.newValue))return[2,this._c(e.clientId,e)]}else if(this.Uu.test(i.key)){if(null!==i.newValue&&(r=this.dc(i.key,i.newValue)))return[2,this.wc(r)]}else if(this.Qu.test(i.key)){if(null!==i.newValue&&(o=this.Tc(i.key,i.newValue)))return[2,this.Ec(o)]}else if(i.key===this.Wu){if(null!==i.newValue&&(s=this.Ku(i.newValue)))return[2,this.Gu(s)]}else i.key===this.qu&&(u=function(t){var e=nu.Es;if(null!=t)try{var n=JSON.parse(t);_r("number"==typeof n),e=n}catch(t){Ir("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(i.newValue))!==nu.Es&&this.fs(u)}else this.Mu.push(i);return[2]}))}))}))}},Object.defineProperty(t.prototype,"nc",{get:function(){return this.Ou.get(this.ku)},enumerable:!1,configurable:!0}),t.prototype.ju=function(){this.setItem(this.Lu,this.nc.Cu())},t.prototype.Xu=function(t,e,n){var r=new rc(this.currentUser,t,e,n),i=ec(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Cu())},t.prototype.tc=function(t){var e=ec(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.cc=function(t){var e={clientId:this.ku,onlineState:t};this.storage.setItem(this.Wu,JSON.stringify(e))},t.prototype.hc=function(t,e,n){var r=nc(this.persistenceKey,t),i=new ic(t,e,n);this.setItem(r,i.Cu())},t.prototype.lc=function(t){var e=this.Bu.exec(t);return e?e[1]:null},t.prototype.fc=function(t,e){var n=this.lc(t);return oc.Du(n,e)},t.prototype.dc=function(t,e){var n=this.Uu.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return rc.Du(new Ga(i),r,e)},t.prototype.Tc=function(t,e){var n=this.Qu.exec(t),r=Number(n[1]);return ic.Du(r,e)},t.prototype.Ku=function(t){return sc.Du(t)},t.prototype.wc=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.fu.Ic(t.batchId,t.state,t.error)]:(br("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.Ec=function(t){return this.fu.mc(t.targetId,t.state,t.error)},t.prototype._c=function(t,e){var n=this,r=e?this.Ou.st(t,e):this.Ou.remove(t),i=this.Hu(this.Ou),o=this.Hu(r),s=[],u=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||u.push(t)})),this.fu.Ac(s,u).then((function(){n.Ou=r}))},t.prototype.Gu=function(t){this.Ou.get(t.clientId)&&this.Da(t.onlineState)},t.prototype.Hu=function(t){var e=Ei();return t.forEach((function(t,n){e=e.Nt(n.activeTargetIds)})),e},t}(),cc=function(){function t(){this.Rc=new uc,this.Pc={},this.Da=null,this.fs=null}return t.prototype.Ju=function(t){},t.prototype.Zu=function(t,e,n){},t.prototype.ec=function(t){return this.Rc.Nu(t),this.Pc[t]||"not-current"},t.prototype.oc=function(t,e,n){this.Pc[t]=e},t.prototype.sc=function(t){this.Rc.Fu(t)},t.prototype.ic=function(t){return this.Rc.activeTargetIds.has(t)},t.prototype.rc=function(t){delete this.Pc[t]},t.prototype.zu=function(){return this.Rc.activeTargetIds},t.prototype.Yu=function(t){return this.Rc.activeTargetIds.has(t)},t.prototype.start=function(){return this.Rc=new uc,Promise.resolve()},t.prototype.ac=function(t,e,n){},t.prototype.uc=function(t){},t.prototype.th=function(){},t.prototype.Ts=function(t){},t}(),hc=function(t){this.key=t},fc=function(t){this.key=t},lc=function(){function t(t,e){this.query=t,this.gc=e,this.Vc=null,this.Yt=!1,this.yc=bi(),this.qt=bi(),this.pc=Rs(t),this.bc=new Ti(this.pc)}return Object.defineProperty(t.prototype,"vc",{get:function(){return this.gc},enumerable:!1,configurable:!0}),t.prototype.Sc=function(t,e){var n=this,r=e?e.Dc:new Ni,i=e?e.bc:this.bc,o=e?e.qt:this.qt,s=i,u=!1,a=this.query.an()&&i.size===this.query.limit?i.last():null,c=this.query.un()&&i.size===this.query.limit?i.first():null;if(t.ht((function(t,e){var h=i.get(t),f=e instanceof ds?e:null;f&&(f=xs(n.query,f)?f:null);var l=!!h&&n.qt.has(h.key),p=!!f&&(f.Ge||n.qt.has(f.key)&&f.hasCommittedMutations),d=!1;h&&f?h.data().isEqual(f.data())?l!==p&&(r.track({type:3,doc:f}),d=!0):n.Cc(h,f)||(r.track({type:2,doc:f}),d=!0,(a&&n.pc(f,a)>0||c&&n.pc(f,c)<0)&&(u=!0)):!h&&f?(r.track({type:0,doc:f}),d=!0):h&&!f&&(r.track({type:1,doc:h}),d=!0,(a||c)&&(u=!0)),d&&(f?(s=s.add(f),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),this.query.an()||this.query.un())for(;s.size>this.query.limit;){var h=this.query.an()?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{bc:s,Dc:r,Nc:u,qt:o}},t.prototype.Cc=function(t,e){return t.Ge&&e.hasCommittedMutations&&!e.Ge},t.prototype.Un=function(t,e,n){var r=this,i=this.bc;this.bc=t.bc,this.qt=t.qt;var o=t.Dc.Mt();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Nr()}};return n(t)-n(e)}(t.type,e.type)||r.pc(t.doc,e.doc)})),this.Fc(n);var s=e?this.kc():[],u=0===this.yc.size&&this.Yt?1:0,a=u!==this.Vc;return this.Vc=u,0!==o.length||a?{snapshot:new _i(this.query,t.bc,i,o,t.qt,0===u,a,!1),$c:s}:{$c:s}},t.prototype.xc=function(t){return this.Yt&&"Offline"===t?(this.Yt=!1,this.Un({bc:this.bc,Dc:new Ni,qt:this.qt,Nc:!1},!1)):{$c:[]}},t.prototype.Oc=function(t){return!this.gc.has(t)&&!!this.bc.has(t)&&!this.bc.get(t).Ge},t.prototype.Fc=function(t){var e=this;t&&(t.Jt.forEach((function(t){return e.gc=e.gc.add(t)})),t.Xt.forEach((function(t){})),t.Zt.forEach((function(t){return e.gc=e.gc.delete(t)})),this.Yt=t.Yt)},t.prototype.kc=function(){var t=this;if(!this.Yt)return[];var e=this.yc;this.yc=bi(),this.bc.forEach((function(e){t.Oc(e.key)&&(t.yc=t.yc.add(e.key))}));var n=[];return e.forEach((function(e){t.yc.has(e)||n.push(new fc(e))})),this.yc.forEach((function(t){e.has(t)||n.push(new hc(t))})),n},t.prototype.Mc=function(t){this.gc=t.gh,this.yc=bi();var e=this.Sc(t.documents);return this.Un(e,!0)},t.prototype.Lc=function(){return _i.Qt(this.query,this.bc,this.qt,0===this.Vc)},t}(),pc=function(t,e,n){this.query=t,this.targetId=e,this.view=n},dc=function(t){this.key=t,this.qc=!1},vc=function(){function t(t,e,n,r,i,o){this.La=t,this.Bc=e,this.qa=n,this.Uc=r,this.currentUser=i,this.Qc=o,this.Wc=null,this.jc=new Ur((function(t){return Ds(t)}),Ss),this.Kc=new Map,this.Gc=[],this.zc=new ai(Kr.P),this.Hc=new Map,this.Yc=new Fa,this.Jc={},this.Xc=new Map,this.Zc=ga.eo(),this.onlineState="Unknown",this.tl=void 0}return Object.defineProperty(t.prototype,"el",{get:function(){return!0===this.tl},enumerable:!1,configurable:!0}),t.prototype.subscribe=function(t){this.Wc=t},t.prototype.listen=function(t){return e(this,void 0,void 0,(function(){var e,r,i,o,s;return n(this,(function(n){switch(n.label){case 0:return this.nl("listen()"),(i=this.jc.get(t))?(e=i.targetId,this.Uc.ec(e),r=i.view.Lc(),[3,4]):[3,1];case 1:return[4,Ca(this.La,Ts(t))];case 2:return o=n.sent(),s=this.Uc.ec(o.targetId),e=o.targetId,[4,this.sl(t,e,"current"===s)];case 3:r=n.sent(),this.el&&this.Bc.listen(o),n.label=4;case 4:return[2,r]}}))}))},t.prototype.sl=function(t,r,i){return e(this,void 0,void 0,(function(){var e,o,s,u,a,c;return n(this,(function(n){switch(n.label){case 0:return[4,Ua(this.La,t,!0)];case 1:return e=n.sent(),o=new lc(t,e.gh),s=o.Sc(e.documents),u=Si.Ht(r,i&&"Offline"!==this.onlineState),a=o.Un(s,this.el,u),this.il(r,a.$c),c=new pc(t,r,o),[2,(this.jc.set(t,c),this.Kc.has(r)?this.Kc.get(r).push(t):this.Kc.set(r,[t]),a.snapshot)]}}))}))},t.prototype.lu=function(t){return e(this,void 0,void 0,(function(){var e,r,i=this;return n(this,(function(n){switch(n.label){case 0:return this.nl("unlisten()"),e=this.jc.get(t),(r=this.Kc.get(e.targetId)).length>1?[2,(this.Kc.set(e.targetId,r.filter((function(e){return!Ss(e,t)}))),void this.jc.delete(t))]:this.el?(this.Uc.sc(e.targetId),this.Uc.Yu(e.targetId)?[3,2]:[4,Va(this.La,e.targetId,!1).then((function(){i.Uc.rc(e.targetId),i.Bc.lu(e.targetId),i.rl(e.targetId)})).catch(qa)]):[3,3];case 1:n.sent(),n.label=2;case 2:return[3,5];case 3:return this.rl(e.targetId),[4,Va(this.La,e.targetId,!0)];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))},t.prototype.write=function(t,r){return e(this,void 0,void 0,(function(){var e,i,o;return n(this,(function(n){switch(n.label){case 0:this.nl("write()"),n.label=1;case 1:return n.trys.push([1,5,,6]),[4,function(t,e){var n,r=Ar(t),i=Fr.now(),o=e.reduce((function(t,e){return t.add(e.key)}),bi());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Rh.Zn(t,o).next((function(o){n=o;for(var s=[],u=0,a=e;u<a.length;u++){var c=a[u],h=$o(c,n.get(c.key));null!=h&&s.push(new rs(c.key,h,ls(h.proto.mapValue),Yo.exists(!0)))}return r.Gn.mr(t,i,s,e)}))})).then((function(t){var e=t.An(n);return{batchId:t.batchId,Fn:e}}))}(this.La,t)];case 2:return e=n.sent(),this.Uc.Ju(e.batchId),this.ol(e.batchId,r),[4,this.hl(e.Fn)];case 3:return n.sent(),[4,this.Bc.hu()];case 4:return n.sent(),[3,6];case 5:return i=n.sent(),o=mu(i,"Failed to persist write"),r.reject(o),[3,6];case 6:return[2]}}))}))},t.prototype.Iu=function(t){return e(this,void 0,void 0,(function(){var e,r=this;return n(this,(function(n){switch(n.label){case 0:this.nl("applyRemoteEvent()"),n.label=1;case 1:return n.trys.push([1,4,,6]),[4,La(this.La,t)];case 2:return e=n.sent(),t.Wt.forEach((function(t,e){var n=r.Hc.get(e);n&&(_r(t.Jt.size+t.Xt.size+t.Zt.size<=1),t.Jt.size>0?n.qc=!0:t.Xt.size>0?_r(n.qc):t.Zt.size>0&&(_r(n.qc),n.qc=!1))})),[4,this.hl(e,t)];case 3:return n.sent(),[3,6];case 4:return[4,qa(n.sent())];case 5:return n.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.xc=function(t,e){if(this.el&&0===e||!this.el&&1===e){this.nl("applyOnlineStateChange()");var n=[];this.jc.forEach((function(e,r){var i=r.view.xc(t);i.snapshot&&n.push(i.snapshot)})),this.Wc.al(t),this.Wc.Ea(n),this.onlineState=t,this.el&&this.Uc.uc(t)}},t.prototype.mu=function(t,r){return e(this,void 0,void 0,(function(){var e,i,o,s,u,a=this;return n(this,(function(n){switch(n.label){case 0:return this.nl("rejectListens()"),this.Uc.oc(t,"rejected",r),e=this.Hc.get(t),(i=e&&e.key)?(o=(o=new ai(Kr.P)).st(i,new vs(i,jr.min())),s=bi().add(i),u=new Ai(jr.min(),new Map,new fi(kr),o,s),[4,this.Iu(u)]):[3,2];case 1:return n.sent(),this.zc=this.zc.remove(i),this.Hc.delete(t),this.ul(),[3,4];case 2:return[4,Va(this.La,t,!1).then((function(){return a.rl(t,r)})).catch(qa)];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},t.prototype.yu=function(t){return e(this,void 0,void 0,(function(){var e,r;return n(this,(function(n){switch(n.label){case 0:this.nl("applySuccessfulWrite()"),e=t.batch.batchId,n.label=1;case 1:return n.trys.push([1,4,,6]),[4,Ra(this.La,t)];case 2:return r=n.sent(),this.cl(e,null),this.ll(e),this.Uc.Zu(e,"acknowledged"),[4,this.hl(r)];case 3:return n.sent(),[3,6];case 4:return[4,qa(n.sent())];case 5:return n.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.bu=function(t,r){return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:this.nl("rejectFailedWrite()"),n.label=1;case 1:return n.trys.push([1,4,,6]),[4,function(t,e){var n=Ar(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n.Gn.Rr(t,e).next((function(e){return _r(null!==e),r=e.keys(),n.Gn.br(t,e)})).next((function(){return n.Gn.Cr(t)})).next((function(){return n.Rh.Zn(t,r)}))}))}(this.La,t)];case 2:return e=n.sent(),this.cl(t,r),this.ll(t),this.Uc.Zu(t,"rejected",r),[4,this.hl(e)];case 3:return n.sent(),[3,6];case 4:return[4,qa(n.sent())];case 5:return n.sent(),[3,6];case 6:return[2]}}))}))},t.prototype._l=function(t){return e(this,void 0,void 0,(function(){var e,r,i,o;return n(this,(function(n){switch(n.label){case 0:this.Bc.Ga()||br("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,function(t){var e=Ar(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e.Gn.Vr(t)}))}(this.La)];case 2:return-1===(e=n.sent())?[2,void t.resolve()]:((r=this.Xc.get(e)||[]).push(t),this.Xc.set(e,r),[3,4]);case 3:return i=n.sent(),o=mu(i,"Initialization of waitForPendingWrites() operation failed"),t.reject(o),[3,4];case 4:return[2]}}))}))},t.prototype.ll=function(t){(this.Xc.get(t)||[]).forEach((function(t){t.resolve()})),this.Xc.delete(t)},t.prototype.fl=function(t){this.Xc.forEach((function(e){e.forEach((function(e){e.reject(new qr(Mr.CANCELLED,t))}))})),this.Xc.clear()},t.prototype.ol=function(t,e){var n=this.Jc[this.currentUser.$h()];n||(n=new ai(kr)),n=n.st(t,e),this.Jc[this.currentUser.$h()]=n},t.prototype.cl=function(t,e){var n=this.Jc[this.currentUser.$h()];if(n){var r=n.get(t);r&&(e?r.reject(e):r.resolve(),n=n.remove(t)),this.Jc[this.currentUser.$h()]=n}},t.prototype.rl=function(t,e){var n=this;void 0===e&&(e=null),this.Uc.sc(t);for(var r=0,i=this.Kc.get(t);r<i.length;r++){var o=i[r];this.jc.delete(o),e&&this.Wc.dl(o,e)}this.Kc.delete(t),this.el&&this.Yc.Ch(t).forEach((function(t){n.Yc.Nr(t)||n.wl(t)}))},t.prototype.wl=function(t){var e=this.zc.get(t);null!==e&&(this.Bc.lu(e),this.zc=this.zc.remove(t),this.Hc.delete(e),this.ul())},t.prototype.il=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof hc?(this.Yc.Eo(i.key,t),this.Tl(i)):i instanceof fc?(br("SyncEngine","Document no longer in limbo: "+i.key),this.Yc.mo(i.key,t),this.Yc.Nr(i.key)||this.wl(i.key)):Nr()}},t.prototype.Tl=function(t){var e=t.key;this.zc.get(e)||(br("SyncEngine","New document in limbo: "+e),this.Gc.push(e),this.ul())},t.prototype.ul=function(){for(;this.Gc.length>0&&this.zc.size<this.Qc;){var t=this.Gc.shift(),e=this.Zc.next();this.Hc.set(e,new dc(t)),this.zc=this.zc.st(t,e),this.Bc.listen(new ii(Ts(bs(t.path)),e,2,nu.Es))}},t.prototype.El=function(){return this.zc},t.prototype.Il=function(){return this.Gc},t.prototype.hl=function(t,r){return e(this,void 0,void 0,(function(){var i,o,s,u=this;return n(this,(function(a){switch(a.label){case 0:return i=[],o=[],s=[],this.jc.forEach((function(e,n){s.push(Promise.resolve().then((function(){var e=n.view.Sc(t);return e.Nc?Ua(u.La,n.query,!1).then((function(t){var r=t.documents;return n.view.Sc(r,e)})):e})).then((function(t){var e=r&&r.Wt.get(n.targetId),s=n.view.Un(t,u.el,e);if(u.il(n.targetId,s.$c),s.snapshot){u.el&&u.Uc.oc(n.targetId,s.snapshot.fromCache?"not-current":"current"),i.push(s.snapshot);var a=eu._s(n.targetId,s.snapshot);o.push(a)}})))})),[4,Promise.all(s)];case 1:return a.sent(),this.Wc.Ea(i),[4,function(t,r){return e(this,void 0,void 0,(function(){var e,i,o,s,u,a,c,h,f;return n(this,(function(n){switch(n.label){case 0:e=Ar(t),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return Qs.forEach(r,(function(n){return Qs.forEach(n.cs,(function(r){return e.persistence.dr.Eo(t,n.targetId,r)})).next((function(){return Qs.forEach(n.ls,(function(r){return e.persistence.dr.mo(t,n.targetId,r)}))}))}))}))];case 2:return n.sent(),[3,4];case 3:if(!au(i=n.sent()))throw i;return br("LocalStore","Failed to update sequence numbers: "+i),[3,4];case 4:for(o=0,s=r;o<s.length;o++)u=s[o],a=u.targetId,u.fromCache||(c=e.Eh.get(a),h=c.Z,f=c.nt(h),e.Eh=e.Eh.st(a,f));return[2]}}))}))}(this.La,o)];case 2:return a.sent(),[2]}}))}))},t.prototype.nl=function(t){},t.prototype.vu=function(t){return e(this,void 0,void 0,(function(){var r;return n(this,(function(i){switch(i.label){case 0:return this.currentUser.isEqual(t)?[3,3]:(br("SyncEngine","User change. New user:",t.$h()),[4,function(t,r){return e(this,void 0,void 0,(function(){var e,i,o,s;return n(this,(function(n){switch(n.label){case 0:return e=Ar(t),i=e.Gn,o=e.Rh,[4,e.persistence.runTransaction("Handle user change","readonly",(function(t){var n;return e.Gn.yr(t).next((function(s){return n=s,i=e.persistence.oh(r),o=new tu(e.Ah,i,e.persistence.uh()),i.yr(t)})).next((function(e){for(var r=[],i=[],s=bi(),u=0,a=n;u<a.length;u++){var c=a[u];r.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];s=s.add(l.key)}}for(var p=0,d=e;p<d.length;p++){var v=d[p];i.push(v.batchId);for(var y=0,g=v.mutations;y<g.length;y++){var m=g[y];s=s.add(m.key)}}return o.Zn(t,s).next((function(t){return{ml:t,Al:r,Rl:i}}))}))}))];case 1:return s=n.sent(),[2,(e.Gn=i,e.Rh=o,e.Th.Ph(e.Rh),s)]}}))}))}(this.La,t)]);case 1:return r=i.sent(),this.currentUser=t,this.fl("'waitForPendingWrites' promise is rejected due to a user change."),this.Uc.ac(t,r.Al,r.Rl),[4,this.hl(r.ml)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},t.prototype.Oe=function(t){var e=this.Hc.get(t);if(e&&e.qc)return bi().add(e.key);var n=bi(),r=this.Kc.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],u=this.jc.get(s);n=n.Nt(u.view.vc)}return n},t}();function yc(t,r){return e(this,void 0,void 0,(function(){var e,i,o;return n(this,(function(n){switch(n.label){case 0:return[4,Ua((e=Ar(t)).La,r.query,!0)];case 1:return i=n.sent(),o=r.view.Mc(i),[2,(e.el&&e.il(r.targetId,o.$c),o)]}}))}))}function gc(t,r,i,o){return e(this,void 0,void 0,(function(){var e,s;return n(this,(function(n){switch(n.label){case 0:return(e=Ar(t)).nl("applyBatchState()"),[4,function(t,e){var n=Ar(t),r=Ar(n.Gn);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.Pr(t,e).next((function(e){return e?n.Rh.Zn(t,e):Qs.resolve(null)}))}))}(e.La,r)];case 1:return null===(s=n.sent())?[3,6]:"pending"!==i?[3,3]:[4,e.Bc.hu()];case 2:return n.sent(),[3,4];case 3:"acknowledged"===i||"rejected"===i?(e.cl(r,o||null),function(t,e){Ar(Ar(t).Gn).Sr(e)}(e.La,r)):Nr(),n.label=4;case 4:return[4,e.hl(s)];case 5:return n.sent(),[3,7];case 6:br("SyncEngine","Cannot apply mutation batch with id: "+r),n.label=7;case 7:return[2]}}))}))}function mc(t,r){return e(this,void 0,void 0,(function(){var e,i,o,s,u,a,c,h;return n(this,(function(n){switch(n.label){case 0:return e=Ar(t),!0!==r||!0===e.tl?[3,3]:(i=e.Uc.zu(),[4,wc(e,i.N())]);case 1:return o=n.sent(),e.tl=!0,[4,e.Bc.Su(!0)];case 2:for(n.sent(),s=0,u=o;s<u.length;s++)a=u[s],e.Bc.listen(a);return[3,7];case 3:return!1!==r||!1===e.tl?[3,7]:(c=[],h=Promise.resolve(),e.Kc.forEach((function(t,n){e.Uc.ic(n)?c.push(n):h=h.then((function(){return e.rl(n),Va(e.La,n,!0)})),e.Bc.lu(n)})),[4,h]);case 4:return n.sent(),[4,wc(e,c)];case 5:return n.sent(),function(t){var e=Ar(t);e.Hc.forEach((function(t,n){e.Bc.lu(n)})),e.Yc.Nh(),e.Hc=new Map,e.zc=new ai(Kr.P)}(e),e.tl=!1,[4,e.Bc.Su(!1)];case 6:n.sent(),n.label=7;case 7:return[2]}}))}))}function wc(t,r,i){return e(this,void 0,void 0,(function(){var e,i,o,s,u,a,c,h,f,l,p,d,v,y;return n(this,(function(n){switch(n.label){case 0:e=Ar(t),i=[],o=[],s=0,u=r,n.label=1;case 1:return s<u.length?(a=u[s],c=void 0,(h=e.Kc.get(a))&&0!==h.length?[4,Ca(e.La,Ts(h[0]))]:[3,7]):[3,13];case 2:c=n.sent(),f=0,l=h,n.label=3;case 3:return f<l.length?(p=l[f],d=e.jc.get(p),[4,yc(e,d)]):[3,6];case 4:(v=n.sent()).snapshot&&o.push(v.snapshot),n.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,Ma(e.La,a)];case 8:return y=n.sent(),[4,Ca(e.La,y)];case 9:return c=n.sent(),[4,e.sl(bc(y),a,!1)];case 10:n.sent(),n.label=11;case 11:i.push(c),n.label=12;case 12:return s++,[3,1];case 13:return[2,(e.Wc.Ea(o),i)]}}))}))}function bc(t){return ws(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Ic(t){var e=Ar(t);return Ar(Ar(e.La).persistence).rh()}function Ec(t,r,i,o){return e(this,void 0,void 0,(function(){var e,s,u;return n(this,(function(n){switch(n.label){case 0:return(e=Ar(t)).tl?(br("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!e.Kc.has(r))return[3,8];switch(i){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,function(t){var e=Ar(t),n=Ar(e.Ah);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return n.Ur(t,e.mh)})).then((function(t){var n=t.Qr,r=t.readTime;return e.mh=r,n}))}(e.La)];case 3:return s=n.sent(),u=Ai.zt(r,"current"===i),[4,e.hl(s,u)];case 4:return n.sent(),[3,8];case 5:return[4,Va(e.La,r,!0)];case 6:return n.sent(),e.rl(r,o),[3,8];case 7:Nr(),n.label=8;case 8:return[2]}}))}))}function Tc(t,r,i){return e(this,void 0,void 0,(function(){var e,o,s,u,a,c,h,f,l,p;return n(this,(function(d){switch(d.label){case 0:if(!(e=Ar(t)).tl)return[3,10];o=0,s=r,d.label=1;case 1:return o<s.length?(u=s[o],e.Kc.has(u)?(br("SyncEngine","Adding an already active target "+u),[3,5]):[4,Ma(e.La,u)]):[3,6];case 2:return a=d.sent(),[4,Ca(e.La,a)];case 3:return c=d.sent(),[4,e.sl(bc(a),c.targetId,!1)];case 4:d.sent(),e.Bc.listen(c),d.label=5;case 5:return o++,[3,1];case 6:h=function(t){return n(this,(function(n){switch(n.label){case 0:return e.Kc.has(t)?[4,Va(e.La,t,!1).then((function(){e.Bc.lu(t),e.rl(t)})).catch(qa)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))},f=0,l=i,d.label=7;case 7:return f<l.length?(p=l[f],[5,h(p)]):[3,10];case 8:d.sent(),d.label=9;case 9:return f++,[3,7];case 10:return[2]}}))}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Nc=function(){this.Pl=void 0,this.listeners=[]},_c=function(){function t(t){this.fu=t,this.gl=new Ur((function(t){return Ds(t)}),Ss),this.onlineState="Unknown",this.Vl=new Set,this.fu.subscribe(this)}return t.prototype.listen=function(t){return e(this,void 0,void 0,(function(){var e,r,i,o,s,u;return n(this,(function(n){switch(n.label){case 0:if(e=t.query,r=!1,(i=this.gl.get(e))||(r=!0,i=new Nc),!r)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),o=i,[4,this.fu.listen(e)];case 2:return o.Pl=n.sent(),[3,4];case 3:return s=n.sent(),u=mu(s,"Initialization of query '"+ks(t.query)+"' failed"),[2,void t.onError(u)];case 4:return this.gl.set(e,i),i.listeners.push(t),t.xc(this.onlineState),i.Pl&&t.yl(i.Pl)&&this.pl(),[2]}}))}))},t.prototype.lu=function(t){return e(this,void 0,void 0,(function(){var e,r,i,o;return n(this,(function(n){return e=t.query,r=!1,(i=this.gl.get(e))&&(o=i.listeners.indexOf(t))>=0&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(this.gl.delete(e),this.fu.lu(e))]:[2]}))}))},t.prototype.Ea=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.gl.get(o);if(s){for(var u=0,a=s.listeners;u<a.length;u++)a[u].yl(i)&&(e=!0);s.Pl=i}}e&&this.pl()},t.prototype.dl=function(t,e){var n=this.gl.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.gl.delete(t)},t.prototype.al=function(t){this.onlineState=t;var e=!1;this.gl.forEach((function(n,r){for(var i=0,o=r.listeners;i<o.length;i++)o[i].xc(t)&&(e=!0)})),e&&this.pl()},t.prototype.bl=function(t){this.Vl.add(t),t.next()},t.prototype.vl=function(t){this.Vl.delete(t)},t.prototype.pl=function(){this.Vl.forEach((function(t){t.next()}))},t}(),Ac=function(){function t(t,e,n){this.query=t,this.Sl=e,this.Dl=!1,this.Cl=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.yl=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new _i(t.query,t.docs,t.Lt,e,t.qt,t.fromCache,t.Bt,!0)}var o=!1;return this.Dl?this.Nl(t)&&(this.Sl.next(t),o=!0):this.Fl(t,this.onlineState)&&(this.kl(t),o=!0),this.Cl=t,o},t.prototype.onError=function(t){this.Sl.error(t)},t.prototype.xc=function(t){this.onlineState=t;var e=!1;return this.Cl&&!this.Dl&&this.Fl(this.Cl,t)&&(this.kl(this.Cl),e=!0),e},t.prototype.Fl=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.$l&&n||t.docs._()&&"Offline"!==e)},t.prototype.Nl=function(t){if(t.docChanges.length>0)return!0;var e=this.Cl&&this.Cl.hasPendingWrites!==t.hasPendingWrites;return!(!t.Bt&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.kl=function(t){t=_i.Qt(t.query,t.docs,t.qt,t.fromCache),this.Dl=!0,this.Sl.next(t)},t}(),Sc=function(){function t(){}return t.prototype.Ph=function(t){this.xl=t},t.prototype.ns=function(t,e,n,r){var i=this;return e.hn()||n.isEqual(jr.min())?this.Ol(t,e):this.xl.Zn(t,r).next((function(o){var s=i.Ml(e,o);return(e.an()||e.un())&&i.Nc(e.nn,s,r,n)?i.Ol(t,e):(wr()<=f.DEBUG&&br("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),ks(e)),i.xl.ns(t,e,n).next((function(t){return s.forEach((function(e){t=t.st(e.key,e)})),t})))}))},t.prototype.Ml=function(t,e){var n=new fi(Rs(t));return e.forEach((function(e,r){r instanceof ds&&xs(t,r)&&(n=n.add(r))})),n},t.prototype.Nc=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.o(r)>0)},t.prototype.Ol=function(t,e){return wr()<=f.DEBUG&&br("IndexFreeQueryEngine","Using full collection scan to execute query:",ks(e)),this.xl.ns(t,e,jr.min())},t}(),Dc=function(){function t(t,e){this.zn=t,this.dr=e,this.Gn=[],this.Ll=1,this.ql=new fi(ja.yh)}return t.prototype.Ir=function(t){return Qs.resolve(0===this.Gn.length)},t.prototype.mr=function(t,e,n,r){var i=this.Ll;this.Ll++,this.Gn.length>0&&this.Gn[this.Gn.length-1];var o=new Ys(i,e,n,r);this.Gn.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.ql=this.ql.add(new ja(a.key,i)),this.zn.Ar(t,a.key.path.p())}return Qs.resolve(o)},t.prototype.Rr=function(t,e){return Qs.resolve(this.Bl(e))},t.prototype.gr=function(t,e){var n=e+1,r=this.Ul(n),i=r<0?0:r;return Qs.resolve(this.Gn.length>i?this.Gn[i]:null)},t.prototype.Vr=function(){return Qs.resolve(0===this.Gn.length?-1:this.Ll-1)},t.prototype.yr=function(t){return Qs.resolve(this.Gn.slice())},t.prototype.Yn=function(t,e){var n=this,r=new ja(e,0),i=new ja(e,Number.POSITIVE_INFINITY),o=[];return this.ql.St([r,i],(function(t){var e=n.Bl(t.kh);o.push(e)})),Qs.resolve(o)},t.prototype.es=function(t,e){var n=this,r=new fi(kr);return e.forEach((function(t){var e=new ja(t,0),i=new ja(t,Number.POSITIVE_INFINITY);n.ql.St([e,i],(function(t){r=r.add(t.kh)}))})),Qs.resolve(this.Ql(r))},t.prototype.as=function(t,e){var n=e.path,r=n.length+1,i=n;Kr.j(i)||(i=i.child(""));var o=new ja(new Kr(i),0),s=new fi(kr);return this.ql.Dt((function(t){var e=t.key.path;return!!n.D(e)&&(e.length===r&&(s=s.add(t.kh)),!0)}),o),Qs.resolve(this.Ql(s))},t.prototype.Ql=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.Bl(t);null!==r&&n.push(r)})),n},t.prototype.br=function(t,e){var n=this;_r(0===this.Wl(e.batchId,"removed")),this.Gn.shift();var r=this.ql;return Qs.forEach(e.mutations,(function(i){var o=new ja(i.key,e.batchId);return r=r.delete(o),n.dr.Dr(t,i.key)})).next((function(){n.ql=r}))},t.prototype.Sr=function(t){},t.prototype.Nr=function(t,e){var n=new ja(e,0),r=this.ql.Ct(n);return Qs.resolve(e.isEqual(r&&r.key))},t.prototype.Cr=function(t){return this.Gn.length,Qs.resolve()},t.prototype.Wl=function(t,e){return this.Ul(t)},t.prototype.Ul=function(t){return 0===this.Gn.length?0:t-this.Gn[0].batchId},t.prototype.Bl=function(t){var e=this.Ul(t);return e<0||e>=this.Gn.length?null:this.Gn[e]},t}(),kc=function(){function t(t,e){this.zn=t,this.jl=e,this.docs=new ai(Kr.P),this.size=0}return t.prototype.xn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.jl(e);return this.docs=this.docs.st(r,{Or:e,size:s,readTime:n}),this.size+=s-o,this.zn.Ar(t,r.path.p())},t.prototype.Mn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.Ln=function(t,e){var n=this.docs.get(e);return Qs.resolve(n?n.Or:null)},t.prototype.getEntries=function(t,e){var n=this,r=vi();return e.forEach((function(t){var e=n.docs.get(t);r=r.st(t,e?e.Or:null)})),Qs.resolve(r)},t.prototype.ns=function(t,e,n){for(var r=gi(),i=new Kr(e.path.child("")),o=this.docs.ct(i);o.Tt();){var s=o.wt(),u=s.key,a=s.value,c=a.Or,h=a.readTime;if(!e.path.D(u.path))break;h.o(n)<=0||c instanceof ds&&xs(e,c)&&(r=r.st(c.key,c))}return Qs.resolve(r)},t.prototype.Kl=function(t,e){return Qs.forEach(this.docs,(function(t){return e(t)}))},t.prototype.jr=function(e){return new t.Kr(this)},t.prototype.zr=function(t){return Qs.resolve(this.size)},t}();kc.Kr=function(e){function n(t){var n=this;return(n=e.call(this)||this).Hr=t,n}return t(n,e),n.prototype.Un=function(t){var e=this,n=[];return this.Fn.forEach((function(r,i){i?n.push(e.Hr.xn(t,i,e.readTime)):e.Hr.Mn(r)})),Qs.Cn(n)},n.prototype.qn=function(t,e){return this.Hr.Ln(t,e)},n.prototype.Bn=function(t,e){return this.Hr.getEntries(t,e)},n}(Zs);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var xc=function(){function t(t){this.persistence=t,this.Gl=new Ur((function(t){return Jr(t)}),$r),this.lastRemoteSnapshotVersion=jr.min(),this.highestTargetId=0,this.zl=0,this.Hl=new Fa,this.targetCount=0,this.Yl=ga.to()}return t.prototype.be=function(t,e){return this.Gl.forEach((function(t,n){return e(n)})),Qs.resolve()},t.prototype.ro=function(t){return Qs.resolve(this.lastRemoteSnapshotVersion)},t.prototype.oo=function(t){return Qs.resolve(this.zl)},t.prototype.no=function(t){return this.highestTargetId=this.Yl.next(),Qs.resolve(this.highestTargetId)},t.prototype.ho=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.zl&&(this.zl=e),Qs.resolve()},t.prototype.uo=function(t){this.Gl.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Yl=new ga(e),this.highestTargetId=e),t.sequenceNumber>this.zl&&(this.zl=t.sequenceNumber)},t.prototype.ao=function(t,e){return this.uo(e),this.targetCount+=1,Qs.resolve()},t.prototype.lo=function(t,e){return this.uo(e),Qs.resolve()},t.prototype._o=function(t,e){return this.Gl.delete(e.target),this.Hl.Ch(e.targetId),this.targetCount-=1,Qs.resolve()},t.prototype.hr=function(t,e,n){var r=this,i=0,o=[];return this.Gl.forEach((function(s,u){u.sequenceNumber<=e&&null===n.get(u.targetId)&&(r.Gl.delete(s),o.push(r.fo(t,u.targetId)),i++)})),Qs.Cn(o).next((function(){return i}))},t.prototype.do=function(t){return Qs.resolve(this.targetCount)},t.prototype.wo=function(t,e){var n=this.Gl.get(e)||null;return Qs.resolve(n)},t.prototype.To=function(t,e,n){return this.Hl.vh(e,n),Qs.resolve()},t.prototype.Io=function(t,e,n){this.Hl.Dh(e,n);var r=this.persistence.dr,i=[];return r&&e.forEach((function(e){i.push(r.Dr(t,e))})),Qs.Cn(i)},t.prototype.fo=function(t,e){return this.Hl.Ch(e),Qs.resolve()},t.prototype.Ao=function(t,e){var n=this.Hl.Fh(e);return Qs.resolve(n)},t.prototype.Nr=function(t,e){return Qs.resolve(this.Hl.Nr(e))},t}(),Rc=function(){function t(t){var e=this;this.Jl={},this.yo=new nu(0),this.po=!1,this.po=!0,this.dr=t(this),this.ko=new xc(this),this.zn=new Qu,this.Kn=new kc(this.zn,(function(t){return e.dr.Xl(t)}))}return t.prototype.start=function(){return Promise.resolve()},t.prototype.th=function(){return this.po=!1,Promise.resolve()},Object.defineProperty(t.prototype,"tr",{get:function(){return this.po},enumerable:!1,configurable:!0}),t.prototype.Bo=function(){},t.prototype.Uo=function(){},t.prototype.uh=function(){return this.zn},t.prototype.oh=function(t){var e=this.Jl[t.$h()];return e||(e=new Dc(this.zn,this.dr),this.Jl[t.$h()]=e),e},t.prototype.hh=function(){return this.ko},t.prototype.ah=function(){return this.Kn},t.prototype.runTransaction=function(t,e,n){var r=this;br("MemoryPersistence","Starting transaction:",t);var i=new Pc(this.yo.next());return this.dr.Zl(),n(i).next((function(t){return r.dr.t_(i).next((function(){return t}))})).Sn().then((function(t){return i.jn(),t}))},t.prototype.e_=function(t,e){return Qs.Nn(Object.values(this.Jl).map((function(n){return function(){return n.Nr(t,e)}})))},t}(),Pc=function(e){function n(t){var n=this;return(n=e.call(this)||this).Ro=t,n}return t(n,e),n}($s),Lc=function(){function t(t){this.persistence=t,this.n_=new Fa,this.s_=null}return t.i_=function(e){return new t(e)},Object.defineProperty(t.prototype,"r_",{get:function(){if(this.s_)return this.s_;throw Nr()},enumerable:!1,configurable:!0}),t.prototype.Eo=function(t,e,n){return this.n_.Eo(n,e),this.r_.delete(n.toString()),Qs.resolve()},t.prototype.mo=function(t,e,n){return this.n_.mo(n,e),this.r_.add(n.toString()),Qs.resolve()},t.prototype.Dr=function(t,e){return this.r_.add(e.toString()),Qs.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.n_.Ch(e.targetId).forEach((function(t){return n.r_.add(t.toString())}));var r=this.persistence.hh();return r.Ao(t,e.targetId).next((function(t){t.forEach((function(t){return n.r_.add(t.toString())}))})).next((function(){return r._o(t,e)}))},t.prototype.Zl=function(){this.s_=new Set},t.prototype.t_=function(t){var e=this,n=this.persistence.ah().jr();return Qs.forEach(this.r_,(function(r){var i=Kr.B(r);return e.o_(t,i).next((function(t){t||n.Mn(i)}))})).next((function(){return e.s_=null,n.apply(t)}))},t.prototype.wh=function(t,e){var n=this;return this.o_(t,e).next((function(t){t?n.r_.delete(e.toString()):n.r_.add(e.toString())}))},t.prototype.Xl=function(t){return 0},t.prototype.o_=function(t,e){var n=this;return Qs.Nn([function(){return Qs.resolve(n.n_.Nr(e))},function(){return n.persistence.hh().Nr(t,e)},function(){return n.persistence.e_(t,e)}])},t}(),Oc=function(){function t(t){this.h_=t.h_,this.a_=t.a_}return t.prototype.wa=function(t){this.u_=t},t.prototype.ca=function(t){this.c_=t},t.prototype.onMessage=function(t){this.l_=t},t.prototype.close=function(){this.a_()},t.prototype.send=function(t){this.h_(t)},t.prototype.__=function(){this.u_()},t.prototype.f_=function(t){this.c_(t)},t.prototype.d_=function(t){this.l_(t)},t}(),Cc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Vc=function(e){function n(t){var n=this;return(n=e.call(this,t)||this).forceLongPolling=t.forceLongPolling,n}return t(n,e),n.prototype.A_=function(t,e,n,r){return new Promise((function(i,o){var s=new gr;s.listenOnce(vr.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case dr.NO_ERROR:var e=s.getResponseJson();br("Connection","XHR received:",JSON.stringify(e)),i(e);break;case dr.TIMEOUT:br("Connection",'RPC "'+t+'" timed out'),o(new qr(Mr.DEADLINE_EXCEEDED,"Request time out"));break;case dr.HTTP_ERROR:var n=s.getStatus();if(br("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var u=function(t){var e=t.toLowerCase().replace("_","-");return Object.values(Mr).indexOf(e)>=0?e:Mr.UNKNOWN}(r.status);o(new qr(u,r.message))}else o(new qr(Mr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new qr(Mr.UNAVAILABLE,"Connection failed."));break;default:Nr()}}finally{br("Connection",'RPC "'+t+'" completed.')}}));var u=JSON.stringify(r);s.send(e,"POST",u,n,15)}))},n.prototype.Ta=function(t,e){var n=[this.T_,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=pr(),i={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.s.projectId+"/databases/"+this.s.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.m_(i.initMessageHeaders,e),o()||s()||u()||a()||c()||h()||(i.httpHeadersOverwriteParam="$httpHeaders");var f=n.join("");br("Connection","Creating WebChannel: "+f,i);var l=r.createWebChannel(f,i),p=!1,d=!1,v=new Oc({h_:function(t){d?br("Connection","Not sending because WebChannel is closed:",t):(p||(br("Connection","Opening WebChannel transport."),l.open(),p=!0),br("Connection","WebChannel sending:",t),l.send(t))},a_:function(){return l.close()}}),y=function(t,e){l.listen(t,(function(t){try{e(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return y(yr.EventType.OPEN,(function(){d||br("Connection","WebChannel transport opened.")})),y(yr.EventType.CLOSE,(function(){d||(d=!0,br("Connection","WebChannel transport closed"),v.f_())})),y(yr.EventType.ERROR,(function(t){d||(d=!0,Er("Connection","WebChannel transport errored:",t),v.f_(new qr(Mr.UNAVAILABLE,"The operation could not be completed")))})),y(yr.EventType.MESSAGE,(function(t){var e;if(!d){var n=t.data[0];_r(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){br("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=ni[t];if(void 0!==e)return ui(e)}(o),u=i.message;void 0===s&&(s=Mr.INTERNAL,u="Unknown error status: "+o+" with message "+i.message),d=!0,v.f_(new qr(s,u)),l.close()}else br("Connection","WebChannel received:",n),v.d_(n)}})),setTimeout((function(){v.__()}),0),v},n}(function(){function t(t){this.w_=t,this.s=t.s;var e=t.ssl?"https":"http";this.T_=e+"://"+t.host,this.E_="projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents"}return t.prototype.va=function(t,e,n,r){var i=this.I_(t,e);br("RestConnection","Sending: ",i,n);var o={};return this.m_(o,r),this.A_(t,i,o,n).then((function(t){return br("RestConnection","Received: ",t),t}),(function(e){throw Er("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.Sa=function(t,e,n,r){return this.va(t,e,n,r)},t.prototype.m_=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.19.1",t["Content-Type"]="text/plain",e)for(var n in e.Mh)e.Mh.hasOwnProperty(n)&&(t[n]=e.Mh[n])},t.prototype.I_=function(t,e){var n=Cc[t];return this.T_+"/v1/"+e+":"+n},t}()),Uc=function(){function t(){var t=this;this.R_=function(){return t.P_()},this.g_=function(){return t.V_()},this.y_=[],this.p_()}return t.prototype.Ka=function(t){this.y_.push(t)},t.prototype.th=function(){window.removeEventListener("online",this.R_),window.removeEventListener("offline",this.g_)},t.prototype.p_=function(){window.addEventListener("online",this.R_),window.addEventListener("offline",this.g_)},t.prototype.P_=function(){br("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.y_;t<e.length;t++)(0,e[t])(0)},t.prototype.V_=function(){br("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.y_;t<e.length;t++)(0,e[t])(1)},t.ks=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Mc=function(){function t(){}return t.prototype.Ka=function(t){},t.prototype.th=function(){},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qc(t){return new eo(t,!0)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fc="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",jc=function(){function t(){}return t.prototype.initialize=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return this.Uc=this.b_(t),this.persistence=this.v_(t),[4,this.persistence.start()];case 1:return e.sent(),this.S_=this.D_(t),this.La=this.C_(t),[2]}}))}))},t.prototype.D_=function(t){return null},t.prototype.C_=function(t){return e=this.persistence,n=new Sc,r=t.N_,new xa(e,n,r);var e,n,r},t.prototype.v_=function(t){if(t.k_.F_)throw new qr(Mr.FAILED_PRECONDITION,Fc);return new Rc(Lc.i_)},t.prototype.b_=function(t){return new cc},t.prototype.terminate=function(){return e(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return this.S_&&this.S_.stop(),[4,this.Uc.th()];case 1:return t.sent(),[4,this.persistence.th()];case 2:return t.sent(),[2]}}))}))},t.prototype.clearPersistence=function(t,e){throw new qr(Mr.FAILED_PRECONDITION,Fc)},t}(),Gc=function(r){function i(t){var e=this;return(e=r.call(this)||this).x_=t,e}return t(i,r),i.prototype.initialize=function(t){return e(this,void 0,void 0,(function(){var i,o=this;return n(this,(function(s){switch(s.label){case 0:return[4,r.prototype.initialize.call(this,t)];case 1:return s.sent(),[4,this.x_.initialize(this,t)];case 2:return s.sent(),i=this.x_.fu,this.Uc instanceof ac?(this.Uc.fu={Ic:gc.bind(null,i),mc:Ec.bind(null,i),Ac:Tc.bind(null,i),rh:Ic.bind(null,i)},[4,this.Uc.start()]):[3,4];case 3:s.sent(),s.label=4;case 4:return[4,this.persistence.qo((function(t){return e(o,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,mc(this.x_.fu,t)];case 1:return e.sent(),this.S_&&(t&&!this.S_.tr?this.S_.start(this.La):t||this.S_.stop()),[2]}}))}))}))];case 5:return s.sent(),[2]}}))}))},i.prototype.b_=function(t){if(t.k_.F_&&t.k_.synchronizeTabs){var e=du();if(!ac.ks(e))throw new qr(Mr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=ka(t.w_.s,t.w_.persistenceKey);return new ac(e,t.ei,n,t.clientId,t.N_)}return new cc},i}(function(r){function i(){return null!==r&&r.apply(this,arguments)||this}return t(i,r),i.prototype.initialize=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(i){switch(i.label){case 0:return[4,r.prototype.initialize.call(this,t)];case 1:return i.sent(),[4,function(t){return e(this,void 0,void 0,(function(){var e,r;return n(this,(function(n){return e=Ar(t),r=Ar(e.Ah),[2,e.persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return r.Wr(t)})).then((function(t){e.mh=t}))]}))}))}(this.La)];case 2:return i.sent(),[2]}}))}))},i.prototype.D_=function(t){var e=this.persistence.dr.Yi;return new Tu(e,t.ei)},i.prototype.v_=function(t){var e=ka(t.w_.s,t.w_.persistenceKey),n=qc(t.w_.s);return new Na(t.k_.synchronizeTabs,e,t.clientId,Eu.Ui(t.k_.cacheSizeBytes),t.ei,du(),vu(),n,this.Uc,t.k_.Vo)},i.prototype.b_=function(t){return new cc},i.prototype.clearPersistence=function(t,r){return function(t){return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return ou.ks()?(e=t+"main",[4,ou.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(ka(t,r))},i}(jc)),Bc=function(){function t(){}return t.prototype.initialize=function(t,r){return e(this,void 0,void 0,(function(){var e=this;return n(this,(function(n){switch(n.label){case 0:return this.La?[3,3]:(this.La=t.La,this.Uc=t.Uc,this.qa=this.O_(r),this.Bc=this.M_(r),this.fu=this.L_(r),this.q_=this.B_(r),this.Uc.Da=function(t){return e.fu.xc(t,1)},this.Bc.fu=this.fu,[4,this.Bc.start()]);case 1:return n.sent(),[4,this.Bc.Su(this.fu.el)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.B_=function(t){return new _c(this.fu)},t.prototype.O_=function(t){var e,n=qc(t.w_.s),r=(e=t.w_,new Vc(e));return function(t,e,n){return new Za(t,e,n)}(t.credentials,r,n)},t.prototype.M_=function(t){var e=this;return new $a(this.La,this.qa,t.ei,(function(t){return e.fu.xc(t,0)}),Uc.ks()?new Uc:new Mc)},t.prototype.L_=function(t){return function(t,e,n,r,i,o,s){var u=new vc(t,e,n,r,i,o);return s&&(u.tl=!0),u}(this.La,this.Bc,this.qa,this.Uc,t.N_,t.Qc,!t.k_.F_||!t.k_.synchronizeTabs)},t.prototype.terminate=function(){return this.Bc.th()},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zc(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var Hc=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.U_(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.U_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Q_=function(){this.muted=!0},t.prototype.U_=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kc(t,e){if(0!==e.length)throw new qr(Mr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+hh(e.length,"argument")+".")}function Wc(t,e,n){if(e.length!==n)throw new qr(Mr.INVALID_ARGUMENT,"Function "+t+"() requires "+hh(n,"argument")+", but was called with "+hh(e.length,"argument")+".")}function Yc(t,e,n){if(e.length<n)throw new qr(Mr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+hh(n,"argument")+", but was called with "+hh(e.length,"argument")+".")}function Xc(t,e,n,r){if(e.length<n||e.length>r)throw new qr(Mr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+hh(e.length,"argument")+".")}function Qc(t,e,n,r){nh(t,e,ch(n)+" argument",r)}function Zc(t,e,n,r){void 0!==r&&Qc(t,e,n,r)}function Jc(t,e,n,r){nh(t,e,n+" option",r)}function $c(t,e,n,r){void 0!==r&&Jc(t,e,n,r)}function th(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],s=0,u=i;s<u.length;s++){var a=u[s];if(a===r)return;o.push(ih(a))}var c=ih(r);throw new qr(Mr.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function eh(t,e,n,r){if(!e.some((function(t){return t===r})))throw new qr(Mr.INVALID_ARGUMENT,"Invalid value "+ih(r)+" provided to function "+t+"() for its "+ch(n)+" argument. Acceptable values: "+e.join(", "));return r}function nh(t,e,n,r){if(!("object"===e?rh(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=ih(r);throw new qr(Mr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function rh(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function ih(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Nr()}function oh(t,e,n){if(void 0===n)throw new qr(Mr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+ch(e)+" argument, but it was undefined.")}function sh(t,e,n){Cr(e,(function(e,r){if(n.indexOf(e)<0)throw new qr(Mr.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))}))}function uh(t,e,n,r){var i=ih(r);return new qr(Mr.INVALID_ARGUMENT,"Function "+t+"() requires its "+ch(n)+" argument to be a "+e+", but it was: "+i)}function ah(t,e,n){if(n<=0)throw new qr(Mr.INVALID_ARGUMENT,"Function "+t+"() requires its "+ch(e)+" argument to be a positive number, but it was: "+n+".")}function ch(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function hh(t,e){return t+" "+e+(1===t?"":"s")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fh(){if("undefined"==typeof Uint8Array)throw new qr(Mr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function lh(){if("undefined"==typeof atob)throw new qr(Mr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var ph=function(){function t(t){lh(),this.W_=t}return t.fromBase64String=function(e){Wc("Blob.fromBase64String",arguments,1),Qc("Blob.fromBase64String","string",1,e),lh();try{return new t(ei.fromBase64String(e))}catch(e){throw new qr(Mr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+e)}},t.fromUint8Array=function(e){if(Wc("Blob.fromUint8Array",arguments,1),fh(),!(e instanceof Uint8Array))throw uh("Blob.fromUint8Array","Uint8Array",1,e);return new t(ei.fromUint8Array(e))},t.prototype.toBase64=function(){return Wc("Blob.toBase64",arguments,0),lh(),this.W_.toBase64()},t.prototype.toUint8Array=function(){return Wc("Blob.toUint8Array",arguments,0),fh(),this.W_.toUint8Array()},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this.W_.isEqual(t.W_)},t}(),dh=function(t){!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new qr(Mr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+hh(1,"element")+".")}(0,t);for(var e=0;e<t.length;++e)if(Qc("FieldPath","string",e,t[e]),0===t[e].length)throw new qr(Mr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.j_=new Hr(t)},vh=function(e){function n(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.call(this,t)||this}return t(n,e),n.documentId=function(){return new n(Hr.L().F())},n.prototype.isEqual=function(t){if(!(t instanceof n))throw uh("isEqual","FieldPath",1,t);return this.j_.isEqual(t.j_)},n}(dh),yh=new RegExp("[~\\*/\\[\\]]"),gh=function(){this.K_=this},mh=function(e){function n(t){var n=this;return(n=e.call(this)||this).G_=t,n}return t(n,e),n.prototype.z_=function(t){if(2!==t.H_)throw 1===t.H_?t.Y_(this.G_+"() can only appear at the top level of your update data"):t.Y_(this.G_+"() cannot be used with set() unless you pass {merge:true}");return t.qe.push(t.path),null},n.prototype.isEqual=function(t){return t instanceof n},n}(gh);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wh(t,e,n){return new Ph({H_:3,J_:e.settings.J_,methodName:t.G_,X_:n},e.s,e.serializer,e.ignoreUndefinedProperties)}var bh=function(e){function n(t){var n=this;return(n=e.call(this)||this).G_=t,n}return t(n,e),n.prototype.z_=function(t){return new Ko(t.path,new Uo)},n.prototype.isEqual=function(t){return t instanceof n},n}(gh),Ih=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).G_=t,r.Z_=n,r}return t(n,e),n.prototype.z_=function(t){var e=wh(this,t,!0),n=this.Z_.map((function(t){return Mh(t,e)})),r=new Mo(n);return new Ko(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(gh),Eh=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).G_=t,r.Z_=n,r}return t(n,e),n.prototype.z_=function(t){var e=wh(this,t,!0),n=this.Z_.map((function(t){return Mh(t,e)})),r=new Fo(n);return new Ko(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(gh),Th=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).G_=t,r.tf=n,r}return t(n,e),n.prototype.z_=function(t){var e=new Go(t.serializer,io(t.serializer,this.tf));return new Ko(t.path,e)},n.prototype.isEqual=function(t){return this===t},n}(gh),Nh=function(e){function n(){return e.call(this)||this}return t(n,e),n.delete=function(){return Kc("FieldValue.delete",arguments),new _h(new mh("FieldValue.delete"))},n.serverTimestamp=function(){return Kc("FieldValue.serverTimestamp",arguments),new _h(new bh("FieldValue.serverTimestamp"))},n.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Yc("FieldValue.arrayUnion",arguments,1),new _h(new Ih("FieldValue.arrayUnion",t))},n.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Yc("FieldValue.arrayRemove",arguments,1),new _h(new Eh("FieldValue.arrayRemove",t))},n.increment=function(t){return Qc("FieldValue.increment","number",1,t),Wc("FieldValue.increment",arguments,1),new _h(new Th("FieldValue.increment",t))},n}(gh),_h=function(e){function n(t){var n=this;return(n=e.call(this)||this).K_=t,n.G_=t.G_,n}return t(n,e),n.prototype.z_=function(t){return this.K_.z_(t)},n.prototype.isEqual=function(t){return t instanceof n&&this.K_.isEqual(t.K_)},n}(Nh),Ah=function(){function t(t,e){if(Wc("GeoPoint",arguments,2),Qc("GeoPoint","number",1,t),Qc("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new qr(Mr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new qr(Mr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.ef=t,this.nf=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this.ef},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this.nf},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.ef===t.ef&&this.nf===t.nf},t.prototype.toJSON=function(){return{latitude:this.ef,longitude:this.nf}},t.prototype.T=function(t){return kr(this.ef,t.ef)||kr(this.nf,t.nf)},t}(),Sh=/^__.*__$/,Dh=function(t,e,n){this.sf=t,this.if=e,this.rf=n},kh=function(){function t(t,e,n){this.data=t,this.qe=e,this.fieldTransforms=n}return t.prototype.hf=function(t,e){var n=[];return null!==this.qe?n.push(new rs(t,this.data,this.qe,e)):n.push(new ns(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new os(t,this.fieldTransforms)),n},t}(),xh=function(){function t(t,e,n){this.data=t,this.qe=e,this.fieldTransforms=n}return t.prototype.hf=function(t,e){var n=[new rs(t,this.data,this.qe,e)];return this.fieldTransforms.length>0&&n.push(new os(t,this.fieldTransforms)),n},t}();function Rh(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Nr()}}var Ph=function(){function t(t,e,n,r,i,o){this.settings=t,this.s=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.af(),this.fieldTransforms=i||[],this.qe=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"H_",{get:function(){return this.settings.H_},enumerable:!1,configurable:!0}),t.prototype.uf=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.s,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.qe)},t.prototype.cf=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.uf({path:n,X_:!1});return r.lf(t),r},t.prototype._f=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.uf({path:n,X_:!1});return r.af(),r},t.prototype.ff=function(t){return this.uf({path:void 0,X_:!0})},t.prototype.Y_=function(t){return zh(t,this.settings.methodName,this.settings.df||!1,this.path,this.settings.J_)},t.prototype.contains=function(t){return void 0!==this.qe.find((function(e){return t.D(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.D(e.field)}))},t.prototype.af=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.lf(this.path.get(t))},t.prototype.lf=function(t){if(0===t.length)throw this.Y_("Document fields must not be empty");if(Rh(this.H_)&&Sh.test(t))throw this.Y_('Document fields cannot begin and end with "__"')},t}(),Lh=function(){function t(t,e,n){this.s=t,this.ignoreUndefinedProperties=e,this.serializer=n||qc(t)}return t.prototype.wf=function(t,e,n,r){return void 0===r&&(r=!1),new Ph({H_:t,methodName:e,J_:n,path:Hr.$(),X_:!1,df:r},this.s,this.serializer,this.ignoreUndefinedProperties)},t}();function Oh(t,e,n,r,i,o){void 0===o&&(o={});var s=t.wf(o.merge||o.mergeFields?2:0,e,n,i);jh("Data must be an object, but it was:",s,r);var u,a,c=qh(r,s);if(o.merge)u=new Ho(s.qe),a=s.fieldTransforms;else if(o.mergeFields){for(var h=[],f=0,l=o.mergeFields;f<l.length;f++){var p=l[f],d=void 0;if(p instanceof dh)d=p.j_;else{if("string"!=typeof p)throw Nr();d=Bh(e,p,n)}if(!s.contains(d))throw new qr(Mr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Hh(h,d)||h.push(d)}u=new Ho(h),a=s.fieldTransforms.filter((function(t){return u.Ke(t.field)}))}else u=null,a=s.fieldTransforms;return new kh(new hs(c),u,a)}function Ch(t,e,n,r){var i=t.wf(1,e,n);jh("Data must be an object, but it was:",i,r);var o=[],s=new fs;Cr(r,(function(t,r){var u=Bh(e,t,n),a=i._f(u);if(r instanceof gh&&r.K_ instanceof mh)o.push(u);else{var c=Mh(r,a);null!=c&&(o.push(u),s.set(u,c))}}));var u=new Ho(o);return new xh(s.ze(),u,i.fieldTransforms)}function Vh(t,e,n,r,i,o){var s=t.wf(1,e,n),u=[Gh(e,r,n)],a=[i];if(o.length%2!=0)throw new qr(Mr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(Gh(e,o[c])),a.push(o[c+1]);for(var h=[],f=new fs,l=u.length-1;l>=0;--l)if(!Hh(h,u[l])){var p=u[l],d=a[l],v=s._f(p);if(d instanceof gh&&d.K_ instanceof mh)h.push(p);else{var y=Mh(d,v);null!=y&&(h.push(p),f.set(p,y))}}var g=new Ho(h);return new xh(f.ze(),g,s.fieldTransforms)}function Uh(t,e,n,r){return void 0===r&&(r=!1),Mh(n,t.wf(r?4:3,e))}function Mh(t,e){if(Fh(t))return jh("Unsupported field value:",e,t),qh(t,e);if(t instanceof gh)return function(t,e){if(!Rh(e.H_))throw e.Y_(t.G_+"() can only be used with update() and set()");if(!e.path)throw e.Y_(t.G_+"() is not currently supported inside arrays");var n=t.z_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.qe.push(e.path),t instanceof Array){if(e.settings.X_&&4!==e.H_)throw e.Y_("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Mh(o[i],e.ff(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return io(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Fr.fromDate(t);return{timestampValue:oo(e.serializer,n)}}if(t instanceof Fr){var r=new Fr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:oo(e.serializer,r)}}if(t instanceof Ah)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof ph)return{bytesValue:so(e.serializer,t)};if(t instanceof Dh){var i=e.s,o=t.sf;if(!o.isEqual(i))throw e.Y_("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:co(t.sf||e.s,t.if.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.Y_("Unsupported field value: "+ih(t))}(t,e)}function qh(t,e){var n={};return Vr(t)?e.path&&e.path.length>0&&e.qe.push(e.path):Cr(t,(function(t,r){var i=Mh(r,e.cf(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Fh(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Fr||t instanceof Ah||t instanceof ph||t instanceof Dh||t instanceof gh)}function jh(t,e,n){if(!Fh(n)||!rh(n)){var r=ih(n);throw"an object"===r?e.Y_(t+" a custom object"):e.Y_(t+" "+r)}}function Gh(t,e,n){if(e instanceof dh)return e.j_;if("string"==typeof e)return Bh(t,e);throw zh("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function Bh(t,e,n){try{return function(t){if(t.search(yh)>=0)throw new qr(Mr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(vh.bind.apply(vh,i([void 0],t.split("."))))}catch(e){throw new qr(Mr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).j_}catch(e){throw zh((r=e)instanceof Error?r.message:r.toString(),t,!1,void 0,n)}var r}function zh(t,e,n,r,i){var o=r&&!r._(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new qr(Mr.INVALID_ARGUMENT,(u+=". ")+t+a)}function Hh(t,e){return t.some((function(t){return t.isEqual(e)}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kh=function(){function t(t){this.qa=t,this.Tf=new Map,this.mutations=[],this.Ef=!1,this.If=null,this.mf=new Set}return t.prototype.Af=function(t){return e(this,void 0,void 0,(function(){var r,i=this;return n(this,(function(o){switch(o.label){case 0:if(this.Rf(),this.mutations.length>0)throw new qr(Mr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,r){return e(this,void 0,void 0,(function(){var e,i,o,s,u,a;return n(this,(function(n){switch(n.label){case 0:return e=Ar(t),i=yo(e.serializer)+"/documents",o={documents:r.map((function(t){return fo(e.serializer,t)}))},[4,e.Sa("BatchGetDocuments",i,o)];case 1:return s=n.sent(),u=new Map,s.forEach((function(t){var n=function(t,e){return"found"in e?function(t,e){_r(!!e.found),e.found.name,e.found.updateTime;var n=lo(t,e.found.name),r=ao(e.found.updateTime),i=new hs({mapValue:{fields:e.found.fields}});return new ds(n,r,i,{})}(t,e):"missing"in e?function(t,e){_r(!!e.missing),_r(!!e.readTime);var n=lo(t,e.missing),r=ao(e.readTime);return new vs(n,r)}(t,e):Nr()}(e.serializer,t);u.set(n.key.toString(),n)})),a=[],[2,(r.forEach((function(t){var e=u.get(t.toString());_r(!!e),a.push(e)})),a)]}}))}))}(this.qa,t)];case 1:return[2,((r=o.sent()).forEach((function(t){t instanceof vs||t instanceof ds?i.Pf(t):Nr()})),r)]}}))}))},t.prototype.set=function(t,e){this.write(e.hf(t,this.Qe(t))),this.mf.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.hf(t,this.gf(t)))}catch(t){this.If=t}this.mf.add(t.toString())},t.prototype.delete=function(t){this.write([new as(t,this.Qe(t))]),this.mf.add(t.toString())},t.prototype.commit=function(){return e(this,void 0,void 0,(function(){var t,r=this;return n(this,(function(i){switch(i.label){case 0:if(this.Rf(),this.If)throw this.If;return t=this.Tf,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,e){var n=Kr.B(e);r.mutations.push(new cs(n,r.Qe(n)))})),[4,function(t,r){return e(this,void 0,void 0,(function(){var e,i,o;return n(this,(function(n){switch(n.label){case 0:return e=Ar(t),i=yo(e.serializer)+"/documents",o={writes:r.map((function(t){return wo(e.serializer,t)}))},[4,e.va("Commit",i,o)];case 1:return n.sent(),[2]}}))}))}(this.qa,this.mutations)];case 1:return i.sent(),this.Ef=!0,[2]}}))}))},t.prototype.Pf=function(t){var e;if(t instanceof ds)e=t.version;else{if(!(t instanceof vs))throw Nr();e=jr.min()}var n=this.Tf.get(t.key.toString());if(n){if(!e.isEqual(n))throw new qr(Mr.ABORTED,"Document version changed between two reads.")}else this.Tf.set(t.key.toString(),e)},t.prototype.Qe=function(t){var e=this.Tf.get(t.toString());return!this.mf.has(t.toString())&&e?Yo.updateTime(e):Yo.We()},t.prototype.gf=function(t){var e=this.Tf.get(t.toString());if(!this.mf.has(t.toString())&&e){if(e.isEqual(jr.min()))throw new qr(Mr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Yo.updateTime(e)}return Yo.exists(!0)},t.prototype.write=function(t){this.Rf(),this.mutations=this.mutations.concat(t)},t.prototype.Rf=function(){},t}(),Wh=function(){function t(t,e,n,r){this.ei=t,this.qa=e,this.updateFunction=n,this.ii=r,this.Vf=5,this.Ti=new iu(this.ei,"transaction_retry")}return t.prototype.run=function(){this.yf()},t.prototype.yf=function(){var t=this;this.Ti.bs((function(){return e(t,void 0,void 0,(function(){var t,e,r=this;return n(this,(function(n){return t=new Kh(this.qa),(e=this.pf(t))&&e.then((function(e){r.ei.ai((function(){return t.commit().then((function(){r.ii.resolve(e)})).catch((function(t){r.bf(t)}))}))})).catch((function(t){r.bf(t)})),[2]}))}))}))},t.prototype.pf=function(t){try{var e=this.updateFunction(t);return!Wr(e)&&e.catch&&e.then?e:(this.ii.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.ii.reject(t),null}},t.prototype.bf=function(t){var e=this;this.Vf>0&&this.vf(t)?(this.Vf-=1,this.ei.ai((function(){return e.yf(),Promise.resolve()}))):this.ii.reject(t)},t.prototype.vf=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!si(e)}return!1},t}(),Yh=function(){function t(t,e){this.credentials=t,this.ei=e,this.clientId=Dr.t(),this.Sf=new ru}return t.prototype.start=function(t,e,n,r){var i=this;this.Df(),this.w_=t;var o=new ru,s=!1;return this.credentials.Bh((function(t){if(!s)return s=!0,br("FirestoreClient","Initializing. user=",t.uid),i.Cf(e,n,r,t,o).then(i.Sf.resolve,i.Sf.reject);i.ei.gi((function(){return i.Bc.vu(t)}))})),this.ei.ai((function(){return i.Sf.promise})),o.promise},t.prototype.enableNetwork=function(){var t=this;return this.Df(),this.ei.enqueue((function(){return t.persistence.Uo(!0),t.Bc.enableNetwork()}))},t.prototype.Cf=function(t,r,i,o,s){return e(this,void 0,void 0,(function(){var u,a,c=this;return n(this,(function(h){switch(h.label){case 0:return h.trys.push([0,3,,4]),u={ei:this.ei,w_:this.w_,clientId:this.clientId,credentials:this.credentials,N_:o,Qc:100,k_:i},[4,t.initialize(u)];case 1:return h.sent(),[4,r.initialize(t,u)];case 2:return h.sent(),this.persistence=t.persistence,this.Uc=t.Uc,this.La=t.La,this.S_=t.S_,this.qa=r.qa,this.Bc=r.Bc,this.fu=r.fu,this.Nf=r.q_,this.persistence.Bo((function(){return e(c,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}}))}))})),s.resolve(),[3,4];case 3:if(a=h.sent(),s.reject(a),!this.Ff(a))throw a;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+a),this.Cf(new jc,new Bc,{F_:!1},o,s))];case 4:return[2]}}))}))},t.prototype.Ff=function(t){return"FirebaseError"===t.name?t.code===Mr.FAILED_PRECONDITION||t.code===Mr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},t.prototype.Df=function(){if(this.ei.Ii)throw new qr(Mr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.disableNetwork=function(){var t=this;return this.Df(),this.ei.enqueue((function(){return t.persistence.Uo(!1),t.Bc.disableNetwork()}))},t.prototype.terminate=function(){var t=this;this.ei.Pi();var r=new ru;return this.ei.mi((function(){return e(t,void 0,void 0,(function(){var t,e;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),this.S_&&this.S_.stop(),[4,this.Bc.th()];case 1:return n.sent(),[4,this.Uc.th()];case 2:return n.sent(),[4,this.persistence.th()];case 3:return n.sent(),this.credentials.Uh(),r.resolve(),[3,5];case 4:return t=n.sent(),e=mu(t,"Failed to shutdown persistence"),r.reject(e),[3,5];case 5:return[2]}}))}))})),r.promise},t.prototype.waitForPendingWrites=function(){var t=this;this.Df();var e=new ru;return this.ei.ai((function(){return t.fu._l(e)})),e.promise},t.prototype.listen=function(t,e,n){var r=this;this.Df();var i=new Hc(n),o=new Ac(t,i,e);return this.ei.ai((function(){return r.Nf.listen(o)})),function(){i.Q_(),r.ei.ai((function(){return r.Nf.lu(o)}))}},t.prototype.kf=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(r){switch(r.label){case 0:return this.Df(),[4,this.Sf.promise];case 1:return[2,(r.sent(),function(t,r,i){return e(this,void 0,void 0,(function(){var o,s=this;return n(this,(function(u){switch(u.label){case 0:return o=new ru,[4,t.enqueue((function(){return e(s,void 0,void 0,(function(){var t,e,s;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,function(t,e){var n=Ar(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Rh.Hn(t,e)}))}(r,i)];case 1:return(t=n.sent())instanceof ds?o.resolve(t):t instanceof vs?o.resolve(null):o.reject(new qr(Mr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return e=n.sent(),s=mu(e,"Failed to get document '"+i+" from cache"),o.reject(s),[3,3];case 3:return[2]}}))}))}))];case 1:return[2,(u.sent(),o.promise)]}}))}))}(this.ei,this.La,t))]}}))}))},t.prototype.$f=function(t,r){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return this.Df(),[4,this.Sf.promise];case 1:return[2,(e.sent(),function(t,e,n,r){var i=new ru,o=Xh(t,e,bs(n.path),{includeMetadataChanges:!0,$l:!0},{next:function(t){o();var e=t.docs.has(n);!e&&t.fromCache?i.reject(new qr(Mr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&r&&"server"===r.source?i.reject(new qr(Mr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(t)},error:function(t){return i.reject(t)}});return i.promise}(this.ei,this.Nf,t,r))]}}))}))},t.prototype.xf=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(r){switch(r.label){case 0:return this.Df(),[4,this.Sf.promise];case 1:return[2,(r.sent(),function(t,r,i){return e(this,void 0,void 0,(function(){var o,s=this;return n(this,(function(u){switch(u.label){case 0:return o=new ru,[4,t.enqueue((function(){return e(s,void 0,void 0,(function(){var t,e,s,u,a,c;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Ua(r,i,!0)];case 1:return t=n.sent(),e=new lc(i,t.gh),s=e.Sc(t.documents),u=e.Un(s,!1),o.resolve(u.snapshot),[3,3];case 2:return a=n.sent(),c=mu(a,"Failed to execute query '"+i+" against cache"),o.reject(c),[3,3];case 3:return[2]}}))}))}))];case 1:return[2,(u.sent(),o.promise)]}}))}))}(this.ei,this.La,t))]}}))}))},t.prototype.Of=function(t,r){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return this.Df(),[4,this.Sf.promise];case 1:return[2,(e.sent(),function(t,e,n,r){var i=new ru,o=Xh(t,e,n,{includeMetadataChanges:!0,$l:!0},{next:function(t){o(),t.fromCache&&r&&"server"===r.source?i.reject(new qr(Mr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}});return i.promise}(this.ei,this.Nf,t,r))]}}))}))},t.prototype.write=function(t){var e=this;this.Df();var n=new ru;return this.ei.ai((function(){return e.fu.write(t,n)})),n.promise},t.prototype.s=function(){return this.w_.s},t.prototype.bl=function(t){var r=this;this.Df();var i=new Hc(t);return this.ei.ai((function(){return e(r,void 0,void 0,(function(){return n(this,(function(t){return[2,this.Nf.bl(i)]}))}))})),function(){i.Q_(),r.ei.ai((function(){return e(r,void 0,void 0,(function(){return n(this,(function(t){return[2,this.Nf.vl(i)]}))}))}))}},Object.defineProperty(t.prototype,"Mf",{get:function(){return this.ei.Ii},enumerable:!1,configurable:!0}),t.prototype.transaction=function(t){var e=this;this.Df();var n=new ru;return this.ei.ai((function(){return new Wh(e.ei,e.qa,t,n).run(),Promise.resolve()})),n.promise},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xh(t,e,n,r,i){var o=new Hc(i),s=new Ac(n,o,r);return t.ai((function(){return e.listen(s)})),function(){o.Q_(),t.ai((function(){return e.lu(s)}))}}var Qh=function(){function t(t,e,n,r){this.s=t,this.timestampsInSnapshots=e,this.Lf=n,this.qf=r}return t.prototype.Bf=function(t){switch(Mi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Hi(t.integerValue||t.doubleValue);case 3:return this.Uf(t.timestampValue);case 4:return this.Qf(t);case 5:return t.stringValue;case 6:return new ph(Ki(t.bytesValue));case 7:return this.Wf(t.referenceValue);case 8:return this.jf(t.geoPointValue);case 9:return this.Kf(t.arrayValue);case 10:return this.Gf(t.mapValue);default:throw Nr()}},t.prototype.Gf=function(t){var e=this,n={};return Cr(t.fields||{},(function(t,r){n[t]=e.Bf(r)})),n},t.prototype.jf=function(t){return new Ah(Hi(t.latitude),Hi(t.longitude))},t.prototype.Kf=function(t){var e=this;return(t.values||[]).map((function(t){return e.Bf(t)}))},t.prototype.Qf=function(t){switch(this.Lf){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return Ci(n)?t(n):n}(t);return null==e?null:this.Bf(e);case"estimate":return this.Uf(Vi(t));default:return null}},t.prototype.Uf=function(t){var e=zi(t),n=new Fr(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},t.prototype.Wf=function(t){var e=Br.k(t);_r(Po(e));var n=new Lr(e.get(1),e.get(3)),r=new Kr(e.V(5));return n.isEqual(this.s)||Ir("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.s.projectId+"/"+this.s.database+") instead."),this.qf(r)},t}(),Zh=Eu.ji,Jh=function(){function t(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new qr(Mr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Jc("settings","non-empty string","host",t.host),this.host=t.host,$c("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(sh("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),$c("settings","object","credentials",t.credentials),this.credentials=t.credentials,$c("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),$c("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?Ir("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&Ir("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,$c("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Eu.Gi;else{if(t.cacheSizeBytes!==Zh&&t.cacheSizeBytes<Eu.Ki)throw new qr(Mr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Eu.Ki);this.cacheSizeBytes=t.cacheSizeBytes}$c("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.experimentalForceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),$h=function(){function t(r,i,o,s){var u=this;if(void 0===o&&(o=new jc),void 0===s&&(s=new Bc),this.zf=o,this.Hf=s,this.Yf=null,this.Jf=new gu,this.INTERNAL={delete:function(){return e(u,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return this.Xf(),[4,this.Zf.terminate()];case 1:return t.sent(),[2]}}))}))}},"object"==typeof r.options){var a=r;this.Yf=a,this.sf=t.td(a),this.ed=a.name,this.nd=new Ha(i)}else{var c=r;if(!c.projectId)throw new qr(Mr.INVALID_ARGUMENT,"Must provide projectId");this.sf=new Lr(c.projectId,c.database),this.ed="[DEFAULT]",this.nd=new za}this.sd=new Jh({})}return Object.defineProperty(t.prototype,"rd",{get:function(){return this.od||(this.od=new Lh(this.sf,this.sd.ignoreUndefinedProperties)),this.od},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){Wc("Firestore.settings",arguments,1),Qc("Firestore.settings","object",1,t),t.merge&&delete(t=Object.assign(Object.assign({},this.sd),t)).merge;var e=new Jh(t);if(this.Zf&&!this.sd.isEqual(e))throw new qr(Mr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this.sd=e,void 0!==e.credentials&&(this.nd=function(t){if(!t)return new za;switch(t.type){case"gapi":var e=t.hd;return _r(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Wa(e,t.zh||"0");case"provider":return t.hd;default:throw new qr(Mr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},t.prototype.enableNetwork=function(){return this.Xf(),this.Zf.enableNetwork()},t.prototype.disableNetwork=function(){return this.Xf(),this.Zf.disableNetwork()},t.prototype.enablePersistence=function(t){var e,n;if(this.Zf)throw new qr(Mr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&Ir("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new qr(Mr.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.ad(this.zf,this.Hf,{F_:!0,cacheSizeBytes:this.sd.cacheSizeBytes,synchronizeTabs:r,Vo:i})},t.prototype.clearPersistence=function(){return e(this,void 0,void 0,(function(){var t,r=this;return n(this,(function(i){if(void 0!==this.Zf&&!this.Zf.Mf)throw new qr(Mr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return t=new ru,[2,(this.Jf.mi((function(){return e(r,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.zf.clearPersistence(this.sf,this.ed)];case 1:return n.sent(),t.resolve(),[3,3];case 2:return e=n.sent(),t.reject(e),[3,3];case 3:return[2]}}))}))})),t.promise)]}))}))},t.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(t.prototype,"ud",{get:function(){return this.Xf(),this.Zf.Mf},enumerable:!1,configurable:!0}),t.prototype.waitForPendingWrites=function(){return this.Xf(),this.Zf.waitForPendingWrites()},t.prototype.onSnapshotsInSync=function(t){if(this.Xf(),zc(t))return this.Zf.bl(t);Qc("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.Zf.bl(e)},t.prototype.Xf=function(){return this.Zf||this.ad(new jc,new Bc,{F_:!1}),this.Zf},t.prototype.ld=function(){return new Pr(this.sf,this.ed,this.sd.host,this.sd.ssl,this.sd.experimentalForceLongPolling)},t.prototype.ad=function(t,e,n){var r=this.ld();return this.Zf=new Yh(this.nd,this.Jf),this.Zf.start(r,t,e,n)},t.td=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new qr(Mr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */if(!n||"string"!=typeof n)throw new qr(Mr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Lr(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Yf)throw new qr(Mr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Yf},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){return Wc("Firestore.collection",arguments,1),Qc("Firestore.collection","non-empty string",1,t),this.Xf(),new vf(Br.k(t),this,null)},t.prototype.doc=function(t){return Wc("Firestore.doc",arguments,1),Qc("Firestore.doc","non-empty string",1,t),this.Xf(),nf._d(Br.k(t),this,null)},t.prototype.collectionGroup=function(t){if(Wc("Firestore.collectionGroup",arguments,1),Qc("Firestore.collectionGroup","non-empty string",1,t),t.indexOf("/")>=0)throw new qr(Mr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.Xf(),new pf(function(t){return new ms(Br.$(),t)}(t),this,null)},t.prototype.runTransaction=function(t){var e=this;return Wc("Firestore.runTransaction",arguments,1),Qc("Firestore.runTransaction","function",1,t),this.Xf().transaction((function(n){return t(new tf(e,n))}))},t.prototype.batch=function(){return this.Xf(),new ef(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(wr()){case f.DEBUG:return"debug";case f.ERROR:return"error";case f.SILENT:return"silent";case f.WARN:return"warn";case f.INFO:return"info";case f.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),t.setLogLevel=function(t){var e;Wc("Firestore.setLogLevel",arguments,1),eh("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),e=t,mr.setLogLevel(e)},t.prototype.fd=function(){return this.sd.timestampsInSnapshots},t.prototype.dd=function(){return this.sd},t}(),tf=function(){function t(t,e){this.wd=t,this.Td=e}return t.prototype.get=function(t){var e=this;Wc("Transaction.get",arguments,1);var n=wf("Transaction.get",t,this.wd);return this.Td.Af([n.if]).then((function(t){if(!t||1!==t.length)return Nr();var r=t[0];if(r instanceof vs)return new of(e.wd,n.if,null,!1,!1,n.rf);if(r instanceof ds)return new of(e.wd,n.if,r,!1,!1,n.rf);throw Nr()}))},t.prototype.set=function(t,e,n){Xc("Transaction.set",arguments,2,3);var r=wf("Transaction.set",t,this.wd);n=yf("Transaction.set",n);var i=If(r.rf,e,n),o=Oh(this.wd.rd,"Transaction.set",r.if,i,null!==r.rf,n);return this.Td.set(r.if,o),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return"string"==typeof e||e instanceof vh?(Yc("Transaction.update",arguments,3),r=wf("Transaction.update",t,this.wd),i=Vh(this.wd.rd,"Transaction.update",r.if,e,n,o)):(Wc("Transaction.update",arguments,2),r=wf("Transaction.update",t,this.wd),i=Ch(this.wd.rd,"Transaction.update",r.if,e)),this.Td.update(r.if,i),this},t.prototype.delete=function(t){Wc("Transaction.delete",arguments,1);var e=wf("Transaction.delete",t,this.wd);return this.Td.delete(e.if),this},t}(),ef=function(){function t(t){this.wd=t,this.Ed=[],this.Id=!1}return t.prototype.set=function(t,e,n){Xc("WriteBatch.set",arguments,2,3),this.md();var r=wf("WriteBatch.set",t,this.wd);n=yf("WriteBatch.set",n);var i=If(r.rf,e,n),o=Oh(this.wd.rd,"WriteBatch.set",r.if,i,null!==r.rf,n);return this.Ed=this.Ed.concat(o.hf(r.if,Yo.We())),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.md(),"string"==typeof e||e instanceof vh?(Yc("WriteBatch.update",arguments,3),r=wf("WriteBatch.update",t,this.wd),i=Vh(this.wd.rd,"WriteBatch.update",r.if,e,n,o)):(Wc("WriteBatch.update",arguments,2),r=wf("WriteBatch.update",t,this.wd),i=Ch(this.wd.rd,"WriteBatch.update",r.if,e)),this.Ed=this.Ed.concat(i.hf(r.if,Yo.exists(!0))),this},t.prototype.delete=function(t){Wc("WriteBatch.delete",arguments,1),this.md();var e=wf("WriteBatch.delete",t,this.wd);return this.Ed=this.Ed.concat(new as(e.if,Yo.We())),this},t.prototype.commit=function(){return this.md(),this.Id=!0,this.Ed.length>0?this.wd.Xf().write(this.Ed):Promise.resolve()},t.prototype.md=function(){if(this.Id)throw new qr(Mr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),nf=function(e){function n(t,n,r){var i=this;return(i=e.call(this,n.sf,t,r)||this).if=t,i.firestore=n,i.rf=r,i.Zf=i.firestore.Xf(),i}return t(n,e),n._d=function(t,e,r){if(t.length%2!=0)throw new qr(Mr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.F()+" has "+t.length);return new n(new Kr(t),e,r)},Object.defineProperty(n.prototype,"id",{get:function(){return this.if.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return new vf(this.if.path.p(),this.firestore,this.rf)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this.if.path.F()},enumerable:!1,configurable:!0}),n.prototype.collection=function(t){if(Wc("DocumentReference.collection",arguments,1),Qc("DocumentReference.collection","non-empty string",1,t),!t)throw new qr(Mr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Br.k(t);return new vf(this.if.path.child(e),this.firestore,null)},n.prototype.isEqual=function(t){if(!(t instanceof n))throw uh("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.if.isEqual(t.if)&&this.rf===t.rf},n.prototype.set=function(t,e){Xc("DocumentReference.set",arguments,1,2),e=yf("DocumentReference.set",e);var n=If(this.rf,t,e),r=Oh(this.firestore.rd,"DocumentReference.set",this.if,n,null!==this.rf,e);return this.Zf.write(r.hf(this.if,Yo.We()))},n.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return"string"==typeof t||t instanceof vh?(Yc("DocumentReference.update",arguments,2),n=Vh(this.firestore.rd,"DocumentReference.update",this.if,t,e,r)):(Wc("DocumentReference.update",arguments,1),n=Ch(this.firestore.rd,"DocumentReference.update",this.if,t)),this.Zf.write(n.hf(this.if,Yo.exists(!0)))},n.prototype.delete=function(){return Wc("DocumentReference.delete",arguments,0),this.Zf.write([new as(this.if,Yo.We())])},n.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Xc("DocumentReference.onSnapshot",arguments,1,4);var s={includeMetadataChanges:!1},u=0;"object"!=typeof i[u]||zc(i[u])||(sh("DocumentReference.onSnapshot",s=i[u],["includeMetadataChanges"]),$c("DocumentReference.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++);var a={includeMetadataChanges:s.includeMetadataChanges};if(zc(i[u])){var c=i[u];i[u]=null===(t=c.next)||void 0===t?void 0:t.bind(c),i[u+1]=null===(e=c.error)||void 0===e?void 0:e.bind(c),i[u+2]=null===(n=c.complete)||void 0===n?void 0:n.bind(c)}else Qc("DocumentReference.onSnapshot","function",u,i[u]),Zc("DocumentReference.onSnapshot","function",u+1,i[u+1]),Zc("DocumentReference.onSnapshot","function",u+2,i[u+2]);var h={next:function(t){i[u]&&i[u](r.Ad(t))},error:i[u+1],complete:i[u+2]};return this.Zf.listen(bs(this.if.path),a,h)},n.prototype.get=function(t){var e=this;Xc("DocumentReference.get",arguments,0,1),mf("DocumentReference.get",t);var n=this.firestore.Xf();return t&&"cache"===t.source?n.kf(this.if).then((function(t){return new of(e.firestore,e.if,t,!0,t instanceof ds&&t.Ge,e.rf)})):n.$f(this.if,t).then((function(t){return e.Ad(t)}))},n.prototype.withConverter=function(t){return new n(this.if,this.firestore,t)},n.prototype.Ad=function(t){var e=t.docs.get(this.if);return new of(this.firestore,this.if,e,t.fromCache,t.hasPendingWrites,this.rf)},n}(Dh),rf=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),of=function(){function t(t,e,n,r,i,o){this.wd=t,this.if=e,this.Rd=n,this.Pd=r,this.gd=i,this.rf=o}return t.prototype.data=function(t){var e=this;if(Xc("DocumentSnapshot.data",arguments,0,1),t=gf("DocumentSnapshot.data",t),this.Rd){if(this.rf){var n=new sf(this.wd,this.if,this.Rd,this.Pd,this.gd,null);return this.rf.fromFirestore(n,t)}return new Qh(this.wd.sf,this.wd.fd(),t.serverTimestamps||"none",(function(t){return new nf(t,e.wd,null)})).Bf(this.Rd.tn())}},t.prototype.get=function(t,e){var n=this;if(Xc("DocumentSnapshot.get",arguments,1,2),e=gf("DocumentSnapshot.get",e),this.Rd){var r=this.Rd.data().field(Gh("DocumentSnapshot.get",t,this.if));if(null!==r)return new Qh(this.wd.sf,this.wd.fd(),e.serverTimestamps||"none",(function(t){return new nf(t,n.wd,n.rf)})).Bf(r)}},Object.defineProperty(t.prototype,"id",{get:function(){return this.if.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new nf(this.if,this.wd,this.rf)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this.Rd},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new rf(this.gd,this.Pd)},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw uh("isEqual","DocumentSnapshot",1,e);return this.wd===e.wd&&this.Pd===e.Pd&&this.if.isEqual(e.if)&&(null===this.Rd?null===e.Rd:this.Rd.isEqual(e.Rd))&&this.rf===e.rf},t}(),sf=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.data=function(t){return e.prototype.data.call(this,t)},n}(of);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uf(t,e,n,r,i,o,s){var u;if(i.M()){if("array-contains"===o||"array-contains-any"===o)throw new qr(Mr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){hf(s,o);for(var a=[],c=0,h=s;c<h.length;c++){var f=h[c];a.push(cf(r,t,f))}u={arrayValue:{values:a}}}else u=cf(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||hf(s,o),u=Uh(n,e,s,"in"===o||"not-in"===o);var l=Ps.create(i,o,u);return function(t,e){if(e._n()){var n=t.ln();if(null!==n&&!n.isEqual(e.field))throw new qr(Mr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=t.cn();null!==r&&ff(t,e.field,r)}var i=t.fn(function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new qr(Mr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new qr(Mr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}function af(t,e,n){if(null!==t.startAt)throw new qr(Mr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new qr(Mr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Hs(e,n);return function(t,e){if(null===t.cn()){var n=t.ln();null!==n&&ff(t,n,e.field)}}(t,r),r}function cf(t,e,n){if("string"==typeof n){if(""===n)throw new qr(Mr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Is(e)&&-1!==n.indexOf("/"))throw new qr(Mr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Br.k(n));if(!Kr.j(r))throw new qr(Mr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Wi(t,new Kr(r))}if(n instanceof Dh)return Wi(t,n.if);throw new qr(Mr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+ih(n)+".")}function hf(t,e){if(!Array.isArray(t)||0===t.length)throw new qr(Mr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new qr(Mr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if("in"===e||"array-contains-any"===e){if(t.indexOf(null)>=0)throw new qr(Mr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(t.filter((function(t){return Number.isNaN(t)})).length>0)throw new qr(Mr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")}}function ff(t,e,n){if(!n.isEqual(e))throw new qr(Mr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function lf(t){if(t.un()&&0===t.en.length)throw new qr(Mr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var pf=function(){function t(t,e,n){this.Vd=t,this.firestore=e,this.rf=n}return t.prototype.where=function(e,n,r){var i;Wc("Query.where",arguments,3),oh("Query.where",3,r),i="not-in"===n||"!="===n?n:eh("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,n);var o=Gh("Query.where",e),s=uf(this.Vd,"Query.where",this.firestore.rd,this.firestore.sf,o,i,r);return new t(function(t,e){var n=t.filters.concat([e]);return new ms(t.path,t.collectionGroup,t.en.slice(),n,t.limit,t.nn,t.startAt,t.endAt)}(this.Vd,s),this.firestore,this.rf)},t.prototype.orderBy=function(e,n){var r;if(Xc("Query.orderBy",arguments,1,2),Zc("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r="asc";else{if("desc"!==n)throw new qr(Mr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r="desc"}var i=Gh("Query.orderBy",e),o=af(this.Vd,i,r);return new t(function(t,e){var n=t.en.concat([e]);return new ms(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.nn,t.startAt,t.endAt)}(this.Vd,o),this.firestore,this.rf)},t.prototype.limit=function(e){return Wc("Query.limit",arguments,1),Qc("Query.limit","number",1,e),ah("Query.limit",1,e),new t(Ns(this.Vd,e,"F"),this.firestore,this.rf)},t.prototype.limitToLast=function(e){return Wc("Query.limitToLast",arguments,1),Qc("Query.limitToLast","number",1,e),ah("Query.limitToLast",1,e),new t(Ns(this.Vd,e,"L"),this.firestore,this.rf)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Yc("Query.startAt",arguments,1);var i=this.yd("Query.startAt",e,n,!0);return new t(_s(this.Vd,i),this.firestore,this.rf)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Yc("Query.startAfter",arguments,1);var i=this.yd("Query.startAfter",e,n,!1);return new t(_s(this.Vd,i),this.firestore,this.rf)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Yc("Query.endBefore",arguments,1);var i=this.yd("Query.endBefore",e,n,!0);return new t(As(this.Vd,i),this.firestore,this.rf)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Yc("Query.endAt",arguments,1);var i=this.yd("Query.endAt",e,n,!1);return new t(As(this.Vd,i),this.firestore,this.rf)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw uh("isEqual","Query",1,e);return this.firestore===e.firestore&&Ss(this.Vd,e.Vd)&&this.rf===e.rf},t.prototype.withConverter=function(e){return new t(this.Vd,this.firestore,e)},t.prototype.yd=function(t,e,n,r){if(oh(t,1,e),e instanceof of)return Wc(t,i([e],n),1),function(t,e,n,r,i){if(!r)throw new qr(Mr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,u=Es(t);s<u.length;s++){var a=u[s];if(a.field.M())o.push(Wi(e,r.key));else{var c=r.field(a.field);if(Ci(c))throw new qr(Mr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=a.field.F();throw new qr(Mr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new js(o,i)}(this.Vd,this.firestore.sf,t,e.Rd,r);var o=[e].concat(n);return function(t,e,n,r,i,o){var s=t.en;if(i.length>s.length)throw new qr(Mr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.M()){if("string"!=typeof c)throw new qr(Mr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Is(t)&&-1!==c.indexOf("/"))throw new qr(Mr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Br.k(c));if(!Kr.j(h))throw new qr(Mr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var f=new Kr(h);u.push(Wi(e,f))}else{var l=Uh(n,r,c);u.push(l)}}return new js(u,o)}(this.Vd,this.firestore.sf,this.firestore.rd,t,o,r)},t.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Xc("Query.onSnapshot",arguments,1,4);var s={},u=0;if("object"!=typeof i[u]||zc(i[u])||(sh("Query.onSnapshot",s=i[u],["includeMetadataChanges"]),$c("Query.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++),zc(i[u])){var a=i[u];i[u]=null===(t=a.next)||void 0===t?void 0:t.bind(a),i[u+1]=null===(e=a.error)||void 0===e?void 0:e.bind(a),i[u+2]=null===(n=a.complete)||void 0===n?void 0:n.bind(a)}else Qc("Query.onSnapshot","function",u,i[u]),Zc("Query.onSnapshot","function",u+1,i[u+1]),Zc("Query.onSnapshot","function",u+2,i[u+2]);var c={next:function(t){i[u]&&i[u](new df(r.firestore,r.Vd,t,r.rf))},error:i[u+1],complete:i[u+2]};return lf(this.Vd),this.firestore.Xf().listen(this.Vd,s,c)},t.prototype.get=function(t){var e=this;Xc("Query.get",arguments,0,1),mf("Query.get",t),lf(this.Vd);var n=this.firestore.Xf();return(t&&"cache"===t.source?n.xf(this.Vd):n.Of(this.Vd,t)).then((function(t){return new df(e.firestore,e.Vd,t,e.rf)}))},t}(),df=function(){function t(t,e,n,r){this.wd=t,this.pd=e,this.bd=n,this.rf=r,this.vd=null,this.Sd=null,this.metadata=new rf(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this.bd.docs._()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.bd.docs.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;Xc("QuerySnapshot.forEach",arguments,1,2),Qc("QuerySnapshot.forEach","function",1,t),this.bd.docs.forEach((function(r){t.call(e,n.Dd(r,n.metadata.fromCache,n.bd.qt.has(r.key)))}))},Object.defineProperty(t.prototype,"query",{get:function(){return new pf(this.pd,this.wd,this.rf)},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){t&&(sh("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),$c("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.bd.Ut)throw new qr(Mr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.vd&&this.Sd===e||(this.vd=function(t,e,n){if(t.Lt._()){var r=0;return t.docChanges.map((function(e){var i=n(e.doc,t.fromCache,t.qt.has(e.doc.key));return e.doc,{type:"added",doc:i,oldIndex:-1,newIndex:r++}}))}var i=t.Lt;return t.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var r=n(e.doc,t.fromCache,t.qt.has(e.doc.key)),o=-1,s=-1;return 0!==e.type&&(o=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(s=(i=i.add(e.doc)).indexOf(e.doc.key)),{type:bf(e.type),doc:r,oldIndex:o,newIndex:s}}))}(this.bd,e,this.Dd.bind(this)),this.Sd=e),this.vd},t.prototype.isEqual=function(e){if(!(e instanceof t))throw uh("isEqual","QuerySnapshot",1,e);return this.wd===e.wd&&Ss(this.pd,e.pd)&&this.bd.isEqual(e.bd)&&this.rf===e.rf},t.prototype.Dd=function(t,e,n){return new sf(this.wd,t.key,t,e,n,this.rf)},t}(),vf=function(e){function n(t,n,r){var i=this;if((i=e.call(this,bs(t),n,r)||this).Cd=t,t.length%2!=1)throw new qr(Mr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.F()+" has "+t.length);return i}return t(n,e),Object.defineProperty(n.prototype,"id",{get:function(){return this.Vd.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){var t=this.Vd.path.p();return t._()?null:new nf(new Kr(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this.Vd.path.F()},enumerable:!1,configurable:!0}),n.prototype.doc=function(t){Xc("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Dr.t()),Qc("CollectionReference.doc","non-empty string",1,t);var e=Br.k(t);return nf._d(this.Vd.path.child(e),this.firestore,this.rf)},n.prototype.add=function(t){Wc("CollectionReference.add",arguments,1),Qc("CollectionReference.add","object",1,this.rf?this.rf.toFirestore(t):t);var e=this.doc();return e.set(t).then((function(){return e}))},n.prototype.withConverter=function(t){return new n(this.Cd,this.firestore,t)},n}(pf);function yf(t,e){if(void 0===e)return{merge:!1};if(sh(t,e,["merge","mergeFields"]),$c(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new qr(Mr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+ih(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new qr(Mr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+o+" was: "+ih(r[o]))}(t,"mergeFields",0,r,(function(t){return"string"==typeof t||t instanceof vh}))}(t,0,0,e.mergeFields),void 0!==e.mergeFields&&void 0!==e.merge)throw new qr(Mr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function gf(t,e){return void 0===e?{}:(sh(t,e,["serverTimestamps"]),th(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function mf(t,e){Zc(t,"object",1,e),e&&(sh(t,e,["source"]),th(t,0,"source",e.source,["default","server","cache"]))}function wf(t,e,n){if(e instanceof Dh){if(e.firestore!==n)throw new qr(Mr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw uh(t,"DocumentReference",1,e)}function bf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Nr()}}function If(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Ef,Tf={Firestore:$h,GeoPoint:Ah,Timestamp:Fr,Blob:ph,Transaction:tf,WriteBatch:ef,DocumentReference:nf,DocumentSnapshot:of,Query:pf,QueryDocumentSnapshot:sf,QuerySnapshot:df,CollectionReference:vf,FieldPath:vh,FieldValue:Nh,setLogLevel:$h.setLogLevel,CACHE_SIZE_UNLIMITED:Zh};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(t,e){t.INTERNAL.registerComponent(new p("firestore",(function(t){return function(t,e){var n=new Bc,r=new Gc(n);return new $h(t,e,r,n)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},Tf)))})(Ef=d),Ef.registerVersion("@firebase/firestore","1.16.6");
//# sourceMappingURL=index.esm.js.map
